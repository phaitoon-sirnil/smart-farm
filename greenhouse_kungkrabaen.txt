[{"id":"b4cbe1d0.a16da","type":"tab","label":"House1_Welcome","disabled":true,"info":""},{"id":"77963358.df6f4c","type":"tab","label":"House1_Home","disabled":false,"info":""},{"id":"a5f3d8c4.ba3b58","type":"tab","label":"House1_Graphs","disabled":false,"info":""},{"id":"e922dd0b.a5c9","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"926df561.3f5508","type":"ui_group","z":"","name":"Home","tab":"","order":1,"disp":true,"width":"6","collapse":false},{"id":"66d25192.930d1","type":"ui_group","z":0,"name":"Home","tab":"","order":1,"disp":true,"width":"6","collapse":false},{"id":"9a71659f.f9d3b8","type":"ui_group","z":"","name":"Stat","tab":"","disp":false,"width":"6"},{"id":"fe8886b6.d39a78","type":"ui_group","z":"","name":"PROJECTOR SCREEN INFO","tab":"","order":4,"disp":true,"width":"6"},{"id":"85494e35.0c87b","type":"ui_group","z":0,"name":"Home","tab":"","order":1,"disp":true,"width":"6","collapse":false},{"id":"9b798ea6.f5d93","type":"ui_group","z":0,"name":"Home","tab":"","order":1,"disp":true,"width":"6","collapse":false},{"id":"c69e50b1.c1be6","type":"ui_group","z":0,"name":"Home","tab":"","order":1,"disp":true,"width":"6","collapse":false},{"id":"e15e4188.56a11","type":"ui_group","z":0,"name":"Home","tab":"","order":1,"disp":true,"width":"6","collapse":false},{"id":"cb06e39c.14df5","type":"ui_tab","z":"","name":"House1","icon":"smart-farm","order":1,"disabled":false,"hidden":false},{"id":"f01c7bf6.313058","type":"ui_group","z":0,"name":"Graphs","tab":"cb06e39c.14df5","order":3,"disp":true,"width":"6","collapse":false},{"id":"5ac6ecde.6c6a94","type":"mqtt-broker","z":"","name":"","broker":"tailor-01.cloudmqtt.com","port":"12188","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"/state/mqtt","birthQos":"0","birthPayload":"MQTT_CONNECTED","closeTopic":"/state/mqtt","closeQos":"0","closePayload":"MQTT_DISCONNECTED","willTopic":"/state/mqtt","willQos":"0","willPayload":"MQTT_ERROR"},{"id":"a77c9e11.23eb6","type":"MySQLdatabase","z":"","host":"us-cdbr-iron-east-05.cleardb.net","port":"3306","db":"heroku_0564199d676c56c","tz":""},{"id":"5488c752.3230e8","type":"ui_group","z":0,"name":"Home","tab":"cb06e39c.14df5","order":2,"disp":true,"width":"6","collapse":false},{"id":"af317053.5ae2a","type":"users_config","z":0,"appPath":"/","jwtCookieName":"","jwtHttpsOnly":false},{"id":"d38eb155.1deb4","type":"ui_group","z":"","name":"Welcome","tab":"cb06e39c.14df5","order":1,"disp":false,"width":"6","collapse":false},{"id":"bbb0a297.ee818","type":"function","z":"a5f3d8c4.ba3b58","name":"Handle SET","func":"// here we set manual override controls - valid for 60 minutes after last change.\nif(typeof global.get(\"startHour\")=='undefined') global.set(\"startHour\",0);\nif(typeof global.get(\"restTime\")=='undefined') global.set(\"restTime\",15);\n\nif (global.get(\"away\")===0)\n{\n    if (msg.payload==\"u\") { global.set(\"manualTimer\",60); if (global.get(\"manual\")<10) global.set(\"manual\",global.get(\"manual\")+1); }\n    if (msg.payload==\"d\") { global.set(\"manualTimer\",60); if (global.get(\"manual\")>-10) global.set(\"manual\",global.get(\"manual\")-1); }\n    if (msg.payload==\"a\") { global.set(\"manualTimer\",0); global.set(\"manual\",0); }\n}\n\nif (global.get(\"manual\")===0) msg.colour=\"#aaddff\"; else msg.colour=\"#aaffaa\";\n\nmsg.desired= global.get(\"setTemperature\") + global.get(\"manual\");\nif (global.get(\"frost\")) { msg.desired=global.get(\"timing\")[168]; msg.colour=\"#ffbbbb\"; }\nif (global.get(\"away\"))  { msg.desired=global.get(\"timing\")[169];msg.colour=\"#ffbbbb\";  }\nmsg.value=msg.desired;\n\nreturn msg;","outputs":1,"noerr":0,"x":441.1000061035156,"y":934,"wires":[[]]},{"id":"8fd96468.906d78","type":"function","z":"a5f3d8c4.ba3b58","name":"Showing settings","func":"if(msg.mode == \"auto\") msg.payload = \"Turn on AUTOMETIC control\";\nelse if (msg.mode == \"man\") msg.payload = \"Turn on MANUAL control\";\nelse msg.payload=\"Showing settings\";\nreturn msg;","outputs":1,"noerr":0,"x":640.099967956543,"y":741.0000071525574,"wires":[["970b7969.9dd788"]]},{"id":"27af7028.65aa2","type":"function","z":"a5f3d8c4.ba3b58","name":"Process controls","func":"var d = new Date();\nd.setTime( d.getTime() + 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\nif ( typeof context.selector == 'undefined' ) context.selector=1;\nif ( typeof context.saving == 'undefined' ) context.saving=0;\nif ( typeof context.control == 'undefined' ) context.control=0;\nif ( typeof context.startDay == 'undefined') context.startDay = d.getDate();\nif ( typeof context.startMonth == 'undefined') context.startMonth = d.getMonth();\nif ( typeof context.startYear == 'undefined') context.startYear = d.getYear()-57;\nif ( typeof context.startHour == 'undefined') context.startHour = d.getHours();\nif ( typeof context.toDay == 'undefined') context.toDay = d.getDate();\nif ( typeof context.toMonth == 'undefined') context.toMonth = d.getMonth();\nif ( typeof context.toYear == 'undefined') context.toYear = d.getYear()-57;\nif ( typeof context.toHour == 'undefined') context.toHour = d.getHours();\n\n\nvar MAX_DEVICE = 6;\n\n\nswitch (msg.payload)\n    {\n    case \"U\" : \n                 \n            \n                if (context.selector==1) {//Control selection (Frost selection) \n                    context.control++ ;\n                    context.control %= MAX_DEVICE;\n                    msg.foryou=\"Go to next control device \"+context.control; \n                }\n                if (context.selector==2) {// start day to report \n                    context.startDay++ ;\n                    if(context.startMonth===0 || context.startMonth==2 || context.startMonth==4 || context.startMonth==6 ||\n                       context.startMonth==7 || context.startMonth==9 || context.startMonth==11){\n                      \n                        if(context.startDay > 31)context.startDay=1;\n                    }else if (context.startMonth==2){\n                        if(context.startDay>28)context.startDay=1;\n                    }else{\n                        if(context.startDay>30)context.startDay=1;\n                    }\n                    msg.foryou=\"Move to running type \"+context.startDay; \n                    \n                }\n                if (context.selector==3) { //start month selection\n                    context.startMonth++;\n                    context.startMonth %= 12;\n                    msg.foryou=\"Forward one month\";\n                }\n                if (context.selector==4) { //stat year Selection\n                    context.startYear++ ;\n                    msg.foryou=\"Forward for one year\"; \n                }\n                if (context.selector==5) { //stat year Selection\n                    context.startHour++ ;\n                    context.startHour %= 24;\n                    msg.foryou=\"Forward for one Hour\"; \n                }\n                \n                \n                if (context.selector==8) {// start day to report \n                    context.toDay++ ;\n                    if(context.toMonth===0 || context.toMonth==2 || context.toMonth==4 || context.toMonth==6 ||\n                       context.toMonth==7 || context.toMonth==9 || context.toMonth==11){\n                      \n                        if(context.toDay > 31)context.toDay=1;\n                    }else if (context.toMonth==2){\n                        if(context.toDay>28)context.toDay=1;\n                    }else{\n                        if(context.toDay>30)context.toDay=1;\n                    }\n                    msg.foryou=\"Move to running type \"+context.toDay; \n                    \n                }\n                if (context.selector==9) { //start month selection\n                    context.toMonth++;\n                    context.toMonth %= 12;\n                    msg.foryou=\"Forward one month\";\n                }\n                if (context.selector==10) { //stat year Selection\n                    context.toYear++ ;\n                    msg.foryou=\"Forward for one year\"; \n                }\n                if (context.selector==11) { //stat year Selection\n                    context.toHour++ ;\n                    context.toHour %= 24;\n                    msg.foryou=\"Forward for one Hour\"; \n                }\n                break;\n    \n    case \"D\" :  if (context.selector==1) {//Control selection (Frost selection) \n                    context.control-- ;\n                    if(context.control < 0) context.control = MAX_DEVICE-1;\n                    //context.control %= MAX_DEVICE;\n                    msg.foryou=\"Go to next control device \"+context.control; \n                }\n                if (context.selector==2) {// start day to report \n                    context.startDay-- ;\n                    if(context.startMonth===0 || context.startMonth==2 || context.startMonth==4 || context.startMonth==6 ||\n                       context.startMonth==7 || context.startMonth==9 || context.startMonth==11){\n                        \n                        if(context.startDay<=0)context.startDay=31\n                        \n                    }else if (context.startMonth==2){\n                        if(context.startDay<=0)context.startDay=28;\n                        \n                    }else{\n                        if(context.startDay<=0)context.startDay=30;\n                        \n                    }\n                    msg.foryou=\"Move to running type \"+context.startDay; \n                    \n                }\n                if (context.selector==3) { //start month selection\n                    context.startMonth--;\n                    if(context.startMonth<0)context.startMonth=11;\n                    msg.foryou=\"Backward one month \"+context.startMonth;\n                }\n                if (context.selector==4) { //stat year Selection\n                    context.startYear-- ;\n                    msg.foryou=\"Backward for one year \"+context.startYear; \n                }\n                if (context.selector==5) { //stat year Selection\n                    context.startHour-- ;\n                    if(context.startHour<0)context.startHour = 23;\n                    msg.foryou=\"Backward for one Hour\"; \n                }\n                \n                if (context.selector==8) {// start day to report \n                    context.toDay-- ;\n                    if(context.toMonth===0 || context.toMonth==2 || context.toMonth==4 || context.toMonth==6 ||\n                       context.toMonth==7 || context.toMonth==9 || context.toMonth==11){\n                      \n                        if(context.toDay <=0)context.toDay=31;\n                    }else if (context.toMonth==2){\n                        if(context.toDay<=0)context.toDay=28;\n                    }else{\n                        if(context.toDay<=0)context.toDay=30;\n                    }\n                    msg.foryou=\"Move to running type \"+context.toDay; \n                    \n                }\n                if (context.selector==9) { //start month selection\n                    context.toMonth--;\n                    if(context.toMonth<0) context.toMonth = 11;\n                    msg.foryou=\"Forward one month\";\n                }\n                if (context.selector==10) { //stat year Selection\n                    context.toYear-- ;\n                    msg.foryou=\"Forward for one year\"; \n                }\n                if (context.selector==11) { //stat year Selection\n                    context.toHour-- ;\n                    if(context.toHour<0)context.toHour=23;\n                    msg.foryou=\"Forward for one Hour\"; \n                }\n                break;\n    case 'b' :  \n        // msg.payload= {group:{ show:[\"House1_Group_4\"], hide:[\"House1_Graphs\"], focus:true}};\n        // msg.page = 'camera';\n        // return [null,null,null,msg,null,null];\n        break;\n    case 'g': //press 'go' button\n        //msg.foryou=\"Settings saved to disk\";\n        //updating msg\n        msg.temperatures=context.temperatures;\n        msg.selector=context.selector;\n        msg.control = context.control;\n        msg.startDay = context.startDay;\n        msg.startMonth = context.startMonth;\n        msg.startYear = context.startYear;\n        msg.startHour = context.startHour;\n        msg.toDay = context.toDay;\n        msg.toMonth = context.toMonth;\n        msg.toYear = context.toYear;\n        msg.toHour = context.toHour;\n        msg.graph = 1;\n        \n        msg.myStatus=context.global.myStatus;\n        msg.foryou= \"Please wait...\";\n        return [null,null,null,null,msg,null];\n                \n    case '1': //break;\n    case '2'://break;\n    case '3'://break;\n    case '4'://break;\n    case '5':\n            //msg.foryou=\"Selecting \"+(parseInt(msg.payload)-4); break;\n    case '6':\n    case '7':\n    case '8':\n    case '9':\n    case '10':\n    case '11':\n    // case '12':\n    // case '13':\n    // case '14':\n    // case '15':\n    // case '16':\n    // case '17':\n    // case '18':\n    // case '19':\n    // case '20':\n    // case '21':\n    // case '22':\n    // case '23':\n    // case '24':\n    // case '25':\n    // case '26':\n    // case '27':\n    // case '28':\n    // case '29':\n    // case '30': //   select DeHum\n               context.selector=parseInt(msg.payload); //selector เป็นตัวเก็บสถานะปัจจุบันของการเลือก\n\n               if (msg.payload=='1') msg.foryou=\"Control Device selection\"; //frost\n               else if (msg.payload=='2') msg.foryou=\"Start day selection\"; //away\n               else if (msg.payload=='3'){msg.foryou=\"Start month selection\";} //day\n               else if (msg.payload=='4') msg.foryou=\"Start year selection\"; //humid\n               else {\n                    // if(context.hourSelected === context.selector) //มีการกดที่ ชั่วโมง ซ้ำ --> สีจะสับเป็น ชมพู-เขียว หรือ เขียว-ชมพู\n                    //     context.frost = !context.frost; //flag บังคับสีเส้นฐาน {เขียว,ชมพู}\n                    // else {\n                    //     context.frost = false; //reset flag to Megenta color\n                    //     context.hourSelected = context.selector;\n                    // }\n                   //context.hourSelected = context.selector;\n                    msg.foryou= \"Select \"  + (parseInt(msg.payload));\n               }       \n        break;\n    case 'c' : //press 'home settings' button\n        msg.page ='setting';\n        msg.payload= {group:{ show:[\"House1_Home\"], hide:[\"House1_Graphs\"], focus:true}};\n        return [null,null,null,msg,null,null];\n    \n    case 'r' : //press 'refresh' button\n        // msg.page ='setting';\n        msg.payload= {group:{ show:[\"House1_Home\"], hide:[\"House1_Graphs\"], focus:true}};\n        msg.topic = \"/house1/state/reload/graphs\";\n        return [null,null,null,null,null,msg];\n        \n    }\n\n//updating msg\nmsg.temperatures=context.temperatures;\nmsg.selector=context.selector;\nmsg.control = context.control;\nmsg.startDay = context.startDay;\nmsg.startMonth = context.startMonth;\nmsg.startYear = context.startYear;\nmsg.startHour = context.startHour;\nmsg.toDay = context.toDay;\nmsg.toMonth = context.toMonth;\nmsg.toYear = context.toYear;\nmsg.toHour = context.toHour;\nmsg.graph = 0;\n\nmsg.myStatus=context.global.myStatus;\nnode.send([msg,null,null,null,null,null]);\n","outputs":6,"noerr":0,"x":774.1000671386719,"y":119.00000190734863,"wires":[["ee1d0173.803e2","a2391291.0c248","ca3b1eea.7ec32"],[],[],["f5f3a8cc.43d8a8","c151aafd.fd6e58"],["21b9c585.cd81ba","fbc10c16.a847c"],["2b2f4ab8.4f94f6"]]},{"id":"e4fe3e99.2bff8","type":"inject","z":"a5f3d8c4.ba3b58","name":"Every minute","topic":"","payload":"t","payloadType":"str","repeat":"60","crontab":"","once":false,"onceDelay":"","x":475.1000061035156,"y":95,"wires":[["27af7028.65aa2"]]},{"id":"4e59f11a.c3627","type":"inject","z":"a5f3d8c4.ba3b58","name":"Once only","topic":"","payload":"1","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"1","x":565.1000061035156,"y":37,"wires":[["27af7028.65aa2","6628aa9c.6b97d4"]]},{"id":"d94934e8.041308","type":"debug","z":"a5f3d8c4.ba3b58","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1203.1000061035156,"y":216,"wires":[]},{"id":"8b618839.56ab68","type":"function","z":"a5f3d8c4.ba3b58","name":"process schedule","func":"var timing=global.get(\"timing2\");\nvar now = new Date();\nmsg.day = (typeof global.get(\"startDay\") != 'undefined')?global.get(\"startDay\"):now.getDay();\nmsg.hour = (typeof global.get(\"startHour\") != 'undefined')?global.get(\"startHour\"):now.getHours();\nmsg.minute = timing[msg.day*24+msg.hour];\nif(typeof(msg.rest=='undefined')) msg.rest = timing[msg.day*24+msg.hour+172];\n\n// if(msg.payload===0){\n//     context.day = now.getDay();\n//     context.hour = now.getHours();\n//     context.minute = timing[(now.getDay()*24)+now.getHours()];\n//     context.rest=timing[169];\n// }\n\n\n// if ( typeof context.day == 'undefined') context.day = now.getDay();\n// if ( typeof context.hour == 'undefined' ) context.hour = now.getHours();\n// if (typeof context.minute == 'undefined') context.minute = timing[(now.getDay()*24)+now.getHours()];\n// if ( typeof context.rest == 'undefined' ) context.rest=timing[(now.getDay()*24)+now.getHours()+172];\n// if ( typeof context.flag == 'undefined')context.flag = false;\n// if (typeof context.pumpstate == 'undefined') context.pumpstate = \"OFF\";\n\n// msg.day = context.day;\n// msg.hour = context.hour;\n// msg.minute = context.minute;\n// msg.rest = context.rest;\n\n// if (msg.payload == \"ON_wATER\"){\n//     context.flag = false;\n//     context.pumpstate = \"ON\";\n// }\n// if (mst.payload == \"OFF_WATER\"){\n//     context.pumpstate = \"OFF\";\n// }\nif (msg.payload==\"s\" || msg.payload == \"u\" || msg.payload == \"d\" || msg.payload == \"anything\" ){\n // load a new schedule; \n // s = save; u = up; d= down\n msg.day = global.get(\"startDay\");\n msg.hour = global.get(\"startHour\");\n msg.minute = timing[(msg.day*24)+msg.hour];\n msg.rest=timing[(msg.day*24)+msg.hour+172];\n\n}\n\n\n// if(msg.rest === 0){\n//     msg.hour +=1; \n//     if(msg.hour>23){ \n//         msg.hour = 0;\n//         msg.day += 1;\n//     }\n//     if(msg.day>6){ //day=0 sunday; day=1 monday; and so on...\n//         msg.day = 0;\n//     }\n//     msg.minute = timing[(msg.day*24)+msg.hour];//load the next rest time;\n//     msg.rest = timing[msg.day*24+msg.hour+172];\n//     context.flag = false;\n// }\n\n// //count down the rest time\n// if (msg.rest>0 && context.flag && msg.payload==\"t\") { \n//     msg.rest--;\n// }else{\n//     context.flag = true;\n// }\n\n\n//context.global.myStatus=\"Heating: \" + ((msg.heatRelay)? \"ON\":\"OFF\") + \" Dehumidifier: \" + ((msg.humidityRelay)? \"ON\":\"OFF\");\n\n\n\nglobal.set(\"myStatus\",\"-\");\nglobal.set(\"startDay\",msg.day);\nglobal.set(\"startHour\",msg.hour);\nglobal.set(\"startMinute\",msg.minute);\nglobal.set(\"restTime\",msg.rest);\n\n\nmsg.settime = (\"0\"+msg.hour).slice(-2)+\":\"+(\"0\"+msg.minute).slice(-2)+\"น.\";//timing[169];\nnode.status({fill:\"blue\",shape:\"dot\",text:\"Set hour \" + msg.settime + \": frost time \" + msg.rest +\" minutes\"});\n//msg.restd = \" \"+msg.rest+\" นาที\";\n//node.send(msg);\nreturn msg;\n\n\n\n\n\n","outputs":1,"noerr":0,"x":1348.1000061035156,"y":888,"wires":[[]]},{"id":"3f16f6db.3daf6a","type":"debug","z":"a5f3d8c4.ba3b58","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":301.1000061035156,"y":843,"wires":[]},{"id":"cfe2aaf7.5b3998","type":"function","z":"a5f3d8c4.ba3b58","name":"Handle FROST","func":"var now  = new Date();\nmsg.day = (typeof global.get(\"startDay\") != 'undefined')?global.get(\"startDay\"):now.getDay();\nmsg.hour = (typeof global.get(\"startHour\") != 'undefined')?global.get(\"startHour\"):now.getHours();\nmsg.minute = timing[msg.day*24+msg.hour];\nmsg.rest = timing[msg.day*24+msg.hour+172];\n\nvar timing=global.get(\"timing2\");\nvar now = new Date();\n\nif (msg.rest===0){\n    msg.colour=\"#aaddff\";\n}else{\n    msg.colour=\"#aaffaa\";   \n}\nif(msg.payload==\"u\"){\n    msg.rest++;\n    if(msg.rest>60)msg.rest=60;\n}\nif(msg.payload==\"d\"){\n    msg.rest--;\n    if(msg.rest<0)msg.rest=0;\n}\nif(msg.payload==\"a\")msg.colour=\"#ffbbbb\";\n\n\nglobal.set(\"startDay\",msg.day);\nglobal.set(\"starHour\",msg.hour);\nglobal.set(\"startMinute\",msg.minute);\nglobal.set(\"startRest\",msg.rest);\n\nreturn msg;","outputs":1,"noerr":0,"x":1357.1000061035156,"y":847,"wires":[[]]},{"id":"7369c507.c858fc","type":"function","z":"a5f3d8c4.ba3b58","name":"Handle START","func":"var now  = new Date();\nmsg.day = (typeof global.get(\"startDay\") != 'undefined')?global.get(\"startDay\"):now.getDay();\nmsg.hour = (typeof global.get(\"startHour\") != 'undefined')?global.get(\"startHour\"):now.getHours();\nmsg.minute = timing[msg.day*24+msg.hour];\nmsg.rest = timing[msg.day*24+msg.hour+172];\n\nvar timing=global.get(\"timing2\");\nvar now = new Date();\n\nif (msg.rest===0){\n    msg.colour=\"#aaddff\";\n}else{\n    msg.colour=\"#aaffaa\";   \n}\nif(msg.payload==\"u\"){\n    msg.minute++;\n    if(msg.minute>60)msg.minute=60;\n}\nif(msg.payload==\"d\"){\n    msg.minute--;\n    if(msg.minute<0)msg.minute=0;\n}\nif(msg.payload==\"a\")msg.colour=\"#ffbbbb\";\n\n\nglobal.set(\"startDay\",msg.day);\nglobal.set(\"starHour\",msg.hour);\nglobal.set(\"startMinute\",msg.minute);\nglobal.set(\"startRest\",msg.rest);\n\nmsg.settime = (\"0\"+msg.hour).slice(-2)+\":\"+(\"0\"+msg.minute).slice(-2)+\"น.\";//timing[169];\nreturn msg;","outputs":1,"noerr":0,"x":1355.1000061035156,"y":939,"wires":[[]]},{"id":"b32c8c1f.9c4ed","type":"inject","z":"a5f3d8c4.ba3b58","name":"","topic":"","payload":"20L/m","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":105.10000610351562,"y":433,"wires":[[]]},{"id":"250ba1cb.78060e","type":"inject","z":"a5f3d8c4.ba3b58","name":"","topic":"","payload":"30L/m","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":107.10000610351562,"y":471,"wires":[[]]},{"id":"bc365454.662ed8","type":"function","z":"a5f3d8c4.ba3b58","name":"getTemperature","func":"\n\nvar output = msg.payload.split(\",\");\n\nmsg.value=parseInt(output[1]);\nmsg.humidity=parseFloat(output[0]);\n\nreturn msg;\n","outputs":1,"noerr":0,"x":331.1000061035156,"y":979,"wires":[["e3306768.c0ada8"]]},{"id":"85dd823a.3a98a","type":"function","z":"a5f3d8c4.ba3b58","name":"toMultipleCharts","func":"\nvar output = msg.payload.split(\",\");\ntemp = {payload:parseInt(output[1]),topic:\"Temp\"};\nheart = {payload:parseInt(output[0]),topic:\"Humid\"};\nvar ret = [];\nret.push(heart);\nret.push(temp);\nreturn [ret];","outputs":1,"noerr":0,"x":351.1000061035156,"y":1086,"wires":[[]]},{"id":"ae1ddd30.3e114","type":"function","z":"a5f3d8c4.ba3b58","name":"getHumidity","func":"function theNewDate()\n{\n   var d = new Date();\n   d.setTime( d.getTime() + 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\n    minutes = d.getMinutes().toString().length == 1 ? '0'+d.getMinutes() : d.getMinutes();\n    hours = d.getHours().toString().length == 1 ? '0'+d.getHours() : d.getHours();\n    //ampm = d.getHours() >= 12 ? 'pm' : 'am';\n    months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n    days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];\n    var m= days[d.getDay()]+' '+months[d.getMonth()]+' '+d.getDate()+' '+d.getFullYear()+' '+hours+':'+minutes;//+ampm;\n    return m;\n}\n\n\nif(global.get(\"heatRelay\") == 'undefined')global.set(\"heatRelay\",0);\n\nvar output = msg.payload.split(\",\");\nmsg.value=parseInt(output[1]);\nmsg.heatRelay=global.get(\"heatRelay\");\nmsg.humidity=parseFloat(output[0]);\n\n\nmsg.topic=theNewDate();\nmsg.payload=\"Humidity: \"+msg.humidity+\"%\" ;\n\nreturn msg;\n","outputs":1,"noerr":0,"x":336.1000061035156,"y":1036,"wires":[["970b7969.9dd788"]]},{"id":"6628aa9c.6b97d4","type":"function","z":"a5f3d8c4.ba3b58","name":"","func":"if(typeof context.flag == 'undefined')context.flag=false;\nif(context.flag){\n    msg.payload = true;\n    msg.mode = \"on\";\n    //node.send({payload: 'ON_WATER',topic:'piedht'});\n}\nelse{\n    msg.payload = false;\n    msg.mode = \"off\"\n    //node.send({payload: 'OFF_WATER',topic:'piedht'});\n}\n\ncontext.flag = !context.flag;\n\nreturn msg;","outputs":1,"noerr":0,"x":322.1000061035156,"y":696,"wires":[["1ff16c3f.706494","3f16f6db.3daf6a"]]},{"id":"b5b51cfb.4a697","type":"inject","z":"a5f3d8c4.ba3b58","name":"","topic":"","payload":"ON","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":88.10000610351562,"y":509,"wires":[["4829889c.806f08"]]},{"id":"32dfb3c3.51f8cc","type":"inject","z":"a5f3d8c4.ba3b58","name":"","topic":"","payload":"OFF","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":87.10000610351562,"y":547,"wires":[["4829889c.806f08"]]},{"id":"753999e5.31b128","type":"function","z":"a5f3d8c4.ba3b58","name":"","func":"if(msg.payload==\"ON_VALVE2\" || msg.payload==\"OFF_VALVE2\"){\n    msg.payload = \"WAIT\";\n    return msg;\n}","outputs":1,"noerr":0,"x":316.1000061035156,"y":620,"wires":[["4890cfeb.4cd1b","7eeeefa5.51cd3"]]},{"id":"a21411cc.421bf","type":"inject","z":"a5f3d8c4.ba3b58","name":"","topic":"","payload":"ON","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":82.10000610351562,"y":583,"wires":[["2ae1bfb8.0134b"]]},{"id":"967de883.099838","type":"inject","z":"a5f3d8c4.ba3b58","name":"","topic":"","payload":"OFF","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":81.10000610351562,"y":619,"wires":[["2ae1bfb8.0134b"]]},{"id":"9d05db53.3b6a38","type":"debug","z":"a5f3d8c4.ba3b58","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":966.1000213623047,"y":354.00000381469727,"wires":[]},{"id":"73306cf1.1d8504","type":"function","z":"a5f3d8c4.ba3b58","name":"Prep","func":"var msg2 = [];\nvar date = [\"Sun\",\"Mon\",\"Thu\",\"Wen\",\"Thr\",\"Fri\",\"Sat\"];\nvar month = ['มค','กพ','มีค','เมษ','มิย','พค','กค','สค','กย','ตค','พย','ธค'];\nvar data = [\n  {\"period\": 1349046000000, \"licensed\": 407, \"sorned\": 660},\n  {\"period\": 1313103600000, \"licensed\": 351, \"sorned\": 629},\n  {\"period\": 1299110400000, \"licensed\": 269, \"sorned\": 618},\n  {\"period\": 1281222000000, \"licensed\": 246, \"sorned\": 661},\n  {\"period\": 1273446000000, \"licensed\": 257, \"sorned\": 667},\n  {\"period\": 1268524800000, \"licensed\": 248, \"sorned\": 27},\n  {\"period\": 1263081600000, \"licensed\": 171, \"sorned\": 660},\n  {\"period\": 1260403200000, \"licensed\": 171, \"sorned\": 676},\n  {\"period\": 1254870000000, \"licensed\": 3201, \"sorned\": 656},\n  {\"period\": 1253833200000, \"licensed\": 3215, \"sorned\": 622}\n];\n// this is the logic when there are multiple data sets are received\nvar output = [];\nif(msg.control === 0) //temperature/humidity graph\nfor (var i=0; i<msg.payload.length; i++) {\n    var tmp = [];\n    var hum = [];\n    var ep = [];\n    for (var j=0; j<msg.payload[i].length; j++) {\n        // tmp.push([msg.payload[i][j].epoch, msg.payload[i][j].temp]);\n        // hum.push([msg.payload[i][j].epoch, msg.payload[i][j].humid]);\n        //if(j===0){\n             var d = new Date(msg.payload[i][j].period);\n             d.setTime( d.getTime() - 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\n             msg.payload[i][j].period = d.getTime();\n        //}\n        output.push(msg.payload[i][j]);\n\n    }\n    // if(tmp.length>0) msg2.push({ key: msg.payload[i][0].sID+\"/Temperature\", values : tmp});\n    // if(humid.length>0)msg2.push({ key: msg.payload[i][0].sID+\"/Humidity\", values : hum});\n    \n    //msg2.push({ key: \"test\", values : output});\n}\nif(msg.control==1){ //solar device\n\n}\n\nif(msg.control==2 || msg.control==3) //valve1 and valve 2\nfor (var i=0; i<msg.payload.length; i++) {\n    var tmp = [];\n    var hum = [];\n    var ep = [];\n    for (var j=0; j<msg.payload[i].length; j++) {\n        // tmp.push([msg.payload[i][j].epoch, msg.payload[i][j].temp]);\n        // hum.push([msg.payload[i][j].epoch, msg.payload[i][j].humid]);\n        //if(j===0){\n             var d = new Date(msg.payload[i][j].Time);\n             //d.setTime( d.getTime() - 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\n             msg.payload[i][j].Time = d.getDate()+month[d.getMonth()]+\" \"+(\"0\"+d.getHours()).slice(-2)+\":\"+(\"0\"+d.getMinutes()).slice(-2);\n        //}\n        if(i===0)\n            output.push(msg.payload[i][j]);\n        else if(i==1)\n            msg.lites = msg.payload[i][j].QTY;\n    }    \n}\n\nif(msg.control == 4){ //Battery device\n    var sel = global.get(\"test_count\");\n    if(sel==1){\n        output = [\n  {\"period\": 1349046000000, \"licensed\": 3407, \"sorned\": 660},\n  {\"period\": 1313103600000, \"licensed\": 3351, \"sorned\": 629},\n  {\"period\": 1299110400000, \"licensed\": 3269, \"sorned\": 618},\n  {\"period\": 1281222000000, \"licensed\": 3246, \"sorned\": 661},\n  {\"period\": 1273446000000, \"licensed\": 3257, \"sorned\": 667},\n  {\"period\": 1268524800000, \"licensed\": 3248, \"sorned\": 827},\n  {\"period\": 1263081600000, \"licensed\": 3171, \"sorned\": 660},\n  {\"period\": 1260403200000, \"licensed\": 3171, \"sorned\": 676},\n  {\"period\": 1254870000000, \"licensed\": 3201, \"sorned\": 656},\n  {\"period\": 1253833200000, \"licensed\": 3215, \"sorned\": 622}\n];\n    }else{\n        output =  [\n  {\"period\": 1349046000000, \"licensed\": 3407, \"sorned\": 166},\n  {\"period\": 1313103600000, \"licensed\": 3351, \"sorned\": 162},\n  {\"period\": 1299110400000, \"licensed\": 3269, \"sorned\": 161},\n  {\"period\": 1281222000000, \"licensed\": 3246, \"sorned\": 166},\n  {\"period\": 1273446000000, \"licensed\": 3257, \"sorned\": 166},\n  {\"period\": 1268524800000, \"licensed\": 3248, \"sorned\": 182},\n  {\"period\": 1263081600000, \"licensed\": 3171, \"sorned\": 166},\n  {\"period\": 1260403200000, \"licensed\": 3171, \"sorned\": 167},\n  {\"period\": 1254870000000, \"licensed\": 3201, \"sorned\": 165},\n  {\"period\": 1253833200000, \"licensed\": 3215, \"sorned\": 162}\n];\n    }\n}\n\nif(msg.control === 5) //temperature/humidity graph\nfor (var i=0; i<msg.payload.length; i++) {\n    var tmp = [];\n    var hum = [];\n    var ep = [];\n    for (var j=0; j<msg.payload[i].length; j++) {\n        // tmp.push([msg.payload[i][j].epoch, msg.payload[i][j].temp]);\n        // hum.push([msg.payload[i][j].epoch, msg.payload[i][j].humid]);\n        //if(j===0){\n             var d = new Date(msg.payload[i][j].period);\n             d.setTime( d.getTime() - 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\n             msg.payload[i][j].period = d.getTime();\n        //}\n        output.push(msg.payload[i][j]);\n\n    }\n    // if(tmp.length>0) msg2.push({ key: msg.payload[i][0].sID+\"/Temperature\", values : tmp});\n    // if(humid.length>0)msg2.push({ key: msg.payload[i][0].sID+\"/Humidity\", values : hum});\n    \n    //msg2.push({ key: \"test\", values : output});\n}\n\n// msg.payload=msg2;\n//msg.payload = [ { key: \"Power\", values : output} ];\n//msg.topic = \"Power\";\nmsg.payload = output;\nreturn msg;","outputs":1,"noerr":0,"x":779.1000747680664,"y":303.00000381469727,"wires":[["ee1d0173.803e2","94bbba0b.bfb348"]]},{"id":"a73f0692.6e4d58","type":"join","z":"a5f3d8c4.ba3b58","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":823.1000061035156,"y":382,"wires":[["73306cf1.1d8504","9d05db53.3b6a38"]]},{"id":"44f12f22.b76da","type":"mysql","z":"a5f3d8c4.ba3b58","mydb":"a77c9e11.23eb6","name":"climate","x":1096.8500061035156,"y":426,"wires":[["a73f0692.6e4d58"]]},{"id":"21b9c585.cd81ba","type":"function","z":"a5f3d8c4.ba3b58","name":"SQL","func":"// This will handle any device and any attribute as long as it is in the DB\n\nvar sd = new Date(parseInt(msg.startYear)+1957,msg.startMonth,msg.startDay,msg.startHour,0,0);\n//sd.setTime( sd.getTime() + 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\nvar ed = new Date((parseInt(msg.toYear)+1957),msg.toMonth,msg.toDay,msg.toHour,0,0);\n//ed.setTime( ed.getTime() + 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\n\nvar fromdate = sd.getTime();\nvar enddate = ed.getTime();\nvar output = [];\nif(msg.control===0){//temp (temperature/humidity) report\n    output.push({topic: \"SELECT epoch as period, temp as temp,humid as humid from climate INNER JOIN sensor on climate.s_id = sensor.s_id \"+\n                    \"where sensor.s_id = 1 AND epoch >= \" + fromdate + \" AND epoch <= \" + enddate+\" order by epoch desc\"});\n}else if(msg.control==2){ //water on valve-1 report\n    output.push({topic: \"SELECT start_time as Time, qty as Lite from water \"+\n                    \"where start_time >= \" + fromdate + \" AND start_time <= \" + enddate+\" AND pump_id=3 order by start_time asc\"});\n\n    output.push({topic: \"SELECT sum(qty) as QTY from  water \"+\n                    \"where start_time >= \" + fromdate + \" AND start_time <= \" + enddate+\" AND pump_id=3 order by start_time asc\"});\n\n}else if(msg.control==3){ //water on valve-2 report4;\n    output.push({topic: \"SELECT start_time as Time, qty as Lite from water \"+\n                    \"where start_time >= \" + fromdate + \" AND start_time <= \" + enddate+\" AND pump_id=4 order by start_time asc\"});\n\n    output.push({topic: \"SELECT sum(qty) as QTY from  water \"+\n                    \"where start_time >= \" + fromdate + \" AND start_time <= \" + enddate+\" AND pump_id=4 order by start_time asc\"});\n\n}else if (msg.control ==5){\n    output.push({topic: \"SELECT epoch as period, value as moisture from soil inner join sensor on soil.s_id=sensor.s_id \"+\n                        \"where soil.s_id=11 AND epoch >= \" + fromdate + \" AND epoch <= \" + enddate+\" order by epoch desc\"});\n}\n\nelse{\n    output.push({topic: \"SELECT epoch as period, temp as licensed,humid as sorned from climate INNER JOIN sensor on climate.s_id = sensor.s_id \"+\n                    \"where sensor.s_id = 1 AND epoch >= \" + fromdate + \" AND epoch <= \" + enddate+\" limit 0,30\"});\n}        \n//output.push({ topic: \"SELECT * FROM sensor_data WHERE device_no='T001' AND sensor_type='temperature' AND epoch >= \" + fromdate + \" AND epoch <= \" + enddate});\n//output.push({ topic: \"SELECT * FROM sensor_data WHERE device_no='H001' AND sensor_type='humidity' AND epoch >= \" + fromdate + \" AND epoch <= \" + enddate});\n\n// output.push({control:msg.control});\noutput[output.length-1].temperatures = msg.temperatures;\noutput[output.length-1].selector = msg.selector;\noutput[output.length-1].control = msg.control;\noutput[output.length-1].graph = 1;\n\noutput[output.length-1].startDay = msg.startDay;\noutput[output.length-1].startMonth = msg.startMonth;\noutput[output.length-1].startYear = msg.startYear;\noutput[output.length-1].startHour = msg.startHour;\n\noutput[output.length-1].toDay = msg.toDay;\noutput[output.length-1].toMonth = msg.toMonth;\noutput[output.length-1].toYear = msg.toYear;\noutput[output.length-1].toHour = msg.toHour;\noutput[output.length-1].control = msg.control;\n\n\noutput[output.length-1].complete=true;\n//output[output.length-1].control=1;\n\nreturn [ output ];\n//msg.complete=true;\n//return [output];\n\n\n//msg.topic = \"SELECT * FROM sensor_data WHERE device='growatt' AND sensor='power' AND epoch >= \" + fromdate + \" AND epoch <= \" + epoch ;\n//return msg;","outputs":1,"noerr":0,"x":1167.1000213623047,"y":276.00000381469727,"wires":[["44f12f22.b76da","9441f0a7.13481"]]},{"id":"4dbc9052.9ad42","type":"inject","z":"a5f3d8c4.ba3b58","name":"","topic":"","payload":"555","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":85.10000610351562,"y":293,"wires":[["dcad5561.73bfe8"]]},{"id":"dcad5561.73bfe8","type":"function","z":"a5f3d8c4.ba3b58","name":"","func":"seed = Math.round(Math.random()*1000);\n\nvar data= [];\ndata.push({ day: 'Monday', pushups: seed/20, beers: seed/2 });\ndata.push({ day: 'Tuesday', pushups: seed/10, beers: seed/2 });\ndata.push({ day: 'Wednesday', pushups: seed/5, beers: seed/3 }),\ndata.push({ day: 'Thursday', pushups: seed/5, beers: seed/4 }),\ndata.push({ day: 'Friday', pushups: seed/20, beers: seed/1 });\n \n\n\nmsg.payload = data;\n//updating msg\nmsg.temperatures=25;\nmsg.timing=global.get(\"timing2\");\nmsg.days=1;\nmsg.selector=1;\nmsg.hourSelected = 1;\nmsg.frost = 4;\nmsg.control = 0;\nmsg.run = 1;\nmsg.record = 1;\n\n\nmsg.myStatus=\"graph\";\nmsg.report=msg.payload;\nmsg.payload = [data];\nreturn msg;","outputs":1,"noerr":0,"x":295.88976287841797,"y":277.9232940673828,"wires":[[]]},{"id":"94bbba0b.bfb348","type":"debug","z":"a5f3d8c4.ba3b58","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1108.8898010253906,"y":332.0454406738281,"wires":[]},{"id":"53a9ec38.2aa4f4","type":"inject","z":"a5f3d8c4.ba3b58","name":"","topic":"","payload":"ttt","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":79.11421203613281,"y":332.0056629180908,"wires":[["dcad5561.73bfe8"]]},{"id":"9441f0a7.13481","type":"debug","z":"a5f3d8c4.ba3b58","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1329.5176086425781,"y":261.678955078125,"wires":[]},{"id":"491c331e.9f7c7c","type":"switch","z":"a5f3d8c4.ba3b58","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"/house1/state/spray","vt":"str"},{"t":"eq","v":"/house1/state/fan","vt":"str"},{"t":"eq","v":"/house1/state/valve1","vt":"str"},{"t":"eq","v":"/house1/state/dht","vt":"str"},{"t":"eq","v":"/house1/state/error","vt":"str"},{"t":"eq","v":"/house1/state/valve2","vt":"str"},{"t":"eq","v":"/house1/state/solarcell","vt":"str"},{"t":"eq","v":"/house1/state/soil","vt":"str"},{"t":"eq","v":"/house1/state/reload/homeG","vt":"str"},{"t":"eq","v":"/house1/state/reload/graphs","vt":"str"}],"checkall":"true","repair":false,"outputs":10,"x":86.10000610351562,"y":877.0000114440918,"wires":[["c08ff6ed.128838"],["4829889c.806f08"],["2ae1bfb8.0134b"],["bc365454.662ed8","ae1ddd30.3e114","85dd823a.3a98a"],["f1b6a5b8.e90d38"],["4890cfeb.4cd1b"],["78e56703.1cf498","7fbfea59.d71214"],["c0a17e78.ff756"],["9cf3f12c.60f39"],["1753cad4.d4f655"]]},{"id":"398e23ca.6d8f6c","type":"mqtt in","z":"a5f3d8c4.ba3b58","name":"","topic":"/house1/state/#","qos":"2","broker":"5ac6ecde.6c6a94","x":85,"y":995.0001220703125,"wires":[["491c331e.9f7c7c","4a5b6cb2.a9bdb4"]]},{"id":"2b2f4ab8.4f94f6","type":"mqtt out","z":"a5f3d8c4.ba3b58","name":"/house1/control/#","topic":"","qos":"","retain":"","broker":"5ac6ecde.6c6a94","x":751.0999946594238,"y":633.0000114440918,"wires":[]},{"id":"4a5b6cb2.a9bdb4","type":"debug","z":"a5f3d8c4.ba3b58","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":565.2000427246094,"y":839,"wires":[]},{"id":"6780be0e.81d08","type":"debug","z":"a5f3d8c4.ba3b58","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":677.0999755859375,"y":428,"wires":[]},{"id":"f1b6a5b8.e90d38","type":"function","z":"a5f3d8c4.ba3b58","name":"error msg","func":"function theNewDate()\n{\n   var d = new Date();\n   d.setTime( d.getTime() + 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\n    minutes = d.getMinutes().toString().length == 1 ? '0'+d.getMinutes() : d.getMinutes();\n    hours = d.getHours().toString().length == 1 ? '0'+d.getHours() : d.getHours();\n   // ampm = d.getHours() >= 12 ? 'pm' : 'am';\n    months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n    days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];\n    var m= days[d.getDay()]+' '+months[d.getMonth()]+' '+d.getDate()+' '+d.getFullYear()+' '+hours+':'+minutes;\n    return m;\n}\n\n\nmsg.topic=theNewDate();\nmsg.value = 0;\nreturn msg;\n","outputs":1,"noerr":0,"x":340.10001373291016,"y":1142.0000190734863,"wires":[["970b7969.9dd788","e3306768.c0ada8"]]},{"id":"63d169ec.6aa188","type":"function","z":"a5f3d8c4.ba3b58","name":"","func":"if(msg.payload==\"ON_FAN\" || msg.payload==\"OFF_FAN\"){\n    msg.payload = \"WAIT\";\n    return msg;\n}\n\n","outputs":1,"noerr":0,"x":420.10000228881836,"y":295.0000057220459,"wires":[["4829889c.806f08"]]},{"id":"f03e6ec4.c399","type":"function","z":"a5f3d8c4.ba3b58","name":"","func":"if(msg.payload==\"ON_SPRAY\" || msg.payload==\"OFF_SPRAY\"){\n    msg.payload = \"WAIT\";\n    return msg;\n}\n\n","outputs":1,"noerr":0,"x":286.1000061035156,"y":343,"wires":[["c08ff6ed.128838"]]},{"id":"f5f3a8cc.43d8a8","type":"ui_ui_control","z":"a5f3d8c4.ba3b58","name":"","x":1208.1002197265625,"y":89,"wires":[[]]},{"id":"4829889c.806f08","type":"ui_template","z":"a5f3d8c4.ba3b58","group":"f01c7bf6.313058","name":"FAN","order":4,"width":"1","height":"1","format":"\n\n                <!--<md-button id=\"btn\" class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'ON_WATER',topic:'piedht'})\"> -->\n                <!--<img style=\"outline : none;\" -->\n                <!--             ng-src=\"{{(msg.payload)?'/scripts/manual-2.png':'/scripts/manual-2.png'}}\" -->\n                <!--              height=\"36px\"-->\n                <!--/>-->\n                <!--</md-button> -->\n                \n\n                \n<script>\n   (function(scope){\n        scope.$watch('msg', function(msg) {\n             if(msg.payload==\"WAIT\"){\n                $(\"#fan2\").css(\"background-color\",\"#aaddff\"); \n                $(\"#fan2\").text(\"Waiting\"); \n            } else if (msg.payload!=\"\" && msg.payload==\"ON\"){\n                 $(\"#fan2\").text(msg.payload);\n                 $(\"#fan2\").css(\"background-color\",\"#88ff88\"); \n                 msg.mode = \"ON\";\n             }else if (msg.payload!=\"\" && msg.payload==\"OFF\"){\n                 $(\"#fan2\").text(msg.payload);\n                 $(\"#fan2\").css(\"background-color\",\"#ff8888\"); \n                 msg.mode = \"OFF\";\n             }\n             \n            //  if (msg.colour!=\"\") $(\"#infor\").css(\"background-color\",msg.colour);\n        });\n \n    })(scope);\n</script>\n<table  ng-click=\"(msg.mode=='ON')?send({payload:'OFF_FAN',topic:'/house1/control/fan'}):send({payload:'ON_FAN',topic:'/house1/control/fan'})\" width=100% height=100% class=\"vibrate zui-table zui-table-rounded\">\n    <thead>\n        <tr>\n            <th>FAN</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr >\n            <td id=\"fan2\"></td>\n        </tr>\n\n    </tbody>\n</table>\n\n","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":421.1000061035156,"y":344.0000057220459,"wires":[["6780be0e.81d08","2b2f4ab8.4f94f6","63d169ec.6aa188"]]},{"id":"4890cfeb.4cd1b","type":"ui_template","z":"a5f3d8c4.ba3b58","group":"f01c7bf6.313058","name":"Valve-2","order":6,"width":"1","height":"1","format":"<script>\n   (function(scope){\n        scope.$watch('msg', function(msg) {\n            // if (msg.payload!=\"\") $(\"#infor\").text(Number(parseInt(msg.payload)).toLocaleString('en-GB')+\"L/h\");\n            // if (msg.colour!=\"\") $(\"#infor\").css(\"background-color\",msg.colour);\n             \n            if(msg.payload==\"WAIT\"){\n                $(\"#valve_22\").css(\"background-color\",\"#aaddff\"); \n                $(\"#valve_22\").text(\"Waiting\"); \n            }else if(msg.payload == \"ON\"){\n                $(\"#valve_22\").text(\"ON\");\n                $(\"#valve_22\").css(\"background-color\",\"#88ff88\"); \n                msg.mode=\"ON\";\n             }else{// if (msg.payload!=\"\" && msg.payload==\"OFF\"){\n                $(\"#valve_22\").text(\"OFF\");\n                $(\"#valve_22\").css(\"background-color\",\"#ff8888\");\n                 //if (msg.colour!=\"\") $(\"#infor\").css(\"background-color\",msg.colour);\n                msg.mode = \"OFF\";\n             }\n        });\n \n    })(scope);\n</script>\n<table  ng-click=\"(msg.mode=='ON')?send({payload:'OFF_VALVE2',topic:'/house1/control/valve2'}):send({payload:'ON_VALVE2',topic:'/house1/control/valve2'})\" width=100% height=100% class=\"vibrate zui-table zui-table-rounded\">\n    <thead>\n        <tr>\n            <th>VALVE2</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr >\n            <td id=\"valve_22\"></td>\n        </tr>\n\n    </tbody>\n</table>\n","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":327.1000061035156,"y":534.0000076293945,"wires":[["753999e5.31b128","2b2f4ab8.4f94f6","6780be0e.81d08"]]},{"id":"1ff16c3f.706494","type":"ui_template","z":"a5f3d8c4.ba3b58","group":"f01c7bf6.313058","name":"Hand ICON","order":7,"width":"1","height":"1","format":"  <md-button  class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"(msg.payload)?send({payload:'OFF_FAN',topic:'/control/fan'}):send({payload:'ON_FAN',topic:'/control/fan'})\"> \n                <img style=\"outline : none;\" \n                             ng-src=\"{{(msg.payload)?'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/autometic1.jpg':'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/manual1.jpg'}}\" \n                              height=\"36px\"\n                />\n</md-button> ","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":472.1000061035156,"y":645.0000066757202,"wires":[["8fd96468.906d78","6628aa9c.6b97d4","2b2f4ab8.4f94f6","6780be0e.81d08"]]},{"id":"e3306768.c0ada8","type":"ui_template","z":"a5f3d8c4.ba3b58","group":"f01c7bf6.313058","name":"newergauge","order":1,"width":"3","height":"3","format":"<!--<script type=\"text/javascript\" src=\"http://www.chanthaburi.buu.ac.th/~phaitoon/public/scripts/gauge.min.js\"></script>-->\n<script src=\"//cdn.rawgit.com/Mikhus/canvas-gauges/gh-pages/download/2.1.5/radial/gauge.min.js\"></script>\n<script>\n\n\n   (function(scope){\n        scope.$watch('msg', function(msg) {\n           gauge.value=msg.value;\n           gauge.heat=msg.heatRelay;\n           gauge.humidity=msg.humidityRelay;\n           gauge.draw();\n        });\n    })(scope);\n    \nvar gauge = new RadialGauge({\n    renderTo: 'canvas-id2',\n    width: 160,\n    height: 160,\n    heat: 0,\n    humidity: 0,\n    units: \"Degrees C\",\n    title: \"Heating\",\n    minValue: 10,\n    maxValue: 40,\n    majorTicks: [\n        '10',\n        '15',\n        '20',\n        '25',\n        '30',\n        '35',\n        '40'\n    ],\n    minorTicks: 5,\n    strokeTicks: true,\n   highlights  : [\n        { from : 10,  to : 15, color : '#8888ff' },\n        { from : 15, to : 20, color :  '#88ff88' },\n        { from : 20, to : 25, color :  '#ffff00' },\n        { from : 25, to : 30, color :  '#ff8888' },\n        { from : 30, to : 35, color :  '#ff8000' },\n        { from : 35, to : 40, color :  '#ff0000' }\n    ],\n\n    colorPlate: \"#fff\",\n    borderShadowWidth: 0,\n    borders: true,\n    needleType: \"arrow\",\n    valueInt: 2,\n    valueDec:0,\n    needleWidth: 2,\n    fontTitleSize: 42,\n    needleCircleSize: 14,\n    needleCircleOuter: true,\n    needleCircleInner: false,\n    animationDuration: 500,\n    animationRule: \"linear\"\n}).draw();\n\n\ngauge.on('beforeNeedle', function () {\n        // getting canvas 2d drawing context\n        var context = this.canvas.context;\n        // we can use gauge context special 'max' property which represents\n        // gauge radius in a real pixels and calculate size of relative pixel\n        // for our drawing needs\n        var pixel = context.max / 100;\n        // step out our circle center coordinate by 30% of its radius from\n        // gauge center\n        var centerX = 36 * pixel;\n        // stay in center by Y-coordinate\n        var centerY = 0;\n        // use circle radius equal to 5%\n        var radius = 10 * pixel;\n        // save previous context state\n        context.save();\n        \n        // draw circle using canvas JS API\n        context.beginPath();\n        context.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);\n        context.fillStyle = (this.heat) ? '#ff0000' : '#8888';\n        context.fill();\n        context.closePath();\n\n        context.beginPath();\n        context.arc(centerX-(72 * pixel), centerY, radius, 0, 2 * Math.PI, false);\n        context.fillStyle = (this.humidity) ? '#00dd88' : '#888888';\n        context.fill();\n        context.closePath();\n        // restore previous context state to prevent break of\n        // further drawings        \n        \n        context.restore();\n       // context.draw();\n    });\n\ngauge.value = 0;\n\n\n</script>\n<canvas style=\"outline: none;\" ng-click=\"send({payload: ' '})\" id=\"canvas-id2\"></canvas>\n<!--<canvas style=\"outline: none;\" ng-click=\"send({payload: ' '})\" id=\"canvas-id3\"></canvas>-->","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":835.1000061035156,"y":921,"wires":[[]]},{"id":"c0a17e78.ff756","type":"ui_template","z":"a5f3d8c4.ba3b58","group":"f01c7bf6.313058","name":"Soil","order":8,"width":"1","height":"1","format":"<script>\n   (function(scope){\n        scope.$watch('msg', function(msg) {\n            // if (msg.payload!=\"\") $(\"#infor\").text(Number(parseInt(msg.payload)).toLocaleString('en-GB')+\"L/h\");\n            // if (msg.colour!=\"\") $(\"#infor\").css(\"background-color\",msg.colour);\n             \n            if(msg.payload==\"WAIT\"){\n                $(\"#soil2\").css(\"background-color\",\"#aaddff\"); \n                 $(\"#soil2\").text(\"Waiting\"); \n            } else if (msg.payload!=\"\" && parseInt(msg.payload)>=0){\n                $(\"#soil2\").text(Number(parseInt(msg.payload)).toLocaleString('en-GB')+\"%\");\n                $(\"#soil2\").css(\"background-color\",\"#88ff88\"); \n                msg.mode = \"ON\";\n             }else if(msg.payload == \"ON\"){\n                $(\"#soil2\").text(\"ON\");\n                $(\"#soil2\").css(\"background-color\",\"#88ff88\"); \n                msg.mode=\"ON\";\n             }else{// if (msg.payload!=\"\" && msg.payload==\"OFF\"){\n                $(\"#soil2\").text(\"OFF\");\n                $(\"#soil2\").css(\"background-color\",\"#ff8888\");\n                 //if (msg.colour!=\"\") $(\"#infor\").css(\"background-color\",msg.colour);\n                msg.mode = \"OFF\";\n             }\n        });\n \n    })(scope);\n</script>\n\n<table ng-click=\"send({payload: 'a'})\" width=100% height=100% class=\"vibrate zui-table zui-table-rounded\">\n    <thead>\n        <tr>\n            <th>SOIL</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr>\n            <td id=\"soil2\"></td>\n    \n        </tr>\n\n\n    </tbody>\n</table>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":383.1000061035156,"y":790.0000104904175,"wires":[[]]},{"id":"970b7969.9dd788","type":"ui_template","z":"a5f3d8c4.ba3b58","group":"f01c7bf6.313058","name":"STATUS","order":9,"width":"3","height":"1","format":"<script>\n   (function(scope){\n        scope.$watch('msg', function(msg) {\n             if (msg.topic!=\"\") $(\"#hdr1\").text(msg.topic);\n             if (msg.payload!=\"\") $(\"#bod1\").text(msg.payload);\n        });\n    })(scope);\n</script>\n\n<table ng-click=\"send({payload: 'a'})\" width=100% height=100% class=\"zui-table zui-table-rounded\">\n    <thead>\n        <tr>\n            <th id=\"hdr1\">></th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr>\n            <td id=\"bod1\"></td>\n    \n        </tr>\n\n    </tbody>\n</table>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":843.1000175476074,"y":745.0000123977661,"wires":[[]]},{"id":"ee1d0173.803e2","type":"ui_template","z":"a5f3d8c4.ba3b58","group":"f01c7bf6.313058","name":"Settings page","order":2,"width":"6","height":"6","format":"<style>\n.thedays { vertical-align:bottom; height:54px; }\n.the2px  { background-color:black; height:2px; }\n.the2px_green  { background-color:green; height:2px; }\n.theblocks {width:100%; height:0%; background-color:green; }\n.greybuttons { background-color:#dddddd !important; width:48px; }\n.thetemps { font-size:70%; color:#888888 !important; }\n.smallheadings { color:black; font-size:80%; }\n.smallheadings2 { color:blue; font-size:80%; font-weight: bold; }\n\n</style>\n\n<script>\n\n// var d=new Date();\n// if ( typeof context.selector == 'undefined' ) context.selector=1;\n// if ( typeof context.saving == 'undefined' ) context.saving=0;\n// if ( typeof context.control == 'undefined' ) context.control=0;\n// if ( typeof context.startDay == 'undefined') context.startDay = d.getDay();\n// if ( typeof context.startMonth == 'undefined') context.startMonth = d.getMonth();\n// if ( typeof context.startYear == 'undefined') context.startYear = d.getYear()-57;\n// if ( typeof context.startHour == 'undefined') context.startHour = d.getHours();\n// if ( typeof context.toDay == 'undefined') context.toDay = d.getDay();\n// if ( typeof context.toMonth == 'undefined') context.toMonth = d.getMonth();\n// if ( typeof context.toYear == 'undefined') context.toYear = d.getYear()-57;\n// if ( typeof context.toHour == 'undefined') context.toHour = d.getHours();\n\n// if(msg.temperature==\"\")msg.temperatures=context.temperatures;\n// if(msg.selector==\"\")msg.selector=context.selector;else context.temperature=msg.temperature;\n// if(msg.control==\"\")msg.control = context.control;else context.control=msg.control;\n// if(msg.startDay==\"\")msg.startDay = context.startDay;\n// if(msg.startMonth==\"\")msg.startMonth = context.startMonth;else contexxt.startMonth = msg.startMonth;\n// if(msg.startYear==\"\")msg.startYear = context.startYear;else context.startYear=msg.startYear;\n// if(msg.startHour==\"\")msg.startHour = context.startHour;else context.startHour=msg.startHour;\n// if(msg.toDay==\"\") msg.toDay = context.toDay;else context.toDay = msg.toDay;\n// if(msg.toMonth==\"\")msg.toMonth = context.toMonth;else context.toMonth = msg.toMonth;\n// if(msg.toYear==\"\")msg.toYear = context.toYear;else context.toYear = msg.toYear;\n// if(msg.toHour==\"\")msg.toHour = context.toHour;else context.toHour = msg.toHour;\n\nvar controls =[\"water_icon2.png\",\"fan_icon2.png\",\"solar_icon2.png\"];\nvar months2 = [\"มค\",\"กพ\",\"มีค\",\"เมย\",\"พค\",\"มิย\",\"กค\",\"สค\",\"กย\",\"ตค\",\"พย\",\"ธค\"];\nvar days = [\"อา\",\"จ\",\"อ\",\"พ\",\"พฤ\",\"ศ\",\"ส\"];\nvar colors= [\"#55dd55\",\"#55ddaa\",\"#55ccdd\",\"#5599ff\",\"#5577ff\",\"#6666ff\",\"#8888ff\",\"#88ff88\",\"#ff8888\",\"#ff0000\",\"#ff8000\",\"#0b62a4\", \"#7a92a3\", \"#4da74d\", \"#afd8f8\", \"#edc240\", \"#cb4b4b\", \"#9440ed\"];\nvar reports = [\"TEMP\",\"SOLAR\",\"VALVE1\",\"VALVE2\",\"BATT\",\"SOIL\"];\n\nvar last = 1;\n\nfunction selec(val, sta) {\n  var w = \"#dtd\" + val;\n  if (sta==1) $(w).css('background-color', 'magenta');\n  else if (sta ==2) $(w).css('background-color', '#55dd55');\n  else $(w).css('background-color', 'black');\n}\n  \n(function(scope) {\n  scope.$watch('msg', function(msg) {\n    selec(last, 0);\n    last = msg.selector;\n    //if(typeof last == 'undefined')last = 1;\n    selec(last,2);\n    \n    \n    if(last==1){\n        selec(12,1);selec(0,2);selec(1,2);\n    } else {selec(12,0);selec(0,0);selec(1,0);}\n    \n    if(last>=2 && last <=5)selec(13,1);\n    else selec(13,0);\n    if(last>=8 && last <=11)selec(15,1);\n    else selec(15,0);\n    \n    //for (var x = 1; x <= 12; x++) {\n      //var w = \"#td\" + x;\n      //(msg.control*340)+\n//      bar(w, msg.timing[(msg.control*340)+((msg.days - 1) * 24) + x]);\n//      var v = \"#v\" + x;\n//      $(v).text(msg.timing[(msg.control*340)+((msg.days - 1) * 24) + x]+\"m\")\n//      var f = \"#f\" + x;\n//      $(f).text((\"0\"+msg.timing[(msg.control*340)+170+((msg.days - 1) * 24) + x]).slice(-2));\n    \n      \n    //   if(msg.days==day && x==hour){\n    //       $(\"#td\"+(x+5)).css('background-color', 'red');\n    //   }\n    //}\n    // for (var x = 0; x < 2; x++) {\n    //   var w = \"#s\" + x;\n    //   $(w).text(msg.timing[172+((msg.days - 1) * 24) + msg.hourSelected] + \"min\");\n    // }\n    //$(\"#s0\").html(\"<img src='http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/\"+controls[msg.control]+\"' height='30px'/>\");//รูปการควบคุม\n    $(\"#s0\").html(\"<center><span class='smallheadings2'>\"+reports[msg.control]+\"</span></center>\");   \n    $(\"#sd0\").text((\"0\"+msg.startDay).slice(-2));//(msg.timing[172+((msg.days - 1) * 24) + msg.hourSelected] + \"min\");\n    $(\"#sd1\").text(months2[msg.startMonth]);\n    $(\"#sd2\").text((\"0\"+msg.startYear).slice(-2));\n    $(\"#sd3\").text((\"0\"+msg.startHour).slice(-2)+\":00\");\n    \n    $(\"#sd4\").text((\"0\"+msg.toDay).slice(-2));//(msg.timing[172+((msg.days - 1) * 24) + msg.hourSelected] + \"min\");\n    $(\"#sd5\").text(months2[msg.toMonth]);\n    $(\"#sd6\").text((\"0\"+msg.toYear).slice(-2));\n    $(\"#sd7\").text((\"0\"+msg.toHour).slice(-2)+\":00\");\n    //$(\"#d0\").text(thedays[msg.days - 1]);\n    // if ((last > 4) && (last < 29))\n    //   $(\"#current\").text(msg.timing[((msg.days - 1) * 24) + last - 5] + \"C\");\n    // else\n    //   $(\"#current\").text(\"-\");\n    \n\n   myStatus=msg.myStatus;\n   if (msg.foryou != \"\")\n   {\n       $(\"#info\").text(msg.foryou);\n       var tm = setTimeout(function() {\n             $(\"#info\").text(myStatus);\n             clearTimeout(tm);\n       }, 3000);\n    }\n    if(msg.report != \"\"){\n        // $(\"#g0\").text(\"<div id='pushups'></div>\");\n        // .html(\"<div id='pushups' style='height: 160px; direction: ltr;'></div>\");\n\n    }\n\n\n    // if(parseInt(msg.control)===0 && parseInt(msg.graph)==1){ $(\"#charts\").append(\"<div id='chart_0' style='width: 100%; height: 170px '></div>\");$(\"#info\").text(\"Controller is \"+msg.control);}\n    // else if(parseInt(msg.control)==1 && parseInt(msg.graph)==1){ $(\"#charts\").append(\"<div id='chart_1' style='width: 100%; height: 170px '></div>\");$(\"#info\").text(\"Controller is \"+msg.control);}\n    // else if(parseInt(msg.control)==2 && parseInt(msg.graph)==1){ $(\"#charts\").append(\"<div id='chart_2' style='width: 100%; height: 170px '></div>\");$(\"#info\").text(\"Controller is \"+msg.control);}\n    // $(\"#charts\").append(\"<div id='chart_0' style='width: 100%; height: 170px '></div>\");$(\"#info\").text(\"Controller is \"+msg.control);    \n    control = (msg.control!=\"\")?parseInt(msg.control):0;//context.control;\n    graph = (msg.graph!=\"\")?parseInt(msg.graph):0;//context.graph;\n    // if(msg.control==4 && graph==1){\n    //     $(\"#charts\").html(\" <div class='gauge-container' style='width: 100%; height: 170px '><div class='gauge'></div></div>\");\n    // }else \n    if(graph==1)$(\"#charts\").html(\"<div id='report_\"+control+\"' style='width: 100%; height: 170px '></div>\");\n//   $('#charts').append(\"<div id='report_\"+i+\"'></div>\");\n//   if (item.type == 'bar') {\n     \n    if(control==5 && graph ==1){ //soil monitoring\n            $(\"#info\").text(\"Controller is \"+control);\n//         data = [\n//   {\"period\": 1349046000000, \"licensed\": 3407, \"sorned\": 660},\n//   {\"period\": 1313103600000, \"licensed\": 3351, \"sorned\": 629},\n//   {\"period\": 1299110400000, \"licensed\": 3269, \"sorned\": 618},\n//   {\"period\": 1281222000000, \"licensed\": 3246, \"sorned\": 661},\n//   {\"period\": 1273446000000, \"licensed\": 3257, \"sorned\": 667},\n//   {\"period\": 1268524800000, \"licensed\": 3248, \"sorned\": 827},\n//   {\"period\": 1263081600000, \"licensed\": 3171, \"sorned\": 660},\n//   {\"period\": 1260403200000, \"licensed\": 3171, \"sorned\": 676},\n//   {\"period\": 1254870000000, \"licensed\": 3201, \"sorned\": 656},\n//   {\"period\": 1253833200000, \"licensed\": 3215, \"sorned\": 622}\n// ];\n \n//  new Morris.Line({\n//   // ID of the element in which to draw the chart.\n//   element: 'report_0',\n//   // Chart data records -- each entry in this array corresponds to a point on\n//   // the chart.\n//   data: [\n//     { year: '2008', value: 20 },\n//     { year: '2009', value: 10 },\n//     { year: '2010', value: 5 },\n//     { year: '2011', value: 5 },\n//     { year: '2012', value: 20 }\n//   ],\n//   // The name of the data record attribute that contains x-values.\n//   xkey: 'year',\n//   // A list of names of data record attributes that contain y-values.\n//   ykeys: ['value'],\n//   // Labels for the ykeys -- will be displayed when you hover over the\n//   // chart.\n//   labels: ['Value']\n// });\n \n \n \n new Morris.Line({\n    element: 'report_5',\n    data: msg.payload,\n    xkey: 'period',\n    ykeys: ['moisture'],\n    labels: ['moisture'],\n    //pointFillColors: ['#ffffff'],\n    pointStrokeColors: ['black'],\n    lineColors: ['blue'],\n \t\t\n    dateFormat:  function (ts) {\n                    var d = new Date(ts);\n                    //d.setTime( d.getTime() - 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\n                    return (\"0\"+d.getHours()).slice(-2)+\":\"+(\"0\"+d.getMinutes()).slice(-2)+\"น. \"+days[d.getDay()]+\" \"+d.getDate()+months2[(d.getMonth())]+(d.getFullYear()+543-2500);\n        \n    }  \n });\n\n    \n        \n        \n        \n    }else if(control==4 && graph == 1){\n\n \n new Morris.Line({\n    element: 'report_4',\n    data: msg.payload,\n    xkey: 'period',\n    ykeys: ['VS','VB','IS','IB'],\n    labels: ['VS','VB','IS','IB'],\n    // ykeys: ['licensed'],\n    // labels: ['licensed'],\n    \n    //pointFillColors: ['#ffffff'],\n    pointStrokeColors: ['black'],\n    lineColors: ['red', 'blue','green','#ff8888'],\n \t\t\n    dateFormat:  function (ts) {\n                    var d = new Date(ts);\n                    //d.setTime( d.getTime() - 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\n                    return (\"0\"+d.getHours()).slice(-2)+\":\"+(\"0\"+d.getMinutes()).slice(-2)+\"น. \"+days[d.getDay()]+\" \"+d.getDate()+months2[(d.getMonth())]+(d.getFullYear()+543-2500);\n        \n    }  \n });\n \n \n// Morris.Donut({\n//   element: 'report_4',\n//   half : true,\n//   data: [\n//     {label: \"completion\", value: 72},\n//     {label: \"left to do\", value: 28}\n//   ]\n// }); \n \n \n    }\n    \n    else if(control==3 && graph == 1){\n        total_liter = (isNaN(parseFloat(msg.lites)))?0:Number(parseFloat(msg.lites)).toFixed(2);\n        $(\"#info\").text(\"Total water used is \"+total_liter+\" lites.\");\n  data = [\n    { Time: 1313103600000, Lite: 75},//,  b: 65 },\n    { Time: 1299110400000, Lite: 50},//,  b: 40 },\n    { Time: 1281222000000, Lite: 75},//,  b: 65 },\n    { Time: 1273446000000, Lite: 50},//,  b: 40 },\n    { Time: 1268524800000, Lite: 75},//,  b: 65 },\n    { Time: 1263081600000, Lite: 100}//, b: 90 }\n  ];\n\n    new Morris.Bar({ \n            //element: 'report_'+i, \n//  \t   \t //data: item.data, \n//  \t\t//....\n \t\telement: 'report_3',\n        data: msg.payload, //data,\n        xkey: 'Time',\n        ykeys: ['Lite'],//, 'b'],\n        //xkey: 'year',\n        // ykeys: ['value'],\n        labels: ['Lite'],//, 'Series B'],\n        // lables: ['Degree'],\n        horizontal: true,\n        stacked: true,\n        barRadius: [0, 0, 0, 0],\n        barSizeRatio: 0.75,\n        barGap: 3,\n        barOpacity: 1.0,\n        barRadius: [0, 0, 0, 0],\n        xLabelMargin: 50,\n        //barColors: [‘#0b62a4’, ‘#7a92a3’, ‘#4da74d’, ‘#afd8f8’, ‘#edc240’, ‘#cb4b4b’, ‘#9440ed’], \n        barColors: function (row, series, type) {\n            return colors[parseInt(Math.random()*(colors.length-1))];},\n//console.log(\"--> \"+row.label, series, type);\n// if(row.label == \"Person A\") return \"#AD1D28\";\n// else if(row.label == \"Person B\") return \"#DEBB27\";\n// else if(row.label == \"Person C\") return \"#fec04c\";\n// else if(row.label == \"Person D\") return \"#1AB244\";\n//[\"#B21516\", \"#1531B2\", \"#1AB244\", \"#B29215\"],\n        xLabelAngle: 45,\n        fillOpacity: 0.6,\n        //behaveLikeLine: true,\n     \n        // pointFillColors: ['#ffffff'],\n        // pointStrokeColors: ['black'],\n        // lineColors: ['gray', 'red'],\n        //hideHover: 'auto',\n        //padding: 80,\n        // xLabelAngle: 60,\n        resize: true\n        \n\n\n     });\n        \n     \n    }\n    \n    else if(control==2 && graph ==1){\n        total_liter = (isNaN(parseFloat(msg.lites)))?0:Number(parseFloat(msg.lites)).toFixed(2);\n        $(\"#info\").text(\"Total water used is \"+total_liter+\" lites.\");\n  data = [\n    { Time: 1313103600000, Lite: 75},//,  b: 65 },\n    { Time: 1299110400000, Lite: 50},//,  b: 40 },\n    { Time: 1281222000000, Lite: 75},//,  b: 65 },\n    { Time: 1273446000000, Lite: 50},//,  b: 40 },\n    { Time: 1268524800000, Lite: 75},//,  b: 65 },\n    { Time: 1263081600000, Lite: 100}//, b: 90 }\n  ];\n\n    new Morris.Bar({ \n            //element: 'report_'+i, \n//  \t   \t //data: item.data, \n//  \t\t//....\n \t\telement: 'report_2',\n        data: msg.payload, //data,\n        xkey: 'Time',\n        ykeys: ['Lite'],//, 'b'],\n        //xkey: 'year',\n        // ykeys: ['value'],\n        labels: ['Lite'],//, 'Series B'],\n        // lables: ['Degree'],\n        horizontal: true,\n        stacked: true,\n        barRadius: [0, 0, 0, 0],\n        barSizeRatio: 0.75,\n        barGap: 3,\n        barOpacity: 1.0,\n        barRadius: [0, 0, 0, 0],\n        xLabelMargin: 50,\n        //barColors: [‘#0b62a4’, ‘#7a92a3’, ‘#4da74d’, ‘#afd8f8’, ‘#edc240’, ‘#cb4b4b’, ‘#9440ed’], \n        barColors: function (row, series, type) {\n            return colors[parseInt(Math.random()*(colors.length-1))];},\n//console.log(\"--> \"+row.label, series, type);\n// if(row.label == \"Person A\") return \"#AD1D28\";\n// else if(row.label == \"Person B\") return \"#DEBB27\";\n// else if(row.label == \"Person C\") return \"#fec04c\";\n// else if(row.label == \"Person D\") return \"#1AB244\";\n//[\"#B21516\", \"#1531B2\", \"#1AB244\", \"#B29215\"],\n        xLabelAngle: 45,\n        fillOpacity: 0.6,\n        //behaveLikeLine: true,\n     \n        // pointFillColors: ['#ffffff'],\n        // pointStrokeColors: ['black'],\n        // lineColors: ['gray', 'red'],\n        //hideHover: 'auto',\n        //padding: 80,\n        // xLabelAngle: 60,\n        resize: true\n        \n\n\n     });\n     }\n     \n     else if(control==1 && graph ==1){\n        $(\"#info\").text(\"Controller is \"+control);\n        data = [\n             {label: \"Coal GW\", value: 1 },\n             {label: \"Gas GW\", value: 1 },\n             {label: \"Nuclear GW\", value: 1 },\n             {label: \"Oil GW\", value: 1 },\n             {label: \"Wind GW\", value: 1 }\n             ];\n        new Morris.Donut({\n        element: 'report_1',\n        data: data\n             });\n \n     }\n     \n     else if(control==0 && graph==1){\n        $(\"#info\").text(\"Controller is \"+control);\n        data = [\n  {\"period\": 1349046000000, \"licensed\": 3407, \"sorned\": 660},\n  {\"period\": 1313103600000, \"licensed\": 3351, \"sorned\": 629},\n  {\"period\": 1299110400000, \"licensed\": 3269, \"sorned\": 618},\n  {\"period\": 1281222000000, \"licensed\": 3246, \"sorned\": 661},\n  {\"period\": 1273446000000, \"licensed\": 3257, \"sorned\": 667},\n  {\"period\": 1268524800000, \"licensed\": 3248, \"sorned\": 827},\n  {\"period\": 1263081600000, \"licensed\": 3171, \"sorned\": 660},\n  {\"period\": 1260403200000, \"licensed\": 3171, \"sorned\": 676},\n  {\"period\": 1254870000000, \"licensed\": 3201, \"sorned\": 656},\n  {\"period\": 1253833200000, \"licensed\": 3215, \"sorned\": 622}\n];\n \n//  new Morris.Line({\n//   // ID of the element in which to draw the chart.\n//   element: 'report_0',\n//   // Chart data records -- each entry in this array corresponds to a point on\n//   // the chart.\n//   data: [\n//     { year: '2008', value: 20 },\n//     { year: '2009', value: 10 },\n//     { year: '2010', value: 5 },\n//     { year: '2011', value: 5 },\n//     { year: '2012', value: 20 }\n//   ],\n//   // The name of the data record attribute that contains x-values.\n//   xkey: 'year',\n//   // A list of names of data record attributes that contain y-values.\n//   ykeys: ['value'],\n//   // Labels for the ykeys -- will be displayed when you hover over the\n//   // chart.\n//   labels: ['Value']\n// });\n \n \n \n new Morris.Line({\n    element: 'report_0',\n    data: msg.payload,\n    xkey: 'period',\n    ykeys: ['temp','humid'],\n    labels: ['Temp','Humid'],\n    //pointFillColors: ['#ffffff'],\n    pointStrokeColors: ['black'],\n    lineColors: ['red', 'blue'],\n \t\t\n    dateFormat:  function (ts) {\n                    var d = new Date(ts);\n                    //d.setTime( d.getTime() - 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\n                    return (\"0\"+d.getHours()).slice(-2)+\":\"+(\"0\"+d.getMinutes()).slice(-2)+\"น. \"+days[d.getDay()]+\" \"+d.getDate()+months2[(d.getMonth())]+(d.getFullYear()+543-2500);\n        \n    }  \n });\n\n     }//end if\n    \n    \n  });\n})(scope);\n\n</script>\n\n\n<table width=\"100%\">\n  <tr style=\"height:2px\">\n    <td colspan=12 style=\"background-color:black;height:5px;\"></td>\n  </tr>\n\n  <tr>\n    <td colspan=2>\n      <center><span class=\"smallheadings\">Report</span></center>\n    </td>\n    <td colspan=5>\n      <center><span class=\"smallheadings\">From</span></center>\n    </td>\n    <!--<td colspan=2>-->\n    <!--  <center><span class=\"smallheadings\"></span></center>-->\n    <!--</td>-->\n    <td colspan=5>\n      <center><span class=\"smallheadings\">To</span></center>\n    </td>\n    \n  </tr>\n\n  <tr>\n    <td ng-click=\"send({payload: '1'})\" colspan=2>\n      <center><span id=\"s0\" style=\"color:blue;font-size:110%\">-</span></center>\n    </td>\n    <!--<td colspan=2></td>-->\n    \n    <!--<td ng-click=\"send({payload: '5'})\" class=\"thedays\"><span id=\"v0\" class=\"thetemps\"></span>-->\n    <!--  <div id=\"f0\" class=\"thetemps\">+20</div>-->\n    <!--  <div id=\"t0\" class=\"theblocks\"></div>-->\n    <!--</td>-->\n    <td ng-click=\"send({payload: '2'})\" colspan=1>\n      <center><span id=\"sd0\" style=\"color:blue;font-size:80%\">01</span></center>\n        <center><div id=\"v0\" class=\"thetemps\">dd</div></center>\n    </td>\n    <td ng-click=\"send({payload: '3'})\" colspan=1>\n      <center><span id=\"sd1\" style=\"color:blue;font-size:80%\">มีค</span></center>\n    <center><div id=\"v1\" class=\"thetemps\">mm</div></center>\n    </td>\n\n    <td ng-click=\"send({payload: '4'})\" colspan=1>\n      <center><span id=\"sd2\" style=\"color:blue;font-size:80%\">62</span></center>\n        <center><div id=\"v2\" class=\"thetemps\">yy</div></center>\n    </td>\n    <td ng-click=\"send({payload: '5'})\" colspan=1>\n        <center><span id=\"sd3\" style=\"color:blue;font-size:75%\">00</span></center>\n        <center><div id=\"v3\" class=\"thetemps\">hh</div></center>\n    </td>\n    <td colspan=2>\n        <center><span style=\"color:blue;font-size:80%\">--></span></center>\n    </td>\n     <td ng-click=\"send({payload: '8'})\" colspan=1>\n        <center><span id=\"sd4\" style=\"color:blue;font-size:80%\">01</span></center>\n        <center><div id=\"v4\" class=\"thetemps\">dd</div></center>\n    </td>\n     <td ng-click=\"send({payload: '9'})\" colspan=1>\n        <center><span id=\"sd5\" style=\"color:blue;font-size:80%\">มค</span></center>\n        <center><div id=\"v5\" class=\"thetemps\">mm</div></center>\n    </td>  \n    <td ng-click=\"send({payload: '10'})\" colspan=1>\n        <center><span id=\"sd6\" style=\"color:blue;font-size:80%\">62</span></center>\n        <center><div id=\"v6\" class=\"thetemps\">yy</div></center>\n    </td>\n    <td ng-click=\"send({payload: '11'})\" colspan=1>\n        <center><span id=\"sd7\" style=\"color:blue;font-size:75%\">00</span></center>\n        <center><div id=\"v7\" class=\"thetemps\">hh</div></center>\n    </td>\n  </tr>\n<tr style=\"height:2px\">\n    <td id=\"dtd0\" class=\"the2px\"></td>\n    <td id=\"dtd1\" class=\"the2px\"></td>\n    <td id=\"dtd2\" class=\"the2px\"></td>\n    <td id=\"dtd3\" class=\"the2px\"></td>\n    <td id=\"dtd4\" class=\"the2px\"></td>\n    <td id=\"dtd5\" class=\"the2px\"></td>\n    <td id=\"dtd6\" class=\"the2px\"></td>\n    <td id=\"dtd7\" class=\"the2px\"></td>\n    <td id=\"dtd8\" class=\"the2px\"></td>\n    <td id=\"dtd9\" class=\"the2px\"></td>\n    <td id=\"dtd10\" class=\"the2px\"></td>\n    <td id=\"dtd11\" class=\"the2px\"></td>\n\n  </tr>\n  <tr style=\"height:2px\">\n    <td id=\"dtd12\" colspan=2 style=\"background-color:black;height:2px;\"></td>\n    <td id=\"dtd13\" colspan=4 style=\"background-color:black;height:2px;\"></td>\n    <td id=\"dtd14\" colspan=2 style=\"background-color:black;height:2px;\"></td>\n    <td id=\"dtd15\" colspan=4 style=\"background-color:black;height:2px;\"></td>\n  </tr>\n\n  <tr style=\"height: 160px;\">\n      <!--<td colspan=12 id=\"line-example2\">-->\n      <td colspan=12 >    \n            <div id=\"charts\" style=\"width: 100%; height: 165px\">\n            </div>\n            \n            \n\n            \n            \n            \n            \n            \n            <!--<div class='graph-wrapper'>-->\n            <!--<div class='graph' id='pushups'></div>-->\n            <!--</div>-->\n            <!--<center><span style=\"color:blue;font-size:80%\"><div id=\"charts\" style=\"width: 100%; height: auto \"></div></span></center>-->\n     <!--<canvas style=\"outline: none;\" ng-click=\"send({payload: ' '})\" id=\"pushups\"></canvas>-->\n      </td>\n  </tr>\n<!--</table>-->\n\n<!--<table width=\"100%\">-->\n\n  <!--<tr style=\"height:2px\">-->\n  <!--  <td id=\"dtd16\" class=\"the2px\"></td>-->\n  <!--  <td id=\"dtd17\" class=\"the2px\"></td>-->\n  <!--  <td id=\"dtd18\" class=\"the2px\"></td>-->\n  <!--  <td id=\"dtd19\" class=\"the2px\"></td>-->\n  <!--  <td id=\"dtd20\" class=\"the2px\"></td>-->\n  <!--  <td id=\"dtd21\" class=\"the2px\"></td>-->\n  <!--  <td id=\"dtd22\" class=\"the2px\"></td>-->\n  <!--  <td id=\"dtd23\" class=\"the2px\"></td>-->\n  <!--  <td id=\"dtd24\" class=\"the2px\"></td>-->\n  <!--  <td id=\"dtd25\" class=\"the2px\"></td>-->\n  <!--  <td id=\"dtd26\" class=\"the2px\"></td>-->\n  <!--  <td id=\"dtd27\" class=\"the2px\"></td>-->\n    \n  <!--</tr>-->\n\n  <!--<tr>-->\n  <!--  <td>10</td>-->\n  <!--  <td>20</td>-->\n  <!--  <td>30</td>-->\n  <!--  <td>40</td>-->\n  <!--  <td>50</td>-->\n  <!--  <td>60</td>-->\n  <!--  <td>70</td>-->\n  <!--  <td>80</td>-->\n  <!--  <td>90</td>-->\n  <!--  <td>10</td>-->\n  <!--  <td>20</td>-->\n  <!--  <td>30</td>-->\n  <!--</tr>-->\n\n\n\n  <tr height=\"4px\">\n    <td colspan=\"12\"></td>\n  </tr>\n\n\n  <tr height=\"22px\">\n    <td colspan=2 bgcolor=\"#dddddd\"><span class=\"smallheadings\">&nbsp;Status:</span></td>\n\n    <td colspan=8 bgcolor=\"#dddddd\">\n      <center><span id=\"info\" class=\"smallheadings\">OK</span></center>\n    <td ng-click=\"send({payload: '12'})\" colspan=1 bgcolor=\"#dddddd\">\n        <center><span id=\"sd8\" style=\"color:blue;font-size:75%\">00</span></center>\n      <!--<center><span id=\"info\" class=\"smallheadings\">05 ต้น</span></center>-->\n    </td>\n    <!--<td colspan=1 bgcolor=\"#dddddd\">-->\n    <td ng-click=\"send({payload: '13'})\" colspan=1 bgcolor=\"#dddddd\">\n        <center><span id=\"sd9\" style=\"color:blue;font-size:75%\">00 ต้น</span></center>\n      <!--<center><span id=\"info\" class=\"smallheadings\">05 ต้น</span></center>-->\n    </td>\n  </tr>\n  <tr style=\"height:2px\">\n    <!--<td id=\"dtd12\" colspan=2 style=\"background-color:black;height:2px;\"></td>-->\n    <td id=\"dtd16\" colspan=10 style=\"background-color:black;height:2px;\"></td>\n    <td id=\"dtd17\" colspan=1 style=\"background-color:black;height:2px;\"></td>\n    <td id=\"dtd18\" colspan=1 style=\"background-color:black;height:2px;\"></td>\n  </tr>\n  <tr height=\"2px\">\n    <td colspan=\"12\"></td>\n  </tr>\n\n\n\n  <!--<tr style=\"height:35px\">-->\n  <tr>\n    <td colspan=2>\n      <md-button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'r'})\">\n        <img style=\"outline : none;\" ng-src=\"{{(msg.payload)?'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/refresh1.png':'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/refresh1.png'}}\" height=\"35px\" />\n      </md-button>\n    </td>\n      <td colspan=2>\n      <md-button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'b'})\">\n        <img style=\"outline : none;\" ng-src=\"{{(msg.payload)?'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/cctv.png':'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/cctv.png'}}\" height=\"35px\" />\n      </md-button>\n    </td>\n\n        <td colspan=2>\n      <md-button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'D'})\">\n        <img style=\"outline : none;\" ng-src=\"{{(msg.payload)?'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/down.png':'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/down.png'}}\" height=\"35px\" />\n      </md-button>\n    </td>\n\n    <!--<td colspan=2>-->\n    <!--  <center><span id=\"current\" style=\"color:black;font-size:120%\">-</span></center>-->\n    <!--</td>-->\n\n    <td colspan=2>\n      <md-button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'U'})\">\n        <img style=\"outline : none;\" ng-src=\"{{(msg.payload)?'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/up.png':'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/up.png'}}\" height=\"35px\" />\n      </md-button>\n    </td>\n    <td colspan=2>\n      <md-button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'g'})\">\n        <img style=\"outline : none;\" ng-src=\"{{(msg.payload)?'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/icon_go2.png':'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/icon_go2.png'}}\" height=\"35px\" />\n      </md-button>\n    </td>\n\n  \n\n    <td colspan=2>\n      <md-button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'c'})\">\n        <img style=\"outline : none;\" ng-src=\"{{(msg.payload)?'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/home_icon.png':'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/home_icon.png'}}\" height=\"35px\" />\n      </md-button>\n    </td>\n\n    <td colspan=1></td>\n  </tr>\n</table>\n\n\n","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":940.0998458862305,"y":254.99988174438477,"wires":[["27af7028.65aa2","d94934e8.041308"]]},{"id":"6d705229.5ebcac","type":"ui_template","z":"a5f3d8c4.ba3b58","group":"f01c7bf6.313058","name":"Morris.js","order":14,"width":0,"height":0,"format":"  <!--<script src=\"http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js\"></script>-->\n  <!--<script src=\"http://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.2/raphael-min.js\"></script>-->\n  <!--<script src=\"/scripts/morris.js\"></script>-->\n  <!--<script src=\"http://cdnjs.cloudflare.com/ajax/libs/prettify/r224/prettify.min.js\"></script>-->\n  <!--<script src=\"lib/example.js\"></script>-->\n  <!--<link rel=\"stylesheet\" href=\"lib/example.css\">-->\n  <!--<link rel=\"stylesheet\" href=\"http://cdnjs.cloudflare.com/ajax/libs/prettify/r224/prettify.min.css\">-->\n  <!--<link rel=\"stylesheet\" href=\"/css/morris.css\">-->\n  \n    \n  <link rel=\"stylesheet\" href=\"//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.css\">\n  <script src=\"//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js\"></script>\n  <script src=\"//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js\"></script>\n  <script src=\"//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.min.js\"></script>\n  \n  <!--<script src=\"//omnipotent.net/jquery.sparkline/2.1.2/jquery.sparkline.js\"></script>-->","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":342.1000061035156,"y":192,"wires":[[]]},{"id":"9c079e3f.3911f","type":"ui_template","z":"a5f3d8c4.ba3b58","group":"f01c7bf6.313058","name":"css etc","order":10,"width":"0","height":"0","format":"<style>\n\n.cellGreen \n{\nbackground-color: #ffdddd !important;\n}\n\n  .filled { \n      height: 100% !important;\n\n      padding: 0 !important;\n      margin: 0 !important;\n  }\n  .nr-dashboard-template {\n      padding: 0;\n      margin: 0;\n  }\n  \n  .rounded {\n  border-radius: 12px 12px 12px 12px;\n}\n \n   .bigfont {\n  font-size: 18px;\n}\n\n   .smallfont {\n  font-size: 12px;\n}\n \n\n  \n.zui-table {\n    border: solid 1px #DDEEEE;\n    border-collapse: collapse;\n    border-spacing: 0;\n    font: normal 10px Arial, sans-serif;\n    outline: none;\n}\n.zui-table thead th {\n    width: 100%;\n    height:50%;\n    background-color: #99bbff;\n    border: solid 1px #DDEEEE;\n    color: #336B6B;\n    padding: 7px 3px 5px 3px;\n    text-align: center;\n    text-shadow: 1px 1px 1px #fff;\n}\n.zui-table tbody td {\n    width: 100%;\n    height:50%;\n    border: solid 1px #333;\n    color: #333;\n    text-align: center;\n    padding: 6px 3px 9px 3px;\n    text-shadow: 1px 1px 1px #fff;\n}\n.zui-table-rounded {\n    border: none;\n}\n.zui-table-rounded thead th {\n    background-color: #77aaff;\n    border: none;\n    text-shadow: 1px 1px 1px #ccc;\n    color: #333;\n}\n.zui-table-rounded thead th:first-child {\n    border-radius: 10px 0 0 0;\n}\n.zui-table-rounded thead th:last-child {\n    border-radius: 10px 10px 0px 0px;\n}\n.zui-table-rounded tbody td {\n    border: none;\n    border-top: solid 1px #957030;\n    background-color: #aaddff;\n}\n.zui-table-rounded tbody tr:last-child td:first-child {\n    border-radius: 10px 10px 0 0;\n}\n.zui-table-rounded tbody tr:last-child td:last-child {\n    border-radius: 0 0 10px 10px;\n}  \n</style>\n\n<script>\nvar current=1;\n\n$('.vibrate').on('click', function() {\n  navigator.vibrate(100);\n});\n\nfunction restore_bg(x) {\n            $(this).css(\"background-color\", x);\n    };\n\n$('.touched').on('mousedown', function() {\n    \n    var x= $(this).css(\"background-color\");\n    $(this).css(\"background-color\", \"yellow\");\n    \n    setTimeout(restore_bg.bind(this,x),50);\n    navigator.vibrate(80);\n    });\n    \nvar myStatus=\"Nowt\";\n</script>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":314.1142272949219,"y":135.00567626953125,"wires":[[]]},{"id":"2ae1bfb8.0134b","type":"ui_template","z":"a5f3d8c4.ba3b58","group":"f01c7bf6.313058","name":"Valve1","order":5,"width":"1","height":"1","format":"<script>\n//   if ( typeof context.light == 'undefined' ) context.light=\"OFF\";\n//   else{\n//       if(msg.payload != \"\"){\n//           context.light = msg.payload;\n//       }else{\n//           msg.payload = context.light;\n//       }\n//   }\n   (function(scope){\n        scope.$watch('msg', function(msg) {\n            // if (msg.payload!=\"\") $(\"#infor\").text(Number(parseInt(msg.payload)).toLocaleString('en-GB')+\"L/h\");\n            // if (msg.colour!=\"\") $(\"#infor\").css(\"background-color\",msg.colour);\n             \n            if(msg.payload==\"WAIT\"){\n                $(\"#solar2\").css(\"background-color\",\"#aaddff\"); \n                 $(\"#solar2\").text(\"Waiting\"); \n            } else if (msg.payload!=\"\" && parseInt(msg.payload)>=0){\n                $(\"#solar2\").text(Number(parseInt(msg.payload)).toLocaleString('en-GB')+\"Lux\");\n                $(\"#solar2\").css(\"background-color\",\"#88ff88\"); \n                msg.mode = \"ON\";\n             }else if(msg.payload == \"ON\"){\n                $(\"#solar2\").text(\"ON\");\n                $(\"#solar2\").css(\"background-color\",\"#88ff88\"); \n                msg.mode=\"ON\";\n             }else{// if (msg.payload!=\"\" && msg.payload==\"OFF\"){\n                $(\"#solar2\").text(\"OFF\");\n                $(\"#solar2\").css(\"background-color\",\"#ff8888\");\n                 //if (msg.colour!=\"\") $(\"#infor\").css(\"background-color\",msg.colour);\n                msg.mode = \"OFF\";\n             }\n        });\n \n    })(scope);</script>\n<table  ng-click=\"(msg.mode=='ON')?send({payload:'OFF_VALVE1',topic:'/house1/control/valve1'}):send({payload:'ON_VALVE1',topic:'/house1/control/valve1'})\" width=100% height=100% class=\"vibrate zui-table zui-table-rounded\">\n    <thead>\n        <tr>\n            <th>VALVE1</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr >\n            <td id=\"solar2\"></td>\n        </tr>\n\n    </tbody>\n</table>\n","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":551.1000061035156,"y":374.0000057220459,"wires":[["6780be0e.81d08","ec28d576.96de58","2b2f4ab8.4f94f6"]]},{"id":"c08ff6ed.128838","type":"ui_template","z":"a5f3d8c4.ba3b58","group":"f01c7bf6.313058","name":"Spray","order":3,"width":"1","height":"1","format":"                \n<script>\n   (function(scope){\n        scope.$watch('msg', function(msg) {\n            // if (msg.payload!=\"\") $(\"#infor\").text(Number(parseInt(msg.payload)).toLocaleString('en-GB')+\"L/h\");\n            // if (msg.colour!=\"\") $(\"#infor\").css(\"background-color\",msg.colour);\n             \n             if(msg.payload==\"WAIT\"){\n                $(\"#infor2\").css(\"background-color\",\"#aaddff\"); \n                 $(\"#infor2\").text(\"Waiting\"); \n            } else if (msg.payload!=\"\" && parseInt(msg.payload)>0){\n                $(\"#infor2\").text(Number(parseInt(msg.payload)).toLocaleString('en-GB')+\"L/m\");\n                $(\"#infor2\").css(\"background-color\",\"#88ff88\"); \n                msg.mode = \"ON\";\n             }else if(msg.payload == \"ON\"){\n                $(\"#infor2\").text(\"ON\");\n                $(\"#infor2\").css(\"background-color\",\"#88ff88\"); \n                msg.mode=\"ON\";\n             }else{// if (msg.payload!=\"\" && msg.payload==\"OFF\"){\n                $(\"#infor2\").text(\"OFF\");\n                $(\"#infor2\").css(\"background-color\",\"#ff8888\");\n                 //if (msg.colour!=\"\") $(\"#infor\").css(\"background-color\",msg.colour);\n                msg.mode = \"OFF\";\n             }\n        });\n \n    })(scope);\n</script>\n<table  ng-click=\"(msg.mode=='ON')?send({payload:'OFF_SPRAY',topic:'/house1/control/spray'}):send({payload:'ON_SPRAY',topic:'/house1/control/spray'})\" width=100% height=100% class=\"vibrate zui-table zui-table-rounded\">\n    <thead>\n        <tr>\n            <th>SPRAY</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr >\n            <td id=\"infor2\"></td>\n        </tr>\n\n    </tbody>\n</table>\n","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":221.10000610351562,"y":391,"wires":[["2b2f4ab8.4f94f6","6780be0e.81d08","f03e6ec4.c399"]]},{"id":"a2391291.0c248","type":"debug","z":"a5f3d8c4.ba3b58","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":954.2666931152344,"y":42.111114501953125,"wires":[]},{"id":"73722581.4174bc","type":"function","z":"77963358.df6f4c","name":"Showing settings","func":"if(msg.mode == \"auto\") msg.payload = \"Turn on AUTOMETIC control\";\nelse if (msg.mode == \"man\") msg.payload = \"Turn on MANUAL control\";\nelse msg.payload=\"Showing settings\";\nreturn msg;","outputs":1,"noerr":0,"x":694,"y":427,"wires":[["39659e17.63ddf2"]]},{"id":"f176e4cb.570f78","type":"function","z":"77963358.df6f4c","name":"Heat test","func":"if (msg.heatRelay==1){\n\n\n    node.status({fill:\"red\",shape:\"dot\",text:\"Heat ON\"});\n    //if(msg.heatRelay === 0){\n      msg.payload = \"ON_WATER\";\n      msg.topic = \"piedht\";\n      node.send({payload:true});\n    //}\n}else{\n    node.status({fill:\"black\",shape:\"dot\",text:\"Heat OFF\"});\n    //if(msg.heatRelay === 1) {\n        msg.payload = \"OFF_WATER\";\n        msg.topic = \"piedht\";\n        node.send({payload:false});\n    //}    \n}\nglobal.set(\"heatRelay\",msg.heatRelay);\n\nreturn msg;","outputs":1,"noerr":0,"x":1099,"y":1328,"wires":[[]]},{"id":"693db1d7.09259","type":"function","z":"77963358.df6f4c","name":"Process controls","func":"if ( typeof context.days == 'undefined' ) context.days=1;\nif ( typeof context.selector == 'undefined' ) context.selector=1;\nif ( typeof context.hourSelected == 'undefined') context.hourSelected = 0;\nif ( typeof context.frost == 'undefined') context.frost = false;\nif ( typeof context.saving == 'undefined' ) context.saving=1;\nif ( typeof context.control == 'undefined' ) context.control=0;\nif ( typeof context.run == 'undefined' ) context.run=0;\nif ( typeof context.record == 'undefined'){ context.record=15;global.set('record1',15);}\n\n//context.timing = global.get(\"timing1\");\nif ( typeof context.timing == 'undefined' ) {\n    context.timing= [];\n    // if(typeof context.timimg == 'undefined'){\n    //     context.timing = [14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n    //                     14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n    //                     14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n    //                     14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n    //                     14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n    //                     14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n    //                     14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n    //                     0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,\n    //                     //fan control\n    //                     10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,\n    //                     10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,\n    //                     10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,\n    //                     10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,\n    //                     10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,\n    //                     10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,\n    //                     10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,\n    //                     0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,\n    //                     //valve-1 control\n    //                     10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,\n    //                     10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,\n    //                     10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,\n    //                     10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,\n    //                     10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,\n    //                     10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,\n    //                     10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,\n    //                     0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,\n    //                     //valve-2 control\n    //                     10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,\n    //                     10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,\n    //                     10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,\n    //                     10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,\n    //                     10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,\n    //                     10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,\n    //                     10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,\n    //                     0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n    //                     0,0];\n        \n    //     context.saving=0;  \n    //     msg.payload=\"anything\";  \n    //     msg.foryou=\"Restoring\"; \n    //     msg.control = context.control;\n    //     global.set(\"timing1\",context.timing);\n    // }else{\n        context.saving=0;  \n        msg.payload=\"anything\";  \n        msg.foryou=\"Restoring\"; \n        msg.control = context.control;\n        return([null,null,msg,null,null]);\n    // }\n}\ncontext.timing = global.get(\"timing1\");\nvar timing = context.timing;\nvar MAX_DEVICE = 4;\nvar MAX_RUN = 3;\nvar MAX_RECORD = 60;\n\nswitch (msg.payload)\n    {\n    case \"u\" : \n                // if (context.selector==1 && context.hourSelected >4) { //1 is the control device; 2 is theruning type; >4 is the hour selection\n                //     hr = ((context.days-1)*24)+context.hourSelected-5+172;\n                //     if (timing[hr]<60) {  \n                //         timing[hr]++; \n                //         msg.foryou=\"Incremented frost setting 1 degree\"; \n                //     } else msg.foryou=\"Hit limit\"; \n                // } \n                if ((context.selector>4)&&(context.selector<29)) //hour selection\n                {\n\n                    if(context.frost===true){ //frost flag controls the selection whether start time or frost time\n                        hr = ((context.control*340)+(context.days-1)*24)+context.selector-5+170;\n                        if (timing[hr]<59){\n                            timing[hr]++;\n                            msg.foryou=\"Incremented start time setting 1 minute\";\n                        }    \n                    }else{    \n                        hr = ((context.control*340)+(context.days-1)*24)+context.selector-5;\n                        if (timing[hr]<59){\n                            timing[hr]++;\n                            msg.foryou=\"Incremented frost time setting 1 minute\"\n                        }    \n                    }\n                }\n                \n                if (context.selector==1) {//Control selection (Frost selection) \n                    context.control++ ;\n                    context.control %= MAX_DEVICE;\n                    //context.timing[338]=context.control; //element at index 338 is stored the device control number\n                    msg.foryou=\"Go to next control device \"+context.control; \n                }\n                if (context.selector==2) {//Mode selection (Away selection) \n                    context.run++ ;\n                    context.run %= MAX_RUN;\n                    context.timing[context.control*340+169]=context.run;\n                    global.set('timing1',context.timing);\n                    msg.foryou=\"Move to running type \"+context.run; \n                    \n                }\n                if (context.selector==29) { //day selection\n                    if (context.days<7) { \n                        context.days++; msg.foryou=\"Forward one day\";\n                    } else msg.foryou=\"End of days!!\"; \n                }\n                if (context.selector==30) { //Record Selection\n                    context.record++ ;\n                    context.record %= MAX_RECORD;\n                    //context.timing[context.control*340+169]=context.record;\n                    global.set('record1',context.record);\n                    //global.set('timing1',context.timing);\n                    msg.foryou=\"Incremented record time interval\"; \n                }\n                break;\n    case \"d\" : \n                //     if (context.selector==1 && context.hourSelected >4) { \n                //     hr = ((context.days-1)*24)+context.hourSelected-5+172;\n                //     if (timing[hr]>0) {  \n                //         timing[hr]--; \n                //         msg.foryou=\"Decremented frost setting 1 degree\"; \n                //     } else msg.foryou=\"Hit limit\"; \n                // } \n                if ((context.selector>4)&&(context.selector<29)) //days selection\n                {\n\n                    if(context.frost===true){\n                        hr = ((context.control*340)+(context.days-1)*24)+context.selector-5+170;\n                        if (timing[hr]>0){\n                            timing[hr]--;\n                            msg.foryou=\"Decremented start time setting 1 minute\";\n                        }    \n                    }else{    \n                        hr = ((context.control*340)+(context.days-1)*24)+context.selector-5;\n                        if (timing[hr]>0){\n                            timing[hr]--;\n                            msg.foryou=\"Decremented frost time setting 1 minute\"\n                        }    \n                    }\n                }\n                \n                //if (context.selector==2) { if (timing[169]>0) {  timing[169]--; msg.foryou=\"Incremented away setting 1 degree\"; } else msg.foryou=\"Hit limit\"; }\n                if (context.selector==1) {//Control selection (Frost selection) \n                    context.control--;\n                    if(context.control<0) context.control = MAX_DEVICE-1;\n                    //context.timing[338]=context.control; //element at index 338 is stored the device control number\n                    msg.foryou=\"Go to control device \"+context.control; \n                }\n                if (context.selector==2) {//Mode selection (Away selection) \n                    context.run--;\n                    if(context.run < 0){\n                        context.run = MAX_RUN-1;\n                    }\n                    //context.run= Math.abs(context.run) % MAX_RUN; \n                    context.timing[context.control*340+169]=context.run;\n                    global.set('timing1',context.timing);\n                    msg.foryou=\"Move to running type \"+context.run; \n                }\n                if (context.selector==29) { //Days selection\n                    //context.hourSelected = 0;\n                    if (context.days>1) { \n                        context.days--; \n                        msg.foryou=\"Forward one day\";\n                    } else msg.foryou=\"End of days!!\"; \n                }\n                if (context.selector==30) { //Record selection (humid)\n                    context.record--;\n                    if(context.record<0) context.record = 59;  \n                    //context.timing[context.control*340+169]=context.record;\n                    global.set('record1',context.record);\n                    //global.set('timing1',context.timing);\n                    msg.foryou=\"Decremented record time interval\";\n                }\n                break;\n    case 'r' :  if ((context.selector>=5)&&(context.selector<28)) //copy hour in a same day\n                        {\n                         timing[((context.control*340)+(context.days-1)*24)+context.selector-4]=timing[((context.control*340)+(context.days-1)*24)+context.selector-5];   \n                         timing[((context.control*340)+(context.days-1)*24)+context.selector-4+170]=timing[((context.control*340)+(context.days-1)*24)+context.selector-5+170];   \n                         context.selector++;\n                         msg.foryou=\"Copied settings to the next hour slot\";\n                        }\n                if ((context.selector==29)&&(context.days<7)) //copy hour of a day\n                        {\n                         for (var a=0;a<24;a++)\n                            {\n                                timing[(context.control*340)+((context.days)*24)+a]=timing[(context.control*340)+((context.days-1)*24)+a];   \n                                timing[((context.control*340)+(context.days)*24)+a+170]=timing[((context.control*340)+(context.days-1)*24)+a+170];   \n                         \n                            }\n                         context.days++;\n                         msg.foryou=\"Copied a complete day's settings\";\n                        }\n                break;\n    case 's': context.saving=0;  msg.foryou=\"Settings saved to disk\"; break;\n    case '1': //break;\n    case '2'://break;\n    case '3'://break;\n    case '4'://break;\n    case '5':\n            //msg.foryou=\"Selecting \"+(parseInt(msg.payload)-4); break;\n    case '6':\n    case '7':\n    case '8':\n    case '9':\n    case '10':\n    case '11':\n    case '12':\n    case '13':\n    case '14':\n    case '15':\n    case '16':\n    case '17':\n    case '18':\n    case '19':\n    case '20':\n    case '21':\n    case '22':\n    case '23':\n    case '24':\n    case '25':\n    case '26':\n    case '27':\n    case '28':\n    case '29':\n    case '30': //   select DeHum\n               context.selector=parseInt(msg.payload); //selector เป็นตัวเก็บสถานะปัจจุบันของการเลือก\n\n               if (msg.payload=='1') msg.foryou=\"Control Device selection\"; //frost\n               else if (msg.payload=='2') msg.foryou=\"Run type selection\"; //away\n               else if (msg.payload=='29'){msg.foryou=\"Day selection\";} //day\n               else if (msg.payload=='30') msg.foryou=\"Record time selection\"; //humid\n               else {\n                    if(context.hourSelected === context.selector) //มีการกดที่ ชั่วโมง ซ้ำ --> สีจะสับเป็น ชมพู-เขียว หรือ เขียว-ชมพู\n                        context.frost = !context.frost; //flag บังคับสีเส้นฐาน {เขียว,ชมพู}\n                    else {\n                        context.frost = false; //reset flag to Megenta color\n                        context.hourSelected = context.selector;\n                    }\n                   //context.hourSelected = context.selector;\n                    msg.foryou=\"เลือกชั่วโมงที่  \" + (parseInt(msg.payload)-4);\n               }       \n        break;\n    case 'c' : \n    \n        msg.payload= {group:{ show:[\"House1_Graphs\"], hide:[\"House1_Home\"], focus:true}};\n        return [null,null,null,msg,null];\n  \n    case 'b' : \n    \n        msg.payload= {group:{ show:[\"House1_Graphs\"], hide:[\"House1_Home\"], focus:true}};\n        msg.topic = \"/house1/state/reload/home\";\n        return [null,null,null,null,msg];\n        // break;\n    }\n\n//updating msg\nmsg.temperatures=context.temperatures;\nmsg.timing=timing;\nmsg.days=context.days;\nmsg.selector=context.selector;\nmsg.hourSelected = context.hourSelected;\nmsg.frost = context.frost;\nmsg.control = context.control;\nmsg.run = context.run;\nmsg.record = context.record;\n\ncontext.timing = timing;\n\n\n//global.set(\"timing1\",context.timing);\nnode.send([msg,null,null,null,null]);\n\nif (context.saving===0) \n    { \n        global.set(\"timing1\",context.timing);\n        msg.topic=\"\";\n        msg.control = context.control;\n        msg.timing=\"\";\n        msg.payload=JSON.stringify(timing);\n        context.saving = 1;\n        node.send([null,msg,null,null,null]); \n       \n    }\nmsg.foryou=\"\";\n    \n//return [msg,null,null,null,null];\n","outputs":5,"noerr":0,"x":870.0000839233398,"y":58.00000190734863,"wires":[["b62a3c09.0a3cd","8f81d7a6.227ea8"],["9a88de59.a43d3","5282e271.c15e7c"],["8a2ca899.54a828","3cb17f89.424de"],["f6cc04d9.2d0148","f61d75dd.d440b8"],["34838227.915b1e"]]},{"id":"31e9537.a7f98ac","type":"inject","z":"77963358.df6f4c","name":"Every minute","topic":"","payload":"t","payloadType":"str","repeat":"60","crontab":"","once":false,"onceDelay":"","x":487,"y":118,"wires":[["693db1d7.09259"]]},{"id":"28a68285.e2805e","type":"inject","z":"77963358.df6f4c","name":"Once only","topic":"","payload":"1","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"1","x":577,"y":60,"wires":[["693db1d7.09259","31d720d9.93821","df1fcb37.519028"]]},{"id":"305ed438.9d4dcc","type":"debug","z":"77963358.df6f4c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1485.0000667572021,"y":79.00000190734863,"wires":[]},{"id":"f61d75dd.d440b8","type":"debug","z":"77963358.df6f4c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1131,"y":95,"wires":[]},{"id":"8a2ca899.54a828","type":"debug","z":"77963358.df6f4c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1372,"y":31,"wires":[]},{"id":"1f0c6cc7.5c1303","type":"inject","z":"77963358.df6f4c","name":"Reset Time","topic":"","payload":"80,25","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130.000004529953,"y":630.0000133514404,"wires":[["f23454ce.377fa8"]]},{"id":"f23454ce.377fa8","type":"function","z":"77963358.df6f4c","name":"getTemperature","func":"\n\nif(global.get(\"heatRelay\") == 'undefined')global.set(\"heatRelay\",0);\n\nvar output = msg.payload.split(\",\");\n\nmsg.value=parseInt(output[1]);\nmsg.heatRelay=global.get(\"heatRelay\");\nmsg.humidity=parseFloat(output[0]);\nmsg.humidityRelay = 0;\n\nglobal.set(\"incomingTemperature\",msg.value);\nglobal.set(\"incomingHumidity\",msg.humidity);\n\n// Update the status with current timestamp\nvar now = new Date();\nnow.setTime(now.getTime() + 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\nvar yyyy = now.getFullYear();\nvar mm = now.getMonth() < 9 ? \"0\" + (now.getMonth() + 1) : (now.getMonth() + 1); // getMonth() is zero-based\nvar dd  = now.getDate() < 10 ? \"0\" + now.getDate() : now.getDate();\nvar hh = now.getHours() < 10 ? \"0\" + now.getHours() : now.getHours();\nvar mmm  = now.getMinutes() < 10 ? \"0\" + now.getMinutes() : now.getMinutes();\nvar ss  = now.getSeconds() < 10 ? \"0\" + now.getSeconds() : now.getSeconds();\nnode.status({fill:\"blue\",shape:\"ring\",text:\"Last update: \"+dd + \".\" + mm + \".\" + yyyy + \" \" + hh + \":\" + mmm + \":\" + ss});    \n\nreturn msg;\n","outputs":1,"noerr":0,"x":363,"y":958,"wires":[["15d1fd84.eacc02"]]},{"id":"35b57bb1.e4b4b4","type":"function","z":"77963358.df6f4c","name":"toMultipleCharts","func":"\nvar output = msg.payload.split(\",\");\ntemp = {payload:parseInt(output[1]),topic:\"Temp\"};\nheart = {payload:parseInt(output[0]),topic:\"Humid\"};\nvar ret = [];\nret.push(heart);\nret.push(temp);\nreturn [ret];","outputs":1,"noerr":0,"x":376.0000035762787,"y":728,"wires":[[]]},{"id":"f582e064.11d6c","type":"function","z":"77963358.df6f4c","name":"getHumidity","func":"function theNewDate()\n{\n   var d = new Date();\n   d.setTime( d.getTime() + 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\n    minutes = d.getMinutes().toString().length == 1 ? '0'+d.getMinutes() : d.getMinutes();\n    hours = d.getHours().toString().length == 1 ? '0'+d.getHours() : d.getHours();\n   // ampm = d.getHours() >= 12 ? 'pm' : 'am';\n    months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n    days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];\n    var m= days[d.getDay()]+' '+months[d.getMonth()]+' '+d.getDate()+' '+d.getFullYear()+' '+hours+':'+minutes;\n    return m;\n}\n\n\nif(global.get(\"heatRelay\") == 'undefined')global.set(\"heatRelay\",0);\n\nvar output = msg.payload.split(\",\");\nmsg.value=parseInt(output[1]);\nmsg.heatRelay=global.get(\"heatRelay\");\nmsg.humidity=parseFloat(output[0]);\n\n\nmsg.topic=theNewDate();\nmsg.payload=\"Humidity: \"+msg.humidity+\"%\" ;\nmsg.humidity = \"Humidity: \"+msg.humidity+\"%\";\nreturn msg;\n","outputs":1,"noerr":0,"x":408,"y":678,"wires":[["39659e17.63ddf2"]]},{"id":"a83742d0.593b","type":"function","z":"77963358.df6f4c","name":"getWaterFlow","func":"function theNewDate()\n{\n   var d = new Date(),\n    minutes = d.getMinutes().toString().length == 1 ? '0'+d.getMinutes() : d.getMinutes();\n    hours = d.getHours().toString().length == 1 ? '0'+d.getHours() : d.getHours();\n    ampm = d.getHours() >= 12 ? 'pm' : 'am';\n    months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n    days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];\n    var m= days[d.getDay()]+' '+months[d.getMonth()]+' '+d.getDate()+' '+d.getFullYear()+' '+hours+':'+minutes+ampm;\n    return m;\n}\n\n\nif(global.get(\"heatRelay\") == 'undefined')global.set(\"heatRelay\",0);\n\nvar output = msg.payload.split(\",\");\nmsg.value=parseInt(output[1]);\nmsg.heatRelay=global.get(\"heatRelay\");\nmsg.humidity=parseFloat(output[0]);\nmsg.flowrate = isNaN(parseFloat(output[2]))?0:parseInt(output[2]);\n\n\nmsg.topic=theNewDate();\nmsg.payload=\"Flow rate: \"+msg.flowrate+\" L/M\" ;\n\nreturn msg;\n","outputs":1,"noerr":0,"x":369,"y":872,"wires":[["39659e17.63ddf2"]]},{"id":"31d720d9.93821","type":"function","z":"77963358.df6f4c","name":"","func":"if(typeof context.flag == 'undefined')context.flag=false;\nif(msg.payload==\"ON_FAN\" || msg.payload==\"OFF_FAN\"){\nif(context.flag){\n    msg.payload = true;\n    msg.mode = \"on\";\n    //node.send({payload: 'ON_WATER',topic:'piedht'});\n}\nelse{\n    msg.payload = false;\n    msg.mode = \"off\"\n    //node.send({payload: 'OFF_WATER',topic:'piedht'});\n}\n\ncontext.flag = !context.flag;\n\nreturn msg;\n}","outputs":1,"noerr":0,"x":362.00000381469727,"y":417.00000381469727,"wires":[["6d28cda1.d4d944"]]},{"id":"a528e279.ec703","type":"function","z":"77963358.df6f4c","name":"initData","func":"var timing = global.get(\"timing2\");\n\nvar outputs = [];\nfor(var i=0;i<7;i++){\n    for(var j=0;j<24;j++){\n        if(msg.payload===0)\n            sql = \"INSERT INTO pump_hour (pump_id, day, hour, start_time, frost_time) values (1,\"+i+\",\"+j+\",\"+timing[(msg.payload*340)+i*24+j]+\",\"+timing[(msg.payload*340)+170+(i*24)+j]+\")\";\n        if(msg.payload==1)\n            sql = \"INSERT INTO fan_hour (fan_id, day, hour, start_time, frost_time) values (1,\"+i+\",\"+j+\",\"+timing[(msg.payload*340)+i*24+j]+\",\"+timing[(msg.payload*340)+170+(i*24)+j]+\")\";\n        if(msg.payload==2)\n            sql = \"INSERT INTO solar_hour (solar_id, day, hour, start_time, frost_time) values (1,\"+i+\",\"+j+\",\"+timing[(msg.payload*340)+i*24+j]+\",\"+timing[(msg.payload*340)+170+(i*24)+j]+\")\";\n        \n        outputs.push({topic:sql});\n    }\n}\n\n\n// Update the status with current timestamp\nvar now = new Date();\nvar yyyy = now.getFullYear();\nvar mm = now.getMonth() < 9 ? \"0\" + (now.getMonth() + 1) : (now.getMonth() + 1); // getMonth() is zero-based\nvar dd  = now.getDate() < 10 ? \"0\" + now.getDate() : now.getDate();\nvar hh = now.getHours() < 10 ? \"0\" + now.getHours() : now.getHours();\nvar mmm  = now.getMinutes() < 10 ? \"0\" + now.getMinutes() : now.getMinutes();\nvar ss  = now.getSeconds() < 10 ? \"0\" + now.getSeconds() : now.getSeconds();\nnode.status({fill:\"blue\",shape:\"ring\",text:\"Last update: \"+dd + \".\" + mm + \".\" + yyyy + \" \" + hh + \":\" + mmm + \":\" + ss});    \n\nreturn [ outputs ];\n","outputs":1,"noerr":0,"x":1602.4000244140625,"y":328.99998474121094,"wires":[["28be2207.7504fe"]]},{"id":"4b6ed62f.315998","type":"function","z":"77963358.df6f4c","name":"StoringDataDHT","func":"var outputs = [];\nvar minute = 1000*60;\n// var count = context.get('count') || 0;\n// count +=1;\n// context.set('count',count);\n    // Update the status with current timestamp\nvar now = new Date();\nnow.setTime(now.getTime() + 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\nif(typeof context.time == 'undefined')context.time = now.getTime();\nvar th = global.get('record1');\n//var timing = global.get('timing1');\nif(typeof th == 'undefined') th=15;\n\nif(parseInt(th)>0 && (now.getTime()-context.time) > parseInt(th*minute)){ //node mcu send dht for every 30 seconds, th store value of minute.\n   \n    context.time = now.getTime();\n\n    dht = msg.payload.split(',');     //แบ่งข้อมูลด้วย ,\n    humid = parseFloat(dht[0]); //ข้อมูลที่แบ่งในตำแหน่งที่ 0 คือความชื้น\n    temp = parseFloat(dht[1]);  //ข้อมูลที่แบ่งในตำแหน่งที่ 1 คืออุณหภูมิ\n    msg.payload = {          //นำข้อมูลที่ได้บรรจุลง payload \n      temperature: temp,\n      humidity: humid\n    }\n\n\n    var epoch = now.getTime();\n    sql = \"INSERT INTO climate (temp,humid,date,epoch,s_id) values (\"+msg.payload.temperature+\",\"+msg.payload.humidity+\", CONVERT_TZ(now(),'+00:00','+7:00'),\"+epoch+\",1)\";\n    \n    outputs.push({topic:sql});\n    \n    var yyyy = now.getFullYear();\n    var mm = now.getMonth() < 9 ? \"0\" + (now.getMonth() + 1) : (now.getMonth() + 1); // getMonth() is zero-based\n    var dd  = now.getDate() < 10 ? \"0\" + now.getDate() : now.getDate();\n    var hh = now.getHours() < 10 ? \"0\" + now.getHours() : now.getHours();\n    var mmm  = now.getMinutes() < 10 ? \"0\" + now.getMinutes() : now.getMinutes();\n    var ss  = now.getSeconds() < 10 ? \"0\" + now.getSeconds() : now.getSeconds();\n    node.status({fill:\"blue\",shape:\"ring\",text:\"Last update: \"+dd + \".\" + mm + \".\" + yyyy + \" \" + hh + \":\" + mmm + \":\" + ss});    \n    \n    //  count = 0;\n    //  context.set('count',count);\n    return [ outputs ];\n}\nnode.status({fill:\"blue\",shape:\"dot\",text:\"topic: \" + msg.topic + \" payload: \" + msg.payload+\" record1: \"+th});\n\n","outputs":1,"noerr":0,"x":402.8000183105469,"y":507.0000114440918,"wires":[["94a5ad78.d8bbc"]]},{"id":"94a5ad78.d8bbc","type":"mysql","z":"77963358.df6f4c","mydb":"a77c9e11.23eb6","name":"greenhouse","x":950.799919128418,"y":562.999997138977,"wires":[[]]},{"id":"d4b65017.25d2b","type":"function","z":"77963358.df6f4c","name":"SQL","func":"// This will handle any device and any attribute as long as it is in the DB\nvar output = [];\n\noutput.push({topic: \"SELECT * from pump_hour where pump_id=1\"});\noutput.push({topic: \"SELECT * from pump where pump_id=1\"});\n\n//output.push({topic: \"SELECT s_id, max(humid) as Max, min(humid) as Min from climate where s_id = 0 AND epoch >= \" + fromdate + \" AND epoch <= \" + enddate });\n                \n//output.push({ topic: \"SELECT sensor_type, max(value) as Max, min(value) as Min FROM sensor_data WHERE device_no='H001' AND sensor_type='humidity' AND epoch >= \" + fromdate + \" AND epoch <= \" + enddate});\n//output.push({ topic: \"SELECT sensor_type, max(value) as Max, min(value) as Min FROM sensor_data WHERE device_no='T001' AND sensor_type='temperature' AND epoch >= \" + fromdate + \" AND epoch <= \" + enddate});\n\noutput[output.length-1].complete=true;\nreturn [ output ];\n//msg.complete=true;\n//return [output];\n\n\n//msg.topic = \"SELECT * FROM sensor_data WHERE device='growatt' AND sensor='power' AND epoch >= \" + fromdate + \" AND epoch <= \" + epoch ;\n//return msg;","outputs":1,"noerr":0,"x":945.0499229431152,"y":504.0000057220459,"wires":[["94a5ad78.d8bbc"]]},{"id":"bebd77fd.9e97d8","type":"inject","z":"77963358.df6f4c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":787.900016784668,"y":465.0000057220459,"wires":[["d4b65017.25d2b"]]},{"id":"5282e271.c15e7c","type":"debug","z":"77963358.df6f4c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1121.9000244140625,"y":22,"wires":[]},{"id":"e4950411.713a18","type":"inject","z":"77963358.df6f4c","name":"pump","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1394.8999938964844,"y":315,"wires":[["a528e279.ec703"]]},{"id":"9a88de59.a43d3","type":"function","z":"77963358.df6f4c","name":"updateData","func":"var timing = JSON.parse(msg.payload);\n//context.timing_tmp = timing;\nvar outputs = [];\nif(typeof context.timing_tmp =='undefined'){\n    // for(var i=0;i<7;i++){\n    //     for(var j=0;j<24;j++){\n    //         sql = \"UPDATE pump_hour SET start_time = \"+timing[(i*24)+j]+\", frost_time = \"+timing[170+(i*24)+j]+\" WHERE pump_id = 1 AND day = \"+i+\" AND hour = \"+j;\n    //         outputs.push({topic:sql});    \n    //         sql = \"UPDATE fan_hour SET start_time = \"+timing[(340+i*24)+j]+\", frost_time = \"+timing[340+170+(i*24)+j]+\" WHERE fan_id = 1 AND day = \"+i+\" AND hour = \"+j;\n    //         outputs.push({topic:sql});\n    //         sql = \"UPDATE solar_hour SET start_time = \"+timing[680+(i*24)+j]+\", frost_time = \"+timing[680+170+(i*24)+j]+\" WHERE solar_id = 1 AND day = \"+i+\" AND hour = \"+j;\n    //         outputs.push({topic:sql});\n    //     }\n       \n    // }\n    \n}else{\n    for(var i=0;i<7;i++){ // for each day of week\n        for(var j=0;j<24;j++){ //for each hour of day\n            if(parseInt(timing[(i*24)+j])!=parseInt(context.timing_tmp[(i*24)+j]) || parseInt(timing[170+(i*24)+j])!=parseInt(context.timing_tmp[170+(i*24)+j])){\n                //sql = \"UPDATE pump_hour SET start_time = \"+timing[(i*24)+j]+\", frost_time = \"+timing[170+(i*24)+j]+\" WHERE pump_id = 1 AND day = \"+i+\" AND hour = \"+j;\n                sql = \"UPDATE device_prog SET start_time = \"+timing[(i*24)+j]+\", frost_time = \"+timing[170+(i*24)+j]+\" WHERE dev_id = 1 AND day_id = \"+i+\" AND hour_id = \"+j;\n                outputs.push({topic:sql});    \n            }\n            if(parseInt(timing[(340+i*24)+j])!=parseInt(context.timing_tmp[(340+i*24)+j]) || parseInt(timing[340+170+(i*24)+j])!=parseInt(context.timing_tmp[340+170+(i*24)+j])){\n                //sql = \"UPDATE fan_hour SET start_time = \"+timing[(340+i*24)+j]+\", frost_time = \"+timing[340+170+(i*24)+j]+\" WHERE fan_id = 1 AND day = \"+i+\" AND hour = \"+j;\n                sql = \"UPDATE device_prog SET start_time = \"+timing[(340+i*24)+j]+\", frost_time = \"+timing[340+170+(i*24)+j]+\" WHERE dev_id = 2 AND day_id = \"+i+\" AND hour_id = \"+j;\n                outputs.push({topic:sql});\n            }\n            if(parseInt(timing[(680+i*24)+j])!=parseInt(context.timing_tmp[(680+i*24)+j]) || parseInt(timing[680+170+(i*24)+j])!=parseInt(context.timing_tmp[680+170+(i*24)+j])){\n                //sql = \"UPDATE solar_hour SET start_time = \"+timing[680+(i*24)+j]+\", frost_time = \"+timing[680+170+(i*24)+j]+\" WHERE solar_id = 1 AND day = \"+i+\" AND hour = \"+j;\n                sql = \"UPDATE device_prog SET start_time = \"+timing[680+(i*24)+j]+\", frost_time = \"+timing[680+170+(i*24)+j]+\" WHERE dev_id = 3 AND day_id = \"+i+\" AND hour_id = \"+j;\n                outputs.push({topic:sql});\n            }\n            if(parseInt(timing[(340+680+i*24)+j])!=parseInt(context.timing_tmp[(340+680+i*24)+j]) || parseInt(timing[340+680+170+(i*24)+j])!=parseInt(context.timing_tmp[340+680+170+(i*24)+j])){\n                //sql = \"UPDATE solar_hour SET start_time = \"+timing[680+(i*24)+j]+\", frost_time = \"+timing[680+170+(i*24)+j]+\" WHERE solar_id = 1 AND day = \"+i+\" AND hour = \"+j;\n                sql = \"UPDATE device_prog SET start_time = \"+timing[340+680+(i*24)+j]+\", frost_time = \"+timing[340+680+170+(i*24)+j]+\" WHERE dev_id = 4 AND day_id = \"+i+\" AND hour_id = \"+j;\n                outputs.push({topic:sql});\n            }\n        }\n    }\n}\ncontext.timing_tmp = timing;\n//outputs.push({ex1:timing});\n//outputs.push({ex2:context.timing_tmp});\n\n// Update the status with current timestamp\nvar now = new Date();\nnow.setTime(now.getTime() + 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\nvar yyyy = now.getFullYear();\nvar mm = now.getMonth() < 9 ? \"0\" + (now.getMonth() + 1) : (now.getMonth() + 1); // getMonth() is zero-based\nvar dd  = now.getDate() < 10 ? \"0\" + now.getDate() : now.getDate();\nvar hh = now.getHours() < 10 ? \"0\" + now.getHours() : now.getHours();\nvar mmm  = now.getMinutes() < 10 ? \"0\" + now.getMinutes() : now.getMinutes();\nvar ss  = now.getSeconds() < 10 ? \"0\" + now.getSeconds() : now.getSeconds();\nnode.status({fill:\"blue\",shape:\"ring\",text:\"Last update: \"+dd + \".\" + mm + \".\" + yyyy + \" \" + hh + \":\" + mmm + \":\" + ss});    \n\n//outputs[outputs.length-1].complete=true;\nreturn [ outputs ];\n//return msg;\n","outputs":1,"noerr":0,"x":1297.9000434875488,"y":84.38750648498535,"wires":[["305ed438.9d4dcc","28be2207.7504fe"]]},{"id":"6206a238.d4880c","type":"inject","z":"77963358.df6f4c","name":"fan","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1370.9000244140625,"y":361,"wires":[["a528e279.ec703"]]},{"id":"3cb17f89.424de","type":"function","z":"77963358.df6f4c","name":"Restore","func":"// This will handle any device and any attribute as long as it is in the DB\nvar output = [];\n\n// output.push({topic: \"SELECT pump_id,day,hour,start_time,frost_time from pump_hour where pump_id=1 order by day,hour\"});\n// output.push({topic: \"SELECT fan_id,day,hour,start_time,frost_time from fan_hour where fan_id=1 order by day,hour\"});\n// output.push({topic: \"SELECT solar_id,day,hour,start_time,frost_time from solar_hour where solar_id=1 order by day,hour\"});\n\n//output.push({topic: \"SELECT s_id, max(humid) as Max, min(humid) as Min from climate where s_id = 0 AND epoch >= \" + fromdate + \" AND epoch <= \" + enddate });\n//output.push({ topic: \"SELECT sensor_type, max(value) as Max, min(value) as Min FROM sensor_data WHERE device_no='H001' AND sensor_type='humidity' AND epoch >= \" + fromdate + \" AND epoch <= \" + enddate});\n//output.push({ topic: \"SELECT sensor_type, max(value) as Max, min(value) as Min FROM sensor_data WHERE device_no='T001' AND sensor_type='temperature' AND epoch >= \" + fromdate + \" AND epoch <= \" + enddate});\n\n\noutput.push({topic:\"SELECT dev_id,day_id,hour_id,start_time,frost_time FROM device_prog where dev_id=1 order by dev_id,day_id,hour_id asc\"});\noutput.push({topic:\"SELECT dev_id,day_id,hour_id,start_time,frost_time FROM device_prog where dev_id=2 order by dev_id,day_id,hour_id asc\"});\noutput.push({topic:\"SELECT dev_id,day_id,hour_id,start_time,frost_time FROM device_prog where dev_id=3 order by dev_id,day_id,hour_id asc\"});\noutput.push({topic:\"SELECT dev_id,day_id,hour_id,start_time,frost_time FROM device_prog where dev_id=4 order by dev_id,day_id,hour_id asc\"});\noutput[output.length-1].complete=true;\nreturn [ output ];\n//msg.complete=true;\n//return [output];\n\n\n//msg.topic = \"SELECT * FROM sensor_data WHERE device='growatt' AND sensor='power' AND epoch >= \" + fromdate + \" AND epoch <= \" + epoch ;\n//return msg;","outputs":1,"noerr":0,"x":1118,"y":200,"wires":[["30a81cdd.0f3454","acbf7837.306468"]]},{"id":"30a81cdd.0f3454","type":"mysql","z":"77963358.df6f4c","mydb":"a77c9e11.23eb6","name":"greenhouse","x":1337.7499694824219,"y":229.00000286102295,"wires":[["37ad6278.3060de","97902cf8.ee329"]]},{"id":"37ad6278.3060de","type":"join","z":"77963358.df6f4c","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1489,"y":233,"wires":[["bfb87171.ba603","6cc8869d.547088"]]},{"id":"bfb87171.ba603","type":"function","z":"77963358.df6f4c","name":"Prep2","func":"var msg2 = [];\n\n// this is the logic when there are multiple data sets are received\n// for (var i=0; i<msg.payload.length; i++) {\n    //var output = [];\n    //------------------ water ----------------\n    for (var j=0; j<msg.payload[0].length; j++) {\n        msg2.push([msg.payload[0][j].start_time]);\n    }\n    msg2.push([0]); //control device\n    msg2.push([0]); //operation mode\n\n    for (var j=0;j<msg.payload[0].length;j++){\n        msg2.push([msg.payload[0][j].frost_time]);\n    }\n    msg2.push([0]);//เติม 0 ลงไป 2 ตัวเพื่อให้อินเด็กซ์ของ fan ลงตัวเริ่มที่ 170\n    msg2.push([0]);//see context.timing in \"Process Controls\" node\n    \n    //------------------ fan -------------------\n    for (var j=0; j<msg.payload[1].length; j++) {\n        msg2.push([msg.payload[1][j].start_time]);\n    }\n    msg2.push([0]);\n    msg2.push([0]);\n    for (var j=0;j<msg.payload[1].length;j++){\n        msg2.push([msg.payload[1][j].frost_time]);\n    }\n    msg2.push([0]);\n    msg2.push([0]);\n    \n    //---------------- valve1 -------------------\n    for (var j=0; j<msg.payload[2].length; j++) {\n        msg2.push([msg.payload[2][j].start_time]);\n    }\n    msg2.push([0]);\n    msg2.push([0]);\n    for (var j=0;j<msg.payload[2].length;j++){\n        msg2.push([msg.payload[2][j].frost_time]);\n    }\n    msg2.push([0]);\n    msg2.push([0]); \n    \n    //---------------- valve2 ----------------\n    for (var j=0;j<msg.payload[3].length;j++){\n        msg2.push([msg.payload[3][j].frost_time]);\n    }\n    msg2.push([0]);\n    msg2.push([0]);     \n    \n    for (var j=0;j<msg.payload[3].length;j++){\n        msg2.push([msg.payload[3][j].frost_time]);\n    }\n    msg2.push([0]);\n    msg2.push([0]); \n    \n    // for (var j=0;j<msg.payload[5].length;j++){\n    //     msg2.push([msg.payload[5][j].frost_time]);\n    // }\n    // msg2.push([0]);\n    // msg2.push([0]);     \n\n    \n    //msg2.push({payload: msg.payload[0][0].Max,topic: /*msg.payload[1][0].sensor_type+*/\"max\"});\n    //msg2.push({payload: msg.payload[1][0].Min,topic: /*msg.payload[1][0].sensor_type+*/\"min\"});\n\n    //msg2.push({ key: \"test\", values : output});\n// }\n\n//msg.payload=msg2;\n//msg.payload = [ { key: \"Power\", values : output} ];\n//msg.topic = \"Power\";\nmsg.payload = msg2;\nglobal.set(\"timing1\",msg2);\nreturn msg;","outputs":1,"noerr":0,"x":1704.99995803833,"y":253.00000190734863,"wires":[["8c9d54ec.66e568","693db1d7.09259"]]},{"id":"df3e9aae.785c78","type":"inject","z":"77963358.df6f4c","name":"solar","topic":"","payload":"2","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1418,"y":404,"wires":[["a528e279.ec703"]]},{"id":"8f81d7a6.227ea8","type":"function","z":"77963358.df6f4c","name":"Device Control","func":"var timing=global.get(\"timing1\");\n// var timing = msg.timing;\nvar now = new Date();\nnow.setTime( now.getTime() + 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\nif ( typeof context.flag == 'undefined') context.flag = false;\nif (typeof context.pumpstate == 'undefined') context.pumpstate = \"OFF\";\nif (typeof context.mode == 'undefined') context.mode = 0;\n\ncontext.pump_minute = timing[now.getDay()*24+now.getHours()]; //เวลาที่ตั้งไว้\ncontext.pump_frost = timing[now.getDay()*24+170+now.getHours()];\n\ncontext.fan_minute = timing[340+now.getDay()*24+now.getHours()];\ncontext.fan_frost = timing[340+now.getDay()*24+170+now.getHours()];\n\ncontext.light_minute = timing[340+340+now.getDay()*24+now.getHours()];\ncontext.light_frost = timing[340+340+now.getDay()*24+170+now.getHours()];\n\ncontext.valve2_minute = timing[340+340+340+now.getDay()*24+now.getHours()];\ncontext.valve2_frost = timing[340+340+340+now.getDay()*24+170+now.getHours()]; \nvar msgP=[];\nvar msgF=[];\nvar msgS=[];\nvar msgV2=[];\n// mode = timing[msg.control*340+169];\n\n//--checking for pump (spray)\nif(timing[169]===0){\n    //manual mode\n}else if(timing[169]===1){\n    //autometic mode\n}else if(timing[169]===2){\n    //programmable mode\n    if (parseInt(context.pump_minute) <= now.getMinutes() && (parseInt(context.pump_minute)+parseInt(context.pump_frost))>now.getMinutes()){\n        msgP.push({relay:1,colour:\"#aaffaa\"}); \n        // msgP.push({colour:\"#aaffaa\"});\n        // msg.payload = \"ON_WATER\";\n        // msg.topic = \"piedht\";\n    }else{\n        msgP.push({relay:0,colour:\"#aaddff\"}); \n        \n        // msg.payload = \"OFF_WATER\";\n        // msg.topic = \"piedht\";\n    }\n    node.send([msgP,null,null,null]);\n}\n\n//--- checking for fan device\nif(timing[340+169]===0){\n    //manual mode\n}else if(timing[340+169]===1){\n    //autometic mode\n}else if(timing[340+169]===2){\n    //programmable mode\n    if (parseInt(context.fan_minute) <= now.getMinutes() && (parseInt(context.fan_minute)+parseInt(context.fan_frost))>now.getMinutes()){\n        msgF.push({relay:1,colour:\"#aaffaa\"});\n        // msgF.push({colour:\"#aaffaa\"});\n        // msg.payload = \"ON_WATER\";\n        // msg.topic = \"piedht\";\n    }else{\n        msgF.push({relay:0,colour:\"#aaddff\"}); \n        // msg.payload = \"OFF_WATER\";\n        // msg.topic = \"piedht\";\n    }\n    node.send([null,msgF,null,null]);\n    \n}\n\n//--- checking for valve-1 device\nif(timing[2*340+169]===0){\n    //manual mode\n}else if(timing[2*340+169]===1){\n    //autometic mode\n}else if(timing[2*340+169]===2){\n    //programmable mode\n    if (parseInt(context.light_minute) <= now.getMinutes() && (parseInt(context.light_minute)+parseInt(context.light_frost))>now.getMinutes()){\n        msgS.push({relay:1,colour:\"#aaffaa\"});\n        // msgF.push({colour:\"#aaffaa\"});\n        // msg.payload = \"ON_WATER\";\n        // msg.topic = \"piedht\";\n    }else{\n        msgS.push({relay:0,colour:\"#aaddff\"}); \n        // msg.payload = \"OFF_WATER\";\n        // msg.topic = \"piedht\";\n    }\n\n    node.send([null,null,msgS,null]);\n}\n\n//--- checking for valve-2 device\nif(timing[3*340+169]===0){\n    //manual mode\n}else if(timing[3*340+169]===1){\n    //autometic mode\n}else if(timing[3*340+169]===2){\n    //programmable mode\n    if (parseInt(context.valve2_minute) <= now.getMinutes() && (parseInt(context.valve2_minute)+parseInt(context.valve2_frost))>now.getMinutes()){\n        msgV2.push({relay:1,colour:\"#aaffaa\"});\n        // msgF.push({colour:\"#aaffaa\"});\n        // msg.payload = \"ON_WATER\";\n        // msg.topic = \"piedht\";\n    }else{\n        msgV2.push({relay:0,colour:\"#aaddff\"}); \n        // msg.payload = \"OFF_WATER\";\n        // msg.topic = \"piedht\";\n    }\n    node.send([null,null,null,msgV2])\n}\n\n\n// if(mode ===0){ //manual mode\n\n    \n// }else if(mode === 1){ //autometic mode\n\n    \n// }else if(mode === 2){ //prog mode\n//     if (parseInt(context.pump_minute) <= now.getMinutes() && (parseInt(context.pump_minute)+parseInt(context.pump_frost))>now.getMinutes()){\n//         msgP.push({relay:1,colour:\"#aaffaa\"}); \n//         // msgP.push({colour:\"#aaffaa\"});\n//         // msg.payload = \"ON_WATER\";\n//         // msg.topic = \"piedht\";\n//     }else{\n//         msgP.push({relay:0,colour:\"#aaddff\"}); \n        \n//         // msg.payload = \"OFF_WATER\";\n//         // msg.topic = \"piedht\";\n//     }\n//     if (parseInt(context.fan_minute) <= now.getMinutes() && (parseInt(context.fan_minute)+parseInt(context.fan_frost))>now.getMinutes()){\n//         msgF.push({relay:1,colour:\"#aaffaa\"});\n//         // msgF.push({colour:\"#aaffaa\"});\n//         // msg.payload = \"ON_WATER\";\n//         // msg.topic = \"piedht\";\n//     }else{\n//         msgF.push({relay:0,colour:\"#aaddff\"}); \n//         // msg.payload = \"OFF_WATER\";\n//         // msg.topic = \"piedht\";\n//     }\n    \n//     if (parseInt(context.light_minute) <= now.getMinutes() && (parseInt(context.light_minute)+parseInt(context.light_frost))>now.getMinutes()){\n//         msgS.push({relay:1,colour:\"#aaffaa\"});\n//         // msgF.push({colour:\"#aaffaa\"});\n//         // msg.payload = \"ON_WATER\";\n//         // msg.topic = \"piedht\";\n//     }else{\n//         msgS.push({relay:0,colour:\"#aaddff\"}); \n//         // msg.payload = \"OFF_WATER\";\n//         // msg.topic = \"piedht\";\n//     }\n    \n//     if (parseInt(context.valve2_minute) <= now.getMinutes() && (parseInt(context.valve2_minute)+parseInt(context.valve2_frost))>now.getMinutes()){\n//         msgV2.push({relay:1,colour:\"#aaffaa\"});\n//         // msgF.push({colour:\"#aaffaa\"});\n//         // msg.payload = \"ON_WATER\";\n//         // msg.topic = \"piedht\";\n//     }else{\n//         msgV2.push({relay:0,colour:\"#aaddff\"}); \n//         // msg.payload = \"OFF_WATER\";\n//         // msg.topic = \"piedht\";\n//     }\n    \n    // node.send([msgP,null,null,null]);\n    // node.send([null,msgF,null,null]);\n    // node.send([null,null,msgS,null]);\n    // node.send([null,null,null,msgV2])\n// }\n\n\n\n\nmsg.settime = (\"0\"+msg.hour).slice(-2)+\":\"+(\"0\"+msg.minute).slice(-2)+\"น.\";//timing[169];\n\nnode.status({fill:\"blue\",shape:\"dot\",text:\"run=\"+msg.run+\" Set point (\"+now.getDay()+\":\"+now.getHours()+\":\"+now.getMinutes()+\") : (P\"+context.pump_minute+\":\"+context.pump_frost+\" ) : (S\"+context.light_minute+\":\"+context.light_frost});\n\n//return [msg,null,null];\n\n\n\n\n\n","outputs":4,"noerr":0,"x":899.9999847412109,"y":320.00000381469727,"wires":[["309e1c7b.c2bf74"],["874fae71.1924a"],["cbc3e241.8636b"],["904ead23.31089"]]},{"id":"309e1c7b.c2bf74","type":"function","z":"77963358.df6f4c","name":"spray","func":"var now = new Date();\nnow.setTime( now.getTime() + 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\nmsg.topic = \"/house1/control/spray\";\nmsg.payload = (msg.relay===0)?\"OFF_SPRAY\":\"ON_SPRAY\";\n\nnode.status({fill:\"blue\",shape:\"dot\",text:\"topic: \" + msg.topic + \" payload: \" + msg.payload});\n\n\nreturn msg;","outputs":"1","noerr":0,"x":1201.9999923706055,"y":299.0000057220459,"wires":[["34838227.915b1e"]]},{"id":"874fae71.1924a","type":"function","z":"77963358.df6f4c","name":"fan","func":"var now = new Date();\nnow.setTime( now.getTime() + 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\nmsg.topic = \"/house1/control/fan\";\nmsg.payload = (msg.relay===0)?\"OFF_FAN\":\"ON_FAN\";\n\nnode.status({fill:\"blue\",shape:\"dot\",text:\"topic: \" + msg.topic + \" payload: \" + msg.payload});\n\n\nreturn msg;","outputs":"1","noerr":0,"x":1210.0174751281738,"y":373.8993721008301,"wires":[["34838227.915b1e"]]},{"id":"acbf7837.306468","type":"debug","z":"77963358.df6f4c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1676,"y":97,"wires":[]},{"id":"28be2207.7504fe","type":"mysql","z":"77963358.df6f4c","mydb":"a77c9e11.23eb6","name":"greenhouse","x":1571.400047302246,"y":154.00001335144043,"wires":[[]]},{"id":"d67422a5.14011","type":"debug","z":"77963358.df6f4c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":614.0000035762787,"y":816,"wires":[]},{"id":"f1955c1e.ccb27","type":"mqtt in","z":"77963358.df6f4c","name":"","topic":"/house1/state/#","qos":"2","broker":"5ac6ecde.6c6a94","x":97,"y":394.00010681152344,"wires":[["3f53ae5a.f0c172","8b4d64e0.5076e8"]]},{"id":"34838227.915b1e","type":"mqtt out","z":"77963358.df6f4c","name":"/house1/control/#","topic":"","qos":"","retain":"","broker":"5ac6ecde.6c6a94","x":1043.1001243591309,"y":434.0000066757202,"wires":[]},{"id":"26c82fc8.965ec","type":"debug","z":"77963358.df6f4c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":617.1000556945801,"y":605.000009059906,"wires":[]},{"id":"3f53ae5a.f0c172","type":"switch","z":"77963358.df6f4c","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"/house1/state/fan","vt":"str"},{"t":"eq","v":"/house1/state/valve1","vt":"str"},{"t":"eq","v":"/house1/state/spray","vt":"str"},{"t":"eq","v":"/house1/state/dht","vt":"str"},{"t":"eq","v":"/house1/state/error","vt":"str"},{"t":"eq","v":"/house1/state/valve2","vt":"str"},{"t":"eq","v":"/house1/state/soil","vt":"str"},{"t":"eq","v":"/house1/state/reload/home","vt":"str"},{"t":"eq","v":"/house1/state/reload/graphsH","vt":"str"}],"checkall":"true","repair":false,"outputs":9,"x":180.10000610351562,"y":468.00000381469727,"wires":[["432b56c6.c452a8"],["b904ee55.64588","6596ac2f.17b874"],["26c82fc8.965ec","4e5113b4.8d914c","629a8fd7.c8adb"],["f23454ce.377fa8","f582e064.11d6c","35b57bb1.e4b4b4","4b6ed62f.315998"],["5751b69e.3d25c8"],["d30e586e.723c88","fea2c496.8cf608"],["8b2fc8be.7bd318","d670a4d2.21f7f8"],["c4fa5aa8.2cd1a8"],["2f503173.35fb5e"]]},{"id":"5751b69e.3d25c8","type":"function","z":"77963358.df6f4c","name":"error msg","func":"function theNewDate()\n{\n   var d = new Date();\n   d.setTime( d.getTime() + 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\n    minutes = d.getMinutes().toString().length == 1 ? '0'+d.getMinutes() : d.getMinutes();\n    hours = d.getHours().toString().length == 1 ? '0'+d.getHours() : d.getHours();\n   // ampm = d.getHours() >= 12 ? 'pm' : 'am';\n    months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n    days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];\n    var m= days[d.getDay()]+' '+months[d.getMonth()]+' '+d.getDate()+' '+d.getFullYear()+' '+hours+':'+minutes;\n    return m;\n}\n\n\nmsg.topic=theNewDate();\nmsg.value = 0;\nreturn msg;\n","outputs":1,"noerr":0,"x":347.0000035762787,"y":815,"wires":[["39659e17.63ddf2","15d1fd84.eacc02"]]},{"id":"ae355f8c.c0b15","type":"debug","z":"77963358.df6f4c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":744.0001068115234,"y":282.00000381469727,"wires":[]},{"id":"8c9d54ec.66e568","type":"debug","z":"77963358.df6f4c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1750,"y":146,"wires":[]},{"id":"6cc8869d.547088","type":"debug","z":"77963358.df6f4c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1852,"y":195,"wires":[]},{"id":"871a3ecf.181ed","type":"inject","z":"77963358.df6f4c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1145.00004196167,"y":260.00000381469727,"wires":[["3cb17f89.424de"]]},{"id":"97902cf8.ee329","type":"debug","z":"77963358.df6f4c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1495,"y":287,"wires":[]},{"id":"df1a779f.41c118","type":"debug","z":"77963358.df6f4c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":579.0000076293945,"y":492.00000762939453,"wires":[]},{"id":"4583f81a.cd8a18","type":"function","z":"77963358.df6f4c","name":"","func":"if(msg.payload==\"ON_SPRAY\" || msg.payload==\"OFF_SPRAY\"){\n    msg.payload = \"WAIT\";\n    return msg;\n}\n\n","outputs":1,"noerr":0,"x":314,"y":135,"wires":[["4e5113b4.8d914c","2672132.fb60aec"]]},{"id":"2672132.fb60aec","type":"debug","z":"77963358.df6f4c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":524.0000038146973,"y":190.00000381469727,"wires":[]},{"id":"6a33cc5c.443934","type":"function","z":"77963358.df6f4c","name":"","func":"if(msg.payload==\"ON_FAN\" || msg.payload==\"OFF_FAN\"){\n    msg.payload = \"WAIT\";\n    return msg;\n}\n\n","outputs":1,"noerr":0,"x":309.00000381469727,"y":247.00000381469727,"wires":[["432b56c6.c452a8"]]},{"id":"e33ca316.edb7f","type":"debug","z":"77963358.df6f4c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":549.0000038146973,"y":404.00000381469727,"wires":[]},{"id":"629a8fd7.c8adb","type":"function","z":"77963358.df6f4c","name":"storing water","func":"var outputs = [];\nif(typeof context.flag == 'undefined')context.flag = false;\nif(typeof context.count == 'undefined')context.count= 1;\nif(typeof context.sum == 'undefined')context.sum = 0;\n\n\nvar now = new Date();\nnow.setTime(now.getTime() + 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\nif(typeof context.epoch_start == 'undefined')context.epoch_start=now.getTime();\nif(typeof context.epoch_end == 'undefined') context.epoch_end=now.getTime();\n\nif(context.flag===false && msg.payload!==\"\" && parseFloat(msg.payload)>0){\n\n    context.sum += parseFloat(msg.payload);\n    if(context.count==1){\n        context.epoch_start = now.getTime();\n    }\n    context.count++;\n    \n}else if(context.flag===false && msg.payload!==\"\" && parseFloat(msg.payload)===0){\n    context.flag = true;\n    context.epoch_end = now.getTime();\n}\nif(context.flag === true){\n \n    // Update the status with current timestamp\n    qty = context.sum/(context.count*5.0); //5 stands for average 5 seconds, node MCU sends a payload every 5 seconds.\n    sql = \"INSERT INTO water (start_time,end_time,qty,pump_id) values (\"+context.epoch_start+\",\"+context.epoch_end+\",\"+qty+\",1)\";\n    \n    outputs.push({topic:sql});\n    \n    var yyyy = now.getFullYear();\n    var mm = now.getMonth() < 9 ? \"0\" + (now.getMonth() + 1) : (now.getMonth() + 1); // getMonth() is zero-based\n    var dd  = now.getDate() < 10 ? \"0\" + now.getDate() : now.getDate();\n    var hh = now.getHours() < 10 ? \"0\" + now.getHours() : now.getHours();\n    var mmm  = now.getMinutes() < 10 ? \"0\" + now.getMinutes() : now.getMinutes();\n    var ss  = now.getSeconds() < 10 ? \"0\" + now.getSeconds() : now.getSeconds();\n    node.status({fill:\"blue\",shape:\"ring\",text:\"Last update: \"+dd + \".\" + mm + \".\" + yyyy + \" \" + hh + \":\" + mmm + \":\" + ss});    \n    \n    context.count = 1;\n    context.flag = false;\n    return [ outputs ];\n}\n","outputs":1,"noerr":0,"x":393.00000762939453,"y":557.9999189376831,"wires":[["342104.2465eefc","94a5ad78.d8bbc"]]},{"id":"342104.2465eefc","type":"debug","z":"77963358.df6f4c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":584.7869071960449,"y":547.5710525512695,"wires":[]},{"id":"4cb9525c.e2e25c","type":"inject","z":"77963358.df6f4c","name":"","topic":"/state/temp","payload":"ON","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":109.02820777893066,"y":551.6131601333618,"wires":[["3f53ae5a.f0c172"]]},{"id":"d6e4fd34.fc6b7","type":"inject","z":"77963358.df6f4c","name":"","topic":"/state/temp","payload":"OFF","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":113,"y":595.9148082733154,"wires":[["3f53ae5a.f0c172"]]},{"id":"f6cc04d9.2d0148","type":"ui_ui_control","z":"77963358.df6f4c","name":"","x":1140.000015258789,"y":159.00000190734863,"wires":[[]]},{"id":"432b56c6.c452a8","type":"ui_template","z":"77963358.df6f4c","group":"5488c752.3230e8","name":"FAN","order":4,"width":"1","height":"1","format":"\n<script>\n   (function(scope){\n        scope.$watch('msg', function(msg) {\n             if(msg.payload==\"WAIT\"){\n                $(\"#fan\").css(\"background-color\",\"#aaddff\"); \n                 $(\"#fan\").text(\"Waiting\"); \n            } else if (msg.payload!=\"\" && msg.payload==\"ON\"){\n                 $(\"#fan\").text(msg.payload);\n                 $(\"#fan\").css(\"background-color\",\"#88ff88\"); \n                 msg.mode = \"ON\";\n             }else if (msg.payload!=\"\" && msg.payload==\"OFF\"){\n                 $(\"#fan\").text(msg.payload);\n                 $(\"#fan\").css(\"background-color\",\"#ff8888\"); \n                 msg.mode = \"OFF\";\n             }\n             \n            //  if (msg.colour!=\"\") $(\"#infor\").css(\"background-color\",msg.colour);\n        });\n \n    })(scope);\n</script>\n<table   ng-click=\"(msg.mode == 'ON')?send({payload:'OFF_FAN',topic:'/house1/control/fan'}):send({payload:'ON_FAN',topic:'/house1/control/fan'})\" width=100% height=100% class=\"vibrate zui-table zui-table-rounded\">\n    <thead>\n        <tr>\n            <th>FAN</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr >\n            <td id=\"fan\"></td>\n        </tr>\n\n    </tbody>\n</table>\n\n","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":310.00000381469727,"y":288.00000381469727,"wires":[["34838227.915b1e","6a33cc5c.443934","1696514f.7e572f"]]},{"id":"6d28cda1.d4d944","type":"ui_template","z":"77963358.df6f4c","group":"5488c752.3230e8","name":"Hand ICON","order":7,"width":"1","height":"1","format":"  <md-button  class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"(msg.payload)?send({payload:'OFF_FAN',topic:'/house1/control/fan'}):send({payload:'ON_FAN',topic:'/house1/control/fan'})\"> \n                <img style=\"outline : none;\" \n                             ng-src=\"{{(msg.payload)?'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/autometic1.jpg':'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/manual1.jpg'}}\" \n                              height=\"36px\"\n                />\n</md-button> ","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":379.00000381469727,"y":363.00000381469727,"wires":[["73722581.4174bc","31d720d9.93821"]]},{"id":"b904ee55.64588","type":"ui_template","z":"77963358.df6f4c","group":"5488c752.3230e8","name":"VALVE1","order":5,"width":"1","height":"1","format":"<script>\n   (function(scope){\n        scope.$watch('msg', function(msg) {\n            // if (msg.payload!=\"\") $(\"#infor\").text(Number(parseInt(msg.payload)).toLocaleString('en-GB')+\"L/h\");\n            // if (msg.colour!=\"\") $(\"#infor\").css(\"background-color\",msg.colour);\n             \n            if(msg.payload==\"WAIT\"){\n                $(\"#solar\").css(\"background-color\",\"#aaddff\"); \n                 $(\"#solar\").text(\"Waiting\"); \n            } else if (msg.payload!=\"\" && parseInt(msg.payload)>=0){\n                $(\"#solar\").text(Number(parseInt(msg.payload)).toLocaleString('en-GB')+\"Lux\");\n                $(\"#solar\").css(\"background-color\",\"#88ff88\"); \n                msg.mode = \"ON\";\n             }else if(msg.payload == \"ON\"){\n                $(\"#solar\").text(\"ON\");\n                $(\"#solar\").css(\"background-color\",\"#88ff88\"); \n                msg.mode=\"ON\";\n             }else{// if (msg.payload!=\"\" && msg.payload==\"OFF\"){\n                $(\"#solar\").text(\"OFF\");\n                $(\"#solar\").css(\"background-color\",\"#ff8888\");\n                 //if (msg.colour!=\"\") $(\"#infor\").css(\"background-color\",msg.colour);\n                msg.mode = \"OFF\";\n             }\n        });\n \n    })(scope);\n</script>\n<table  ng-click=\"(msg.mode=='ON')?send({payload:'OFF_VALVE1',topic:'/house1/control/valve1'}):send({payload:'ON_VALVE1',topic:'/house1/control/valve1'})\" width=100% height=100% class=\"vibrate zui-table zui-table-rounded\">\n    <thead>\n        <tr>\n            <th>VALVE1</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr >\n            <td id=\"solar\"></td>\n        </tr>\n\n    </tbody>\n</table>\n","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":111,"y":192,"wires":[["e4a18d4.684aa7","34838227.915b1e"]]},{"id":"8b2fc8be.7bd318","type":"ui_template","z":"77963358.df6f4c","group":"5488c752.3230e8","name":"Soil","order":8,"width":"1","height":"1","format":"<script>\n   (function(scope){\n        scope.$watch('msg', function(msg) {\n            // if (msg.payload!=\"\") $(\"#infor\").text(Number(parseInt(msg.payload)).toLocaleString('en-GB')+\"L/h\");\n            // if (msg.colour!=\"\") $(\"#infor\").css(\"background-color\",msg.colour);\n             \n            if(msg.payload==\"WAIT\"){\n                $(\"#soil\").css(\"background-color\",\"#aaddff\"); \n                 $(\"#soil\").text(\"Waiting\"); \n            } else if (msg.payload!=\"\" && parseInt(msg.payload)>=0){\n                $(\"#soil\").text(Number(parseInt(msg.payload)).toLocaleString('en-GB')+\"%\");\n                $(\"#soil\").css(\"background-color\",\"#88ff88\"); \n                msg.mode = \"ON\";\n             }else if(msg.payload == \"ON\"){\n                $(\"#soil\").text(\"ON\");\n                $(\"#soil\").css(\"background-color\",\"#88ff88\"); \n                msg.mode=\"ON\";\n             }else{// if (msg.payload!=\"\" && msg.payload==\"OFF\"){\n                $(\"#soil\").text(\"OFF\");\n                $(\"#soil\").css(\"background-color\",\"#ff8888\");\n                 //if (msg.colour!=\"\") $(\"#infor\").css(\"background-color\",msg.colour);\n                msg.mode = \"OFF\";\n             }\n        });\n \n    })(scope);\n</script>\n\n<table ng-click=\"send({payload: 'a'})\" width=100% height=100% class=\"vibrate zui-table zui-table-rounded\">\n    <thead>\n        <tr>\n            <th>SOIL</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr>\n            <td id=\"soil\"></td>\n    \n        </tr>\n\n\n    </tbody>\n</table>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":109,"y":266.0000305175781,"wires":[[]]},{"id":"39659e17.63ddf2","type":"ui_template","z":"77963358.df6f4c","group":"5488c752.3230e8","name":"STATUS","order":9,"width":"3","height":"1","format":"<script>\n// if(typeof context.humidity == 'undefined')context.humidity = 0;\n// if(typeof context.flowrate == 'undefined')context.flowrate = 0;\n// if(typeof context.soil == 'undefined')context.soil = 0;\n// if(typeof context.slot == 'undefined')context.slot = 0; //using for managing the time slot display\n   \n// function theNewDate()\n// {\n//   var d = new Date();\n//   d.setTime( d.getTime() + 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\n//     minutes = d.getMinutes().toString().length == 1 ? '0'+d.getMinutes() : d.getMinutes();\n//     hours = d.getHours().toString().length == 1 ? '0'+d.getHours() : d.getHours();\n//   // ampm = d.getHours() >= 12 ? 'pm' : 'am';\n//     months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n//     days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];\n//     var m= days[d.getDay()]+' '+months[d.getMonth()]+' '+d.getDate()+' '+d.getFullYear()+' '+hours+':'+minutes;\n//     return m;\n// }\n\n\n   (function(scope){\n        scope.$watch('msg', function(msg) {\n            if (msg.topic!=\"\") $(\"#hdr1\").text(msg.topic);\n            if (msg.payload!=\"\") $(\"#bod1\").text(msg.payload);\n            // if (msg.payload != \"\"){\n            //     $(\"#bod1\").text(\"1111\"));\n            //     var tm = setTimeout(function() {\n            //          $(\"#bod1\").text(\"22222\");\n            //          clearTimeout(tm);\n            //     }, 3000);\n            // }\n        });\n    })(scope);\n</script>\n\n<table ng-click=\"send({payload: 'a'})\" width=100% height=100% class=\"zui-table zui-table-rounded\">\n    <thead>\n        <tr>\n            <th id=\"hdr1\"></th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr>\n            <td id=\"bod1\"></td>\n    \n        </tr>\n\n    </tbody>\n</table>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":838.0000152587891,"y":626.0000104904175,"wires":[[]]},{"id":"b62a3c09.0a3cd","type":"ui_template","z":"77963358.df6f4c","group":"5488c752.3230e8","name":"Settings page","order":2,"width":"6","height":"6","format":"<style>\n.thedays { vertical-align:bottom; height:54px;color:magenta; }\n.thedays2 { vertical-align:bottom; height:54px;color:#55dd55; }\n\n.the2px  { background-color:black; height:2px; }\n.the2px_green  { background-color:green; height:2px; }\n.theblocks {width:100%; height:0%; background-color:green; }\n.greybuttons { background-color:#dddddd !important; width:48px; }\n.thetemps { font-size:70%; color:#888888 !important; }\n.thetemps2 { font-size:70%; color:magenta !important; }\n.smallheadings { color:black; font-size:80%; }\n.smallheadings2 { color:blue; font-size:80%; font-weight: bold; }\n</style>\n\n<script>\n\nvar thedays = [\"SUNDAY\", \"MONDAY\", \"TUESDAY\", \"WEDNESDAY\", \"THURSDAY\", \"FRIDAY\", \"SATURDAY\"];\nvar controls =[\"water_icon2.png\",\"fan_icon2.png\",\"solar_icon2.png\"];\nvar records = [\"NO\",\"YES\"];\nvar txts = [\"SPRAY\",\"FAN\",\"VALVE1\",\"VALVE2\"];\n\nvar runs =[\"MAN\",\"AUTO\",\"PROG\"];\n\nvar last = 1;\n\nfunction bar(mm, val) {\n  \n  if (val =>0 && val<= 5) {\n    $(mm).height(val+\"%\");\n    $(mm).css('background-color', '#6666ff');\n  } //blue\n  if (val>5 && val <= 10) {\n    $(mm).height(val+\"%\");\n    $(mm).css('background-color', '#5577ff');\n  }\n  if (val >10 && val <= 15) {\n    $(mm).height(val+\"%\");\n    $(mm).css('background-color', '#5599ff');\n  }\n  if (val>15 && val<=20) {\n    $(mm).height(val+\"%\");\n    $(mm).css('background-color', '#55ccdd');\n  } // cyan\n  if (val>20 && val<=25) {\n    $(mm).height(val+\"%\");\n    $(mm).css('background-color', '#55ddaa');\n  }\n  if (val>25 && val<=30) {\n    $(mm).height(val+\"%\");\n    $(mm).css('background-color', '#55dd55');\n  }\n  if (val>30 && val<=35) {\n    $(mm).height(val+\"%\");\n    $(mm).css('background-color', '#55dd55');\n  } // green\n  if (val>35 && val<=40) {\n    $(mm).height(\"40%\");\n    $(mm).css('background-color', '#55dd55');\n  }\n  if (val>40 && val<=45) {\n    $(mm).height(val+\"%\");\n    $(mm).css('background-color', '#aadd55');\n  }\n  if (val>45 && val<=50) {\n    $(mm).height(val+\"%\");\n    $(mm).css('background-color', '#dddd55');\n  } // yellow\n  if (val>50 && val<=55) {\n    $(mm).height(val+\"%\");\n    $(mm).css('background-color', '#ffaa55');\n  }\n  if (val>55 && val<=57) {\n    $(mm).height(val+\"%\");\n    $(mm).css('background-color', '#ff8855');\n  }\n  if (val>57 && val<=60) {\n    $(mm).height(val+\"%\");\n    $(mm).css('background-color', '#ff7777');\n  } // red\n\n}\n\nfunction selec(val, sta) {\n  var w = \"#td\" + val;\n\n  if (sta==1) $(w).css('background-color', '#55dd55');\n//   else if (sta ==2) $(w).css('background-color', '#55dd55');\n  else if (sta ==2) $(w).css('background-color', 'magenta');\n  \n  else $(w).css('background-color', 'black');\n\n//   if(val==1)$(w).css('background-color', '#55dd55');  else $(w).css('background-color', 'black');\n//   if(val==2)$(w).css('background-color', '#55dd55');  else $(w).css('background-color', 'black');\n//   if(val==29)$(w).css('background-color', '#55dd55'); else $(w).css('background-color', 'black');\n//   if(val==30)$(w).css('background-color', '#55dd55'); else $(w).css('background-color', 'black');    \n    \n}\n\n(function(scope) {\n  scope.$watch('msg', function(msg) {\n    selec(last, 0);\n    last = msg.selector;\n    if(msg.frost===true) selec(last, 2);\n    else selec(last,1);\n    \n    for (var x = 0; x < 24; x++) {\n      var w = \"#t\" + x;\n      //(msg.control*340)+\n      bar(w, msg.timing[(msg.control*340)+170+((msg.days - 1) * 24) + x]);\n      var v = \"#v\" + x;\n    //   $(v).text(msg.timing[(msg.control*340)+((msg.days - 1) * 24) + x]+\"m\")\n      $(v).css('color', 'magenta');\n    //   $(v).text(\"+\"+(\"0\"+msg.timing[(msg.control*340)+170+((msg.days - 1) * 24) + x]).slice(-2))\n      $(v).html(\"+\"+(\"0\"+msg.timing[(msg.control*340)+170+((msg.days - 1) * 24) + x]).slice(-2))\n      \n      var f = \"#f\" + x;\n      $(f).css('color', '#55dd55');\n      $(f).text(msg.timing[(msg.control*340)+((msg.days - 1) * 24) + x]+\"m\");\n    \n      \n    //   if(msg.days==day && x==hour){\n    //       $(\"#td\"+(x+5)).css('background-color', 'red');\n    //   }\n    }\n    // for (var x = 0; x < 2; x++) {\n    //   var w = \"#s\" + x;\n    //   $(w).text(msg.timing[172+((msg.days - 1) * 24) + msg.hourSelected] + \"min\");\n    // }\n    //$(\"#s0\").html(\"<img src='http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/\"+controls[msg.control]+\"' height='30px'/>\");\n    $(\"#s0\").html(\"<center><span class='smallheadings2'>\"+txts[msg.control]+\"</span></center>\");\n    \n    \n    //$(\"#s1\").text(runs[msg.run]);//(msg.timing[172+((msg.days - 1) * 24) + msg.hourSelected] + \"min\");\n    //$(\"#s1\").html(\"<center><span class='smallheadings2'>\"+runs[msg.run]+\"</span></center>\");\n    $(\"#s1\").html(\"<center><span class='smallheadings2'>\"+runs[msg.timing[msg.control*340+169]]+\"</span></center>\");\n    //$(\"#s2\").text(records[msg.record]);\n   \n    if(msg.record==0) $(\"#s2\").html(\"<center><span class='smallheadings2'>NO</span></center>\");\n    else $(\"#s2\").html(\"<center><span class='smallheadings2'>\"+(\"0\"+msg.record).slice(-2)+ \"m\"+\"</span></center>\");\n   \n    // if(msg.timing[msg.control*168]==0) $(\"#s2\").html(\"<center><span class='smallheadings2'>NO</span></center>\");\n    // else $(\"#s2\").html(\"<center><span class='smallheadings2'>\"+(\"0\"+msg.timing[msg.control*169]).slice(-2)+ \"m\"+\"</span></center>\");\n   \n    \n    $(\"#d0\").text(thedays[msg.days - 1]);\n    // if ((last > 4) && (last < 29))\n    //   $(\"#current\").text(msg.timing[((msg.days - 1) * 24) + last - 5] + \"C\");\n    // else\n    //   $(\"#current\").text(\"-\");\n    \n    \n   \n   myStatus=msg.myStatus;\n   if (msg.foryou != \"\")\n   {\n       $(\"#info\").text(msg.foryou);\n       var tm = setTimeout(function() {\n             $(\"#info\").text(myStatus);\n             clearTimeout(tm);\n       }, 3000);\n    }\n  });\n})(scope);\n\n</script>\n<table width=\"100%\">\n  <tr style=\"height:2px\">\n    <td colspan=12 style=\"background-color:black;height:5px;\"></td>\n  </tr>\n\n  <tr>\n    <td colspan=6>\n      <center><span class=\"smallheadings\">Day</span></center>\n    </td>\n    <td colspan=2>\n      <center><span class=\"smallheadings\">Control</span></center>\n    </td>\n    <td colspan=2>\n      <center><span class=\"smallheadings\">Mode</span></center>\n    </td>\n    <td colspan=2>\n      <center><span class=\"smallheadings\">Record</span></center>\n    </td>\n  </tr>\n\n  <tr>\n    <td ng-click=\"send({payload: '29'})\" colspan=6>\n      <center><span id=\"d0\" style=\"color:blue;font-size:110%\">MONDAY</span></center>\n    </td>\n    <td ng-click=\"send({payload: '1'})\" colspan=2>\n      <center><span id=\"s0\" style=\"color:blue;font-size:110%\">14</span></center>\n    </td>\n    <td ng-click=\"send({payload: '2'})\" colspan=2>\n      <center><span id=\"s1\" style=\"color:blue;font-size:110%\">PROG</span></center>\n    </td>\n    <td ng-click=\"send({payload: '30'})\" colspan=2>\n      <center><span id=\"s2\" style=\"color:blue;font-size:110%\">NO\n          <!--<md-button id=\"btn\" class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'mode'})\"> -->\n          <!--      <img style=\"outline : none;\" -->\n          <!--                   ng-src=\"{{(msg.payload==true)?'/images/autometic.jpg':'/images/fan_icon.png'}}\" -->\n          <!--                    height=\"22px\"-->\n          <!--      />-->\n          <!--      </md-button> -->\n          \n      </span></center>\n    </td>\n  </tr>\n\n  <tr style=\"height:2px\">\n    <td id=\"td29\" colspan=6 style=\"background-color:black;height:2px;\"></td>\n    <td id=\"td1\" colspan=2 style=\"background-color:black;height:2px;\"></td>\n    <td id=\"td2\" colspan=2 style=\"background-color:black;height:2px;\"></td>\n    <td id=\"td30\" colspan=2 style=\"background-color:black;height:2px;\"></td>\n  </tr>\n\n  <tr>\n    <td ng-click=\"send({payload: '5'})\" class=\"thedays\"><span id=\"v0\" class=\"thetemps2\"></span>\n      <div id=\"f0\" class=\"thetemps\">+20</div>\n      <div id=\"t0\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '6'})\" class=\"thedays\"><span id=\"v1\" class=\"thetemps2\"></span>\n      <div id=\"f1\" class=\"thetemps\">+20</div>\n      <div id=\"t1\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '7'})\" class=\"thedays\"><span id=\"v2\" class=\"thetemps2\"></span>\n      <div id=\"f2\" class=\"thetemps\">+20</div>\n      <div id=\"t2\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '8'})\" class=\"thedays\"><span id=\"v3\" class=\"thetemps2\"></span>\n      <div id=\"f3\" class=\"thetemps\">+20</div>\n      <div id=\"t3\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '9'})\" class=\"thedays\"><span id=\"v4\" class=\"thetemps2\"></span>\n      <div id=\"f4\" class=\"thetemps\">+20</div>\n      <div id=\"t4\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '10'})\" class=\"thedays\"><span id=\"v5\" class=\"thetemps2\"></span>\n      <div id=\"f5\" class=\"thetemps\">+20</div>\n      <div id=\"t5\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '11'})\" class=\"thedays\"><span id=\"v6\" class=\"thetemps2\"></span>\n      <div id=\"f6\" class=\"thetemps\">+20</div>\n      <div id=\"t6\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '12'})\" class=\"thedays\"><span id=\"v7\" class=\"thetemps2\"></span>\n      <div id=\"f7\" class=\"thetemps\">+20</div>\n      <div id=\"t7\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '13'})\" class=\"thedays\"><span id=\"v8\" class=\"thetemps2\"></span>\n      <div id=\"f8\" class=\"thetemps\">+20</div>\n      <div id=\"t8\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '14'})\" class=\"thedays\"><span id=\"v9\" class=\"thetemps2\"></span>\n      <div id=\"f9\" class=\"thetemps\">+20</div>\n      <div id=\"t9\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '15'})\" class=\"thedays\"><span id=\"v10\" class=\"thetemps2\"></span>\n      <div id=\"f10\" class=\"thetemps\">+20</div>\n      <div id=\"t10\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '16'})\" class=\"thedays\"><span id=\"v11\" class=\"thetemps2\"></span>\n      <div id=\"f11\" class=\"thetemps\">+20</div>\n      <div id=\"t11\" class=\"theblocks\"></div>\n    </td>\n  </tr>\n\n\n  <tr style=\"height:2px\">\n    <td id=\"td5\" class=\"the2px\"></td>\n    <td id=\"td6\" class=\"the2px\"></td>\n    <td id=\"td7\" class=\"the2px\"></td>\n    <td id=\"td8\" class=\"the2px\"></td>\n    <td id=\"td9\" class=\"the2px\"></td>\n    <td id=\"td10\" class=\"the2px\"></td>\n    <td id=\"td11\" class=\"the2px\"></td>\n    <td id=\"td12\" class=\"the2px\"></td>\n    <td id=\"td13\" class=\"the2px\"></td>\n    <td id=\"td14\" class=\"the2px\"></td>\n    <td id=\"td15\" class=\"the2px\"></td>\n    <td id=\"td16\" class=\"the2px\"></td>\n  </tr>\n\n\n\n\n  <tr>\n    <td>0</td>\n    <td>1</td>\n    <td>2</td>\n    <td>3</td>\n    <td>4</td>\n    <td>5</td>\n    <td>6</td>\n    <td>7</td>\n    <td>8</td>\n    <td>9</td>\n    <td>10</td>\n    <td>11</td>\n  </tr>\n\n  <tr>\n    <td ng-click=\"send({payload: '17'})\" class=\"thedays\"><span id=\"v12\" class=\"thetemps2\"></span>\n      <div id=\"f12\" class=\"thetemps\">+20</div>\n      <div id=\"t12\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '18'})\" class=\"thedays\"><span id=\"v13\" class=\"thetemps2\"></span>\n      <div id=\"f13\" class=\"thetemps\">+20</div>\n      <div id=\"t13\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '19'})\" class=\"thedays\"><span id=\"v14\" class=\"thetemps2\"></span>\n      <div id=\"f14\" class=\"thetemps\">+20</div>\n      <div id=\"t14\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '20'})\" class=\"thedays\"><span id=\"v15\" class=\"thetemps2\"></span>\n      <div id=\"f15\" class=\"thetemps\">+20</div>\n      <div id=\"t15\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '21'})\" class=\"thedays\"><span id=\"v16\" class=\"thetemps2\"></span>\n      <div id=\"f16\" class=\"thetemps\">+20</div>\n      <div id=\"t16\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '22'})\" class=\"thedays\"><span id=\"v17\" class=\"thetemps2\"></span>\n      <div id=\"f17\" class=\"thetemps\">+20</div>\n      <div id=\"t17\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '23'})\" class=\"thedays\"><span id=\"v18\" class=\"thetemps2\"></span>\n      <div id=\"f18\" class=\"thetemps\">+20</div>\n      <div id=\"t18\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '24'})\" class=\"thedays\"><span id=\"v19\" class=\"thetemps2\"></span>\n      <div id=\"f19\" class=\"thetemps\">+20</div>\n      <div id=\"t19\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '25'})\" class=\"thedays\"><span id=\"v20\" class=\"thetemps2\"></span>\n      <div id=\"f20\" class=\"thetemps\">+20</div>\n      <div id=\"t20\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '26'})\" class=\"thedays\"><span id=\"v21\" class=\"thetemps2\"></span>\n      <div id=\"f21\" class=\"thetemps\">+20</div>\n      <div id=\"t21\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '27'})\" class=\"thedays\"><span id=\"v22\" class=\"thetemps2\"></span>\n      <div id=\"f22\" class=\"thetemps\">+20</div>\n      <div id=\"t22\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '28'})\" class=\"thedays\"><span id=\"v23\" class=\"thetemps2\"></span>\n      <div id=\"f23\" class=\"thetemps\">+20</div>\n      <div id=\"t23\" class=\"theblocks\"></div>\n    </td>\n  </tr>\n\n\n  <!--<tr>-->\n  <!--  <td ng-click=\"send({payload: '17'})\" class=\"thedays\"><span id=\"f12\" class=\"thetemps\"></span>-->\n  <!--    <div id=\"t12\" class=\"theblocks\"></div>-->\n  <!--  </td>-->\n  <!--  <td ng-click=\"send({payload: '18'})\" class=\"thedays\"><span id=\"f13\" class=\"thetemps\"></span>-->\n  <!--    <div id=\"t13\" class=\"theblocks\"></div>-->\n  <!--  </td>-->\n  <!--  <td ng-click=\"send({payload: '19'})\" class=\"thedays\"><span id=\"f14\" class=\"thetemps\"></span>-->\n  <!--    <div id=\"t14\" class=\"theblocks\"></div>-->\n  <!--  </td>-->\n  <!--  <td ng-click=\"send({payload: '20'})\" class=\"thedays\"><span id=\"f15\" class=\"thetemps\"></span>-->\n  <!--    <div id=\"t15\" class=\"theblocks\"></div>-->\n  <!--  </td>-->\n  <!--  <td ng-click=\"send({payload: '21'})\" class=\"thedays\"><span id=\"f16\" class=\"thetemps\"></span>-->\n  <!--    <div id=\"t16\" class=\"theblocks\"></div>-->\n  <!--  </td>-->\n  <!--  <td ng-click=\"send({payload: '22'})\" class=\"thedays\"><span id=\"f17\" class=\"thetemps\"></span>-->\n  <!--    <div id=\"t17\" class=\"theblocks\"></div>-->\n  <!--  </td>-->\n  <!--  <td ng-click=\"send({payload: '23'})\" class=\"thedays\"><span id=\"f18\" class=\"thetemps\"></span>-->\n  <!--    <div id=\"t18\" class=\"theblocks\"></div>-->\n  <!--  </td>-->\n  <!--  <td ng-click=\"send({payload: '24'})\" class=\"thedays\"><span id=\"f19\" class=\"thetemps\"></span>-->\n  <!--    <div id=\"t19\" class=\"theblocks\"></div>-->\n  <!--  </td>-->\n  <!--  <td ng-click=\"send({payload: '25'})\" class=\"thedays\"><span id=\"f20\" class=\"thetemps\"></span>-->\n  <!--    <div id=\"t20\" class=\"theblocks\"></div>-->\n  <!--  </td>-->\n  <!--  <td ng-click=\"send({payload: '26'})\" class=\"thedays\"><span id=\"f21\" class=\"thetemps\"></span>-->\n  <!--    <div id=\"t21\" class=\"theblocks\"></div>-->\n  <!--  </td>-->\n  <!--  <td ng-click=\"send({payload: '27'})\" class=\"thedays\"><span id=\"f22\" class=\"thetemps\"></span>-->\n  <!--    <div id=\"t22\" class=\"theblocks\"></div>-->\n  <!--  </td>-->\n  <!--  <td ng-click=\"send({payload: '28'})\" class=\"thedays\"><span id=\"f23\" class=\"thetemps\"></span>-->\n  <!--    <div id=\"t23\" class=\"theblocks\"></div>-->\n  <!--  </td>-->\n  <!--</tr>-->\n\n\n\n\n  <tr style=\"height:2px\">\n    <td id=\"td17\" class=\"the2px\"></td>\n    <td id=\"td18\" class=\"the2px\"></td>\n    <td id=\"td19\" class=\"the2px\"></td>\n    <td id=\"td20\" class=\"the2px\"></td>\n    <td id=\"td21\" class=\"the2px\"></td>\n    <td id=\"td22\" class=\"the2px\"></td>\n    <td id=\"td23\" class=\"the2px\"></td>\n    <td id=\"td24\" class=\"the2px\"></td>\n    <td id=\"td25\" class=\"the2px\"></td>\n    <td id=\"td26\" class=\"the2px\"></td>\n    <td id=\"td27\" class=\"the2px\"></td>\n    <td id=\"td28\" class=\"the2px\"></td>\n  </tr>\n\n  <tr>\n    <td>12</td>\n    <td>13</td>\n    <td>14</td>\n    <td>15</td>\n    <td>16</td>\n    <td>17</td>\n    <td>18</td>\n    <td>19</td>\n    <td>20</td>\n    <td>21</td>\n    <td>22</td>\n    <td>23</td>\n  </tr>\n  \n  <tr height=\"4px\">\n    <td colspan=\"12\"></td>\n  </tr>\n\n\n  <tr height=\"22px\">\n    <td colspan=2 bgcolor=\"#dddddd\"><span class=\"smallheadings\">&nbsp;Status:</span></td>\n\n    <td colspan=10 bgcolor=\"#dddddd\">\n      <center><span id=\"info\" class=\"smallheadings\">OK</span></center>\n    </td>\n  </tr>\n\n  <tr height=\"2px\">\n    <td colspan=\"12\"></td>\n  </tr>\n\n  <!--<tr style=\"height:35px\">-->\n  <tr>\n    <td colspan=2>\n      <md-button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'b'})\">\n        <img style=\"outline : none;\" ng-src=\"{{(msg.payload)?'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/refresh1.png':'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/refresh1.png'}}\" height=\"35px\" />\n      </md-button>\n    </td>\n      \n      \n    <td colspan=2>\n      <md-button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 's'})\">\n        <img style=\"outline : none;\" ng-src=\"{{(msg.payload)?'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/Save.png':'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/Save.png'}}\" height=\"35px\" />\n      </md-button>  \n    </td>\n    \n    <td colspan=2>\n      <md-button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'd'})\">\n        <img style=\"outline : none;\" ng-src=\"{{(msg.payload)?'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/down.png':'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/down.png'}}\" height=\"35px\" />\n      </md-button>\n    </td>\n\n    <!--<td colspan=2>-->\n    <!--  <center><span id=\"current\" style=\"color:black;font-size:120%\">-</span></center>-->\n    <!--</td>-->\n\n    <td colspan=2>\n      <md-button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'u'})\">\n        <img style=\"outline : none;\" ng-src=\"{{(msg.payload)?'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/up.png':'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/up.png'}}\" height=\"35px\" />\n      </md-button>\n    </td>\n\n    <td colspan=2>\n      <md-button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'r'})\">\n        <img style=\"outline : none;\" ng-src=\"{{(msg.payload)?'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/copy-512.png':'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/copy-512.png'}}\" height=\"35px\" />\n      </md-button>\n    </td>\n\n    <td colspan=2>\n      <md-button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'c'})\">\n        <img style=\"outline : none;\" ng-src=\"{{(msg.payload)?'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/report2.png':'http://www.chanthaburi.buu.ac.th/~phaitoon/public/images/report2.png'}}\" height=\"35px\" />\n      </md-button>    \n        \n\n    </td>\n\n    \n    <td colspan=1></td>\n  </tr>\n</table>\n\n","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":765.0000381469727,"y":202.0000057220459,"wires":[["693db1d7.09259","ae355f8c.c0b15"]]},{"id":"2196955e.914afa","type":"ui_template","z":"77963358.df6f4c","group":"5488c752.3230e8","name":"css etc","order":10,"width":"0","height":"0","format":"<style>\n\n.cellGreen \n{\nbackground-color: #ffdddd !important;\n}\n\n  .filled { \n      height: 100% !important;\n\n      padding: 0 !important;\n      margin: 0 !important;\n  }\n  .nr-dashboard-template {\n      padding: 0;\n      margin: 0;\n  }\n  \n  .rounded {\n  border-radius: 12px 12px 12px 12px;\n}\n \n   .bigfont {\n  font-size: 18px;\n}\n\n   .smallfont {\n  font-size: 12px;\n}\n \n\n  \n.zui-table {\n    border: solid 1px #DDEEEE;\n    border-collapse: collapse;\n    border-spacing: 0;\n    font: normal 10px Arial, sans-serif;\n    outline: none;\n}\n.zui-table thead th {\n    width: 100%;\n    height:50%;\n    background-color: #99bbff;\n    border: solid 1px #DDEEEE;\n    color: #336B6B;\n    padding: 7px 3px 5px 3px;\n    text-align: center;\n    text-shadow: 1px 1px 1px #fff;\n}\n.zui-table tbody td {\n    width: 100%;\n    height:50%;\n    border: solid 1px #333;\n    color: #333;\n    text-align: center;\n    padding: 6px 3px 9px 3px;\n    text-shadow: 1px 1px 1px #fff;\n}\n.zui-table-rounded {\n    border: none;\n}\n.zui-table-rounded thead th {\n    background-color: #77aaff;\n    border: none;\n    text-shadow: 1px 1px 1px #ccc;\n    color: #333;\n}\n.zui-table-rounded thead th:first-child {\n    border-radius: 10px 0 0 0;\n}\n.zui-table-rounded thead th:last-child {\n    border-radius: 10px 10px 0px 0px;\n}\n.zui-table-rounded tbody td {\n    border: none;\n    border-top: solid 1px #957030;\n    background-color: #aaddff;\n}\n.zui-table-rounded tbody tr:last-child td:first-child {\n    border-radius: 10px 10px 0 0;\n}\n.zui-table-rounded tbody tr:last-child td:last-child {\n    border-radius: 0 0 10px 10px;\n}  \n</style>\n\n<script>\nvar current=1;\n\n$('.vibrate').on('click', function() {\n  navigator.vibrate(100);\n});\n\nfunction restore_bg(x) {\n            $(this).css(\"background-color\", x);\n    };\n\n$('.touched').on('mousedown', function() {\n    \n    var x= $(this).css(\"background-color\");\n    $(this).css(\"background-color\", \"yellow\");\n    \n    setTimeout(restore_bg.bind(this,x),50);\n    navigator.vibrate(80);\n    });\n    \nvar myStatus=\"Nowt\";\n</script>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":413.00000381469727,"y":61.00000286102295,"wires":[[]]},{"id":"4e5113b4.8d914c","type":"ui_template","z":"77963358.df6f4c","group":"5488c752.3230e8","name":"SPRAY","order":3,"width":"1","height":"1","format":"                \n<script>\n   (function(scope){\n        scope.$watch('msg', function(msg) {\n            // if (msg.payload!=\"\") $(\"#infor\").text(Number(parseInt(msg.payload)).toLocaleString('en-GB')+\"L/h\");\n            // if (msg.colour!=\"\") $(\"#infor\").css(\"background-color\",msg.colour);\n             \n            if(msg.payload==\"WAIT\"){\n                $(\"#infor\").css(\"background-color\",\"#aaddff\"); \n                 $(\"#infor\").text(\"Waiting\"); \n            } else if (msg.payload!=\"\" && parseInt(msg.payload)>=0){\n                $(\"#infor\").text(Number(parseInt(msg.payload)).toLocaleString('en-GB')+\"L/m\");\n                $(\"#infor\").css(\"background-color\",\"#88ff88\"); \n                msg.mode = \"ON\";\n             }else if(msg.payload == \"ON\"){\n                $(\"#infor\").text(\"ON\");\n                $(\"#infor\").css(\"background-color\",\"#88ff88\"); \n                msg.mode=\"ON\";\n             }else{// if (msg.payload!=\"\" && msg.payload==\"OFF\"){\n                $(\"#infor\").text(\"OFF\");\n                $(\"#infor\").css(\"background-color\",\"#ff8888\");\n                 //if (msg.colour!=\"\") $(\"#infor\").css(\"background-color\",msg.colour);\n                msg.mode = \"OFF\";\n             }\n        });\n \n    })(scope);\n</script>\n<table  ng-click=\"(msg.mode=='ON')?send({payload:'OFF_SPRAY',topic:'/house1/control/spray'}):send({payload:'ON_SPRAY',topic:'/house1/control/spray'})\" width=100% height=100% class=\"vibrate zui-table zui-table-rounded\">\n    <thead>\n        <tr>\n            <th>SPRAY</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr >\n            <td id=\"infor\"></td>\n        </tr>\n\n    </tbody>\n</table>\n","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":291,"y":196,"wires":[["4583f81a.cd8a18","34838227.915b1e","94f762f3.b1a72"]]},{"id":"e3c4d518.230328","type":"function","z":"77963358.df6f4c","name":"getSoilMoisture","func":"function theNewDate()\n{\n   var d = new Date();\n   d.setTime( d.getTime() + 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\n    minutes = d.getMinutes().toString().length == 1 ? '0'+d.getMinutes() : d.getMinutes();\n    hours = d.getHours().toString().length == 1 ? '0'+d.getHours() : d.getHours();\n   // ampm = d.getHours() >= 12 ? 'pm' : 'am';\n    months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n    days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];\n    var m= days[d.getDay()]+' '+months[d.getMonth()]+' '+d.getDate()+' '+d.getFullYear()+' '+hours+':'+minutes;\n    return m;\n}\n\n\n// if(global.get(\"heatRelay\") == 'undefined')global.set(\"heatRelay\",0);\n\n// var output = msg.payload.split(\",\");\n// msg.value=parseInt(output[1]);\n// msg.heatRelay=global.get(\"heatRelay\");\n// msg.humidity=parseFloat(output[0]);\n\n\nmsg.topic=theNewDate();\nmsg.payload=\"Soil Moisture: \"+msg.payload+\"%\" ;\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1119,"y":629,"wires":[[]]},{"id":"772ec9b5.ff8508","type":"inject","z":"77963358.df6f4c","name":"/state/error:Fail to read from SOIL!!!","topic":"/state/error","payload":"Fail to read from SOIL!!!","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":173,"y":775,"wires":[["3f53ae5a.f0c172"]]},{"id":"2a38c37e.7af2ac","type":"inject","z":"77963358.df6f4c","name":"/state/soil:70","topic":"/state/soil","payload":"70","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":124,"y":718,"wires":[["3f53ae5a.f0c172"]]},{"id":"4dc9a222.71432c","type":"inject","z":"77963358.df6f4c","name":"/state/soil:fff","topic":"/state/soil","payload":"fff","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":115,"y":678,"wires":[["3f53ae5a.f0c172"]]},{"id":"e4a18d4.684aa7","type":"function","z":"77963358.df6f4c","name":"","func":"if(msg.payload==\"ON_VALVE1\" || msg.payload==\"OFF_VALVE1\"){\n    msg.payload = \"WAIT\";\n    return msg;\n}\n\n","outputs":1,"noerr":0,"x":110,"y":144,"wires":[["b904ee55.64588"]]},{"id":"420cd803.dc7988","type":"inject","z":"77963358.df6f4c","name":"","topic":"/state/light","payload":"ON","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":89,"y":52,"wires":[["3f53ae5a.f0c172"]]},{"id":"652e4c53.6c2714","type":"inject","z":"77963358.df6f4c","name":"","topic":"/state/light","payload":"OFF","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":98,"y":86,"wires":[["3f53ae5a.f0c172"]]},{"id":"f77951a0.c033a","type":"inject","z":"77963358.df6f4c","name":"","topic":"/state/water","payload":"OFF","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":285,"y":20,"wires":[["3f53ae5a.f0c172"]]},{"id":"1c123b1d.6ecdb5","type":"inject","z":"77963358.df6f4c","name":"","topic":"/state/water","payload":"ON","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":287,"y":49,"wires":[["3f53ae5a.f0c172"]]},{"id":"cbc3e241.8636b","type":"function","z":"77963358.df6f4c","name":"Light","func":"\nvar now = new Date();\nnow.setTime( now.getTime() + 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\nmsg.topic = \"/house1/control/valve1\";\nmsg.payload = (msg.relay===0)?\"OFF_VALVE1\":\"ON_VALVE1\";\n\nnode.status({fill:\"blue\",shape:\"dot\",text:\"topic: \" + msg.topic + \" payload: \" + msg.payload});\n\n\nreturn msg;","outputs":"1","noerr":0,"x":1240.4000625610352,"y":450.0000228881836,"wires":[["34838227.915b1e"]]},{"id":"15d1fd84.eacc02","type":"ui_template","z":"77963358.df6f4c","group":"5488c752.3230e8","name":"newergauge","order":1,"width":"3","height":"3","format":"<!--<script type=\"text/javascript\" src=\"http://www.chanthaburi.buu.ac.th/~phaitoon/public/scripts/gauge.min.js\"></script>-->\n<script src=\"//cdn.rawgit.com/Mikhus/canvas-gauges/gh-pages/download/2.1.5/radial/gauge.min.js\"></script>\n\n<script>\n\n\n   (function(scope){\n        scope.$watch('msg', function(msg) {\n           gauge.value=msg.value;\n           gauge.heat=msg.heatRelay;\n           gauge.humidity=msg.humidityRelay;\n           gauge.draw();\n        });\n    })(scope);\n    \nvar gauge = new RadialGauge({\n    renderTo: 'canvas-id',\n    width: 160,\n    height: 160,\n    heat: 0,\n    humidity: 0,\n    units: \"Degrees C\",\n    title: \"Heating\",\n    minValue: 10,\n    maxValue: 40,\n    majorTicks: [\n        '10',\n        '15',\n        '20',\n        '25',\n        '30',\n        '35',\n        '40'\n    ],\n    minorTicks: 5,\n    strokeTicks: true,\n   highlights  : [\n        { from : 10,  to : 15, color : '#8888ff' },\n        { from : 15, to : 20, color :  '#88ff88' },\n        { from : 20, to : 25, color :  '#ffff00' },\n        { from : 25, to : 30, color :  '#ff8888' },\n        { from : 30, to : 35, color :  '#ff8000' },\n        { from : 35, to : 40, color :  '#ff0000' }\n    ],\n\n    colorPlate: \"#fff\",\n    borderShadowWidth: 0,\n    borders: true,\n    needleType: \"arrow\",\n    valueInt: 2,\n    valueDec:0,\n    needleWidth: 2,\n    fontTitleSize: 42,\n    needleCircleSize: 14,\n    needleCircleOuter: true,\n    needleCircleInner: false,\n    animationDuration: 500,\n    animationRule: \"linear\"\n}).draw();\n\n\ngauge.on('beforeNeedle', function () {\n        // getting canvas 2d drawing context\n        var context = this.canvas.context;\n        // we can use gauge context special 'max' property which represents\n        // gauge radius in a real pixels and calculate size of relative pixel\n        // for our drawing needs\n        var pixel = context.max / 100;\n        // step out our circle center coordinate by 30% of its radius from\n        // gauge center\n        var centerX = 36 * pixel;\n        // stay in center by Y-coordinate\n        var centerY = 0;\n        // use circle radius equal to 5%\n        var radius = 10 * pixel;\n        // save previous context state\n        context.save();\n        \n        // draw circle using canvas JS API\n        context.beginPath();\n        context.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);\n        context.fillStyle = (this.heat) ? '#ff0000' : '#8888';\n        context.fill();\n        context.closePath();\n\n        context.beginPath();\n        context.arc(centerX-(72 * pixel), centerY, radius, 0, 2 * Math.PI, false);\n        context.fillStyle = (this.humidity) ? '#00dd88' : '#888888';\n        context.fill();\n        context.closePath();\n        // restore previous context state to prevent break of\n        // further drawings        \n        \n        context.restore();\n       // context.draw();\n    });\n\ngauge.value = 0;\n\n\n</script>\n<canvas style=\"outline: none;\" ng-click=\"send({payload: ' '})\" id=\"canvas-id\">\n</canvas>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":865.0001678466797,"y":681.0000343322754,"wires":[[]]},{"id":"6779cf73.7005a","type":"inject","z":"77963358.df6f4c","name":"","topic":"","payload":"50,20,60","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":111,"y":866,"wires":[["a83742d0.593b"]]},{"id":"6596ac2f.17b874","type":"function","z":"77963358.df6f4c","name":"StoringDataValve1","func":"var outputs = [];\nvar minute = 1000*60;\n// var count = context.get('count') || 0;\n// count +=1;\n// context.set('count',count);\n    // Update the status with current timestamp\nvar now = new Date();\nvar flow_rate = 0.02;\n\nnow.setTime(now.getTime() + 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\nif(typeof context.time == 'undefined')context.time = now.getTime();\nif(typeof context.flag == 'undefined')context.flag = false;\nif(typeof context.start_time == 'undefined')context.start_time = now.getTime();\nif(typeof context.end_time == 'undefined')context.end_time =  now.getTime();\n\nif(msg.payload == 'OFF' && context.flag === true){\n    context.flag = false;\n    end_time = now.getTime();\n    qty = ((end_time - context.start_time)/minute)*flow_rate;\n    qty = Number(qty).toFixed(2);\n    sql = \"INSERT INTO water (start_time,end_time,qty,pump_id,date) values (\"+context.start_time+\",\"+end_time+\",\"+qty+\",3, CONVERT_TZ(now(),'+00:00','+7:00'))\"; //pump_id = 3 is valve1\n    \n    outputs.push({topic:sql});\n    \n    var yyyy = now.getFullYear();\n    var mm = now.getMonth() < 9 ? \"0\" + (now.getMonth() + 1) : (now.getMonth() + 1); // getMonth() is zero-based\n    var dd  = now.getDate() < 10 ? \"0\" + now.getDate() : now.getDate();\n    var hh = now.getHours() < 10 ? \"0\" + now.getHours() : now.getHours();\n    var mmm  = now.getMinutes() < 10 ? \"0\" + now.getMinutes() : now.getMinutes();\n    var ss  = now.getSeconds() < 10 ? \"0\" + now.getSeconds() : now.getSeconds();\n    node.status({fill:\"blue\",shape:\"ring\",text:\"Last update: \"+dd + \".\" + mm + \".\" + yyyy + \" \" + hh + \":\" + mmm + \":\" + ss+\"-> INSERT INTO water\"});    \n    \n    //  count = 0;\n    //  context.set('count',count);\n    return [ outputs ];    \n    \n}else if(msg.payload == 'ON' && context.flag === false){\n    context.flag = true;\n    context.start_time = now.getTime();\n\n    node.status({fill:\"blue\",shape:\"dot\",text:\"topic: \" + msg.topic + \" payload: \" + msg.payload});\n\n    \n}\n\n","outputs":1,"noerr":0,"x":935,"y":753,"wires":[["81ba2307.28c84","94a5ad78.d8bbc"]]},{"id":"81ba2307.28c84","type":"debug","z":"77963358.df6f4c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":935.1666259765625,"y":826.888916015625,"wires":[]},{"id":"d30e586e.723c88","type":"function","z":"77963358.df6f4c","name":"StoringDataValve2","func":"var outputs = [];\nvar minute = 1000*60;\n// var count = context.get('count') || 0;\n// count +=1;\n// context.set('count',count);\n    // Update the status with current timestamp\nvar now = new Date();\nvar flow_rate = 0.02;\n\nnow.setTime(now.getTime() + 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\nif(typeof context.time == 'undefined')context.time = now.getTime();\nif(typeof context.flag == 'undefined')context.flag = false;\nif(typeof context.start_time == 'undefined')context.start_time = now.getTime();\nif(typeof context.end_time == 'undefined')context.end_time =  now.getTime();\n\nif(msg.payload == 'OFF' && context.flag === true){\n    context.flag = false;\n    end_time = now.getTime();\n    qty = ((end_time - context.start_time)/minute)*flow_rate;\n    qty = Number(qty).toFixed(2);\n    //pump_id = device_id which is the pump controller;\n    sql = \"INSERT INTO water (start_time,end_time,qty,pump_id,date) values (\"+context.start_time+\",\"+end_time+\",\"+qty+\",4,  CONVERT_TZ(now(),'+00:00','+7:00'))\"; //pump_id = 4 is valve4\n    \n    outputs.push({topic:sql});\n    \n    var yyyy = now.getFullYear();\n    var mm = now.getMonth() < 9 ? \"0\" + (now.getMonth() + 1) : (now.getMonth() + 1); // getMonth() is zero-based\n    var dd  = now.getDate() < 10 ? \"0\" + now.getDate() : now.getDate();\n    var hh = now.getHours() < 10 ? \"0\" + now.getHours() : now.getHours();\n    var mmm  = now.getMinutes() < 10 ? \"0\" + now.getMinutes() : now.getMinutes();\n    var ss  = now.getSeconds() < 10 ? \"0\" + now.getSeconds() : now.getSeconds();\n    node.status({fill:\"blue\",shape:\"ring\",text:\"Last update: \"+dd + \".\" + mm + \".\" + yyyy + \" \" + hh + \":\" + mmm + \":\" + ss+\"-> INSERT INTO water\"});    \n    \n    //  count = 0;\n    //  context.set('count',count);\n    return [ outputs ];    \n    \n}else if(msg.payload == 'ON' && context.flag === false){\n    context.flag = true;\n    context.start_time = now.getTime();\n\n    node.status({fill:\"blue\",shape:\"dot\",text:\"topic: \" + msg.topic + \" payload: \" + msg.payload});\n\n    \n}\n\n","outputs":1,"noerr":0,"x":930,"y":869.7777709960938,"wires":[["94a5ad78.d8bbc","81ba2307.28c84"]]},{"id":"904ead23.31089","type":"function","z":"77963358.df6f4c","name":"Valve2","func":"var now = new Date();\nnow.setTime( now.getTime() + 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\nmsg.topic = \"/house1/control/valve2\";\nmsg.payload = (msg.relay===0)?\"OFF_VALVE2\":\"ON_VALVE2\";\n\nnode.status({fill:\"blue\",shape:\"dot\",text:\"topic: \" + msg.topic + \" payload: \" + msg.payload});\n\n\nreturn msg;","outputs":"1","noerr":0,"x":1236.6666259765625,"y":519.111083984375,"wires":[["34838227.915b1e"]]},{"id":"d670a4d2.21f7f8","type":"function","z":"77963358.df6f4c","name":"StoringDataSoil","func":"var outputs = [];\nvar minute = 1000*60;\n// var count = context.get('count') || 0;\n// count +=1;\n// context.set('count',count);\n    // Update the status with current timestamp\nvar now = new Date();\nnow.setTime(now.getTime() + 420*60*1000 ); //420 is localtime in minutes which differ from THA and US\nif(typeof context.time == 'undefined')context.time = now.getTime();\nvar th = global.get('record1');\nif(typeof th == 'undefined')th=15;\nif(parseInt(th)>0 && (now.getTime()-context.time) > parseInt(th*minute)){ //node mcu send dht for every 30 seconds, th store value of minute.\n   \n    context.time = now.getTime();\n    soil = msg.payload;\n\n    var epoch = now.getTime();\n    sql = \"INSERT INTO soil (value,epoch,date,s_id) values (\"+soil+\",\"+epoch+\", CONVERT_TZ(now(),'+00:00','+7:00'),11)\"; //25 is device_id of Soil-1\n    \n    outputs.push({topic:sql});\n    \n    var yyyy = now.getFullYear();\n    var mm = now.getMonth() < 9 ? \"0\" + (now.getMonth() + 1) : (now.getMonth() + 1); // getMonth() is zero-based\n    var dd  = now.getDate() < 10 ? \"0\" + now.getDate() : now.getDate();\n    var hh = now.getHours() < 10 ? \"0\" + now.getHours() : now.getHours();\n    var mmm  = now.getMinutes() < 10 ? \"0\" + now.getMinutes() : now.getMinutes();\n    var ss  = now.getSeconds() < 10 ? \"0\" + now.getSeconds() : now.getSeconds();\n    node.status({fill:\"blue\",shape:\"ring\",text:\"Last update: \"+dd + \".\" + mm + \".\" + yyyy + \" \" + hh + \":\" + mmm + \":\" + ss});    \n    \n    //  count = 0;\n    //  context.set('count',count);\n    return [ outputs ];\n}\nnode.status({fill:\"blue\",shape:\"dot\",text:\"topic: \" + msg.topic + \" payload: \" + msg.payload+\" record1: \"+th});\n\n","outputs":1,"noerr":0,"x":395,"y":614,"wires":[["94a5ad78.d8bbc","df1a779f.41c118"]]},{"id":"5b0760b.ca1a9a","type":"inject","z":"a5f3d8c4.ba3b58","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":607.3000717163086,"y":209.00000286102295,"wires":[["d536de76.d7d36"]]},{"id":"d536de76.d7d36","type":"function","z":"a5f3d8c4.ba3b58","name":"","func":"var count = global.get(\"test_count\");\nif(typeof count == 'undefined') count=0;\n\n\ncount++;\nglobal.set(\"test_count\",count);\nmsg.payload = count;\nreturn msg;\n","outputs":1,"noerr":0,"x":755.3000717163086,"y":208.00000381469727,"wires":[["99ae2c6.5b091d"]]},{"id":"99ae2c6.5b091d","type":"debug","z":"a5f3d8c4.ba3b58","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1022.300048828125,"y":146,"wires":[]},{"id":"bdba70fd.7f823","type":"inject","z":"a5f3d8c4.ba3b58","name":"Reset","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":572.3000183105469,"y":267,"wires":[["4d52c8a9.a7df28"]]},{"id":"4d52c8a9.a7df28","type":"function","z":"a5f3d8c4.ba3b58","name":"","func":"global.set(\"test_count\",0);\nmsg.payload = global.get(\"test_count\");\nreturn msg;","outputs":1,"noerr":0,"x":732.3000183105469,"y":261,"wires":[["99ae2c6.5b091d"]]},{"id":"8462780f.e0ece8","type":"inject","z":"a5f3d8c4.ba3b58","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":655.3000106811523,"y":468.0000047683716,"wires":[["78e56703.1cf498"]]},{"id":"78e56703.1cf498","type":"function","z":"a5f3d8c4.ba3b58","name":"Disp.Batt","func":"\n      data = [\n  {\"period\": 1349046000000, \"licensed\": 3407, \"sorned\": 660},\n  {\"period\": 1313103600000, \"licensed\": 3351, \"sorned\": 629},\n  {\"period\": 1299110400000, \"licensed\": 3269, \"sorned\": 618},\n  {\"period\": 1281222000000, \"licensed\": 3246, \"sorned\": 661},\n  {\"period\": 1273446000000, \"licensed\": 3257, \"sorned\": 667},\n  {\"period\": 1268524800000, \"licensed\": 3248, \"sorned\": 827},\n  {\"period\": 1263081600000, \"licensed\": 3171, \"sorned\": 660},\n  {\"period\": 1260403200000, \"licensed\": 3171, \"sorned\": 676},\n  {\"period\": 1254870000000, \"licensed\": 3201, \"sorned\": 656},\n  {\"period\": 1253833200000, \"licensed\": 3215, \"sorned\": 622}\n];\n\n\nif(typeof context.ind == 'undefined')context.ind = 0;\nif(typeof context.data == 'undefined')context.data = [];\n\nvar output = msg.payload.split(\",\");\n\n// msg.value=parseInt(output[1]);\n// msg.humidity=parseFloat(output[0]);\nvar d = new Date();\n\ncontext.data.push({\"period\":d.getTime(),\"VS\":parseFloat(output[0]),\"VB\":parseFloat(output[1]),\"IS\":parseFloat(output[2]),\"IB\":parseFloat(output[3])});\n//msg2.push({ key: \"test\", values : output});\n//context.data[context.ind].period = d.getTime();\n//context.ind++;\n//context.ind %= 10;\n\nif(context.data.length>10){\n    context.data.shift();\n}\nmsg.selector = 1;\nmsg.control = 4;\nmsg.graph = 1;\nmsg.payload = context.data;\nreturn msg","outputs":1,"noerr":0,"x":682.3000564575195,"y":521.0000047683716,"wires":[["d8554b2e.9b1808","ee1d0173.803e2"]]},{"id":"d8554b2e.9b1808","type":"debug","z":"a5f3d8c4.ba3b58","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":814.9000244140625,"y":502,"wires":[]},{"id":"9c403f24.11191","type":"debug","z":"a5f3d8c4.ba3b58","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":743.1000061035156,"y":1151,"wires":[]},{"id":"8b4d64e0.5076e8","type":"debug","z":"77963358.df6f4c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":411.1000518798828,"y":454.0000057220459,"wires":[]},{"id":"94f762f3.b1a72","type":"debug","z":"77963358.df6f4c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":584.1000366210938,"y":362,"wires":[]},{"id":"1696514f.7e572f","type":"debug","z":"77963358.df6f4c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":646.1000366210938,"y":233,"wires":[]},{"id":"fbc10c16.a847c","type":"function","z":"a5f3d8c4.ba3b58","name":"TurnOnSolarWeb","func":"if(msg.control == 4){\n    msg.payload = \"ON_SOLAR_WEB\";\n}else{\n    msg.payload = \"OFF_SOLAR_WEB\";\n}\nmsg.topic =\"/house1/control/solarcell\";\nreturn msg;","outputs":1,"noerr":0,"x":1052,"y":584,"wires":[["2b2f4ab8.4f94f6","4c6e416f.f4f66"]]},{"id":"4c6e416f.f4f66","type":"debug","z":"a5f3d8c4.ba3b58","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1293,"y":579,"wires":[]},{"id":"c151aafd.fd6e58","type":"function","z":"a5f3d8c4.ba3b58","name":"TurnOffSolarWeb","func":"msg.payload = \"OFF_SOLAR_WEB\";\nmsg.topic =\"/house1/control/solarcell\";\nreturn msg;\n","outputs":1,"noerr":0,"x":1055,"y":545,"wires":[["2b2f4ab8.4f94f6","e0554a99.9ac208"]]},{"id":"ac053f22.a2b0d","type":"ui_template","z":"b4cbe1d0.a16da","group":"d38eb155.1deb4","name":"","order":1,"width":0,"height":0,"format":"<style>\n#icon_1 {\n  display: block;\n  margin-left: auto;\n  margin-right: auto;\n  height: 80px;\n  width: 200px;\n}\n</style>\n<!--<div ng-bind-html=\"msg.payload\"></div>-->\n<img src=\"http://www.chanthaburi.buu.ac.th/~phaitoon/152306.jpg\" alt=\"Smiley face\" >\n<img src=\"http://www.chanthaburi.buu.ac.th/~phaitoon/enter1.png\" alt=\"Smiley face\" id=\"icon_1\" ng-click=\"send({payload:{group:{ show:['House1_Home'], hide:['House1_Welcome'], focus:true}}})\" width=100% height=100% class=\"vibrate zui-table zui-table-rounded\">>   \n\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":273,"y":153,"wires":[["ef47a5c6.2260c8","f2d3bea3.6d09"]]},{"id":"ef47a5c6.2260c8","type":"debug","z":"b4cbe1d0.a16da","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":545,"y":129,"wires":[]},{"id":"f2d3bea3.6d09","type":"ui_ui_control","z":"b4cbe1d0.a16da","name":"","events":"all","x":544,"y":211,"wires":[[]]},{"id":"b3e41053.8515b","type":"inject","z":"b4cbe1d0.a16da","name":"","topic":"","payload":"{group:{ show:[\"House1_Welcome\"], hide:[\"House1_Home\", hide:[\"House1_Graph\"], focus:true}}","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":188,"y":89,"wires":[["f8d173f4.44147"]]},{"id":"f8d173f4.44147","type":"function","z":"b4cbe1d0.a16da","name":"","func":"// msg.payload= {group:{ show:[\"House1_Welcome\"], hide:[\"House1_Home\"], focus:true}};\nmsg.payload= {group:{ show:[\"House1_Welcome\"], hide:[\"House1_Home\"], focus:true}};\n\nreturn msg;","outputs":1,"noerr":0,"x":364,"y":86,"wires":[["f2d3bea3.6d09"]]},{"id":"df1fcb37.519028","type":"function","z":"77963358.df6f4c","name":"","func":"// msg.payload= {group:{ show:[\"House1_Welcome\"], hide:[\"House1_Home\"], focus:true}};\nmsg.payload= {group:{ show:[\"House1_Graphs\"], hide:[\"House1_Home\"], focus:true}};\n\nreturn msg;","outputs":1,"noerr":0,"x":1134,"y":697,"wires":[["ff5d87c1.909ae8","d6633b79.7863e8"]]},{"id":"ff5d87c1.909ae8","type":"ui_ui_control","z":"77963358.df6f4c","name":"","events":"all","x":1310,"y":700,"wires":[[]]},{"id":"e4835d4d.19fa8","type":"function","z":"a5f3d8c4.ba3b58","name":"","func":"// msg.payload= {group:{ show:[\"House1_Welcome\"], hide:[\"House1_Home\"], focus:true}};\nmsg.payload= {group:{ show:[\"House1_Home\"], hide:[\"House1_Graphs\"], focus:true}};\n\nreturn msg;","outputs":1,"noerr":0,"x":1078,"y":643,"wires":[["562bc40.b837b3c","69f362cf.4036ec"]]},{"id":"562bc40.b837b3c","type":"ui_ui_control","z":"a5f3d8c4.ba3b58","name":"","events":"all","x":1235,"y":649,"wires":[[]]},{"id":"6ad1d667.f5d528","type":"inject","z":"a5f3d8c4.ba3b58","name":"","topic":"","payload":"1","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"2","x":926,"y":669,"wires":[["e4835d4d.19fa8"]]},{"id":"d6633b79.7863e8","type":"debug","z":"77963358.df6f4c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1356,"y":619,"wires":[]},{"id":"69f362cf.4036ec","type":"debug","z":"a5f3d8c4.ba3b58","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1232,"y":716,"wires":[]},{"id":"ec28d576.96de58","type":"function","z":"a5f3d8c4.ba3b58","name":"","func":"if(msg.payload==\"ON_VALVE1\" || msg.payload==\"OFF_VALVE1\"){\n    msg.payload = \"WAIT\";\n    return msg;\n}\n\n","outputs":1,"noerr":0,"x":559.0000076293945,"y":329.0000047683716,"wires":[["2ae1bfb8.0134b"]]},{"id":"826663c6.3f0a7","type":"function","z":"77963358.df6f4c","name":"","func":"if(msg.payload==\"ON_VALVE2\" || msg.payload==\"OFF_VALVE2\"){\n    msg.payload = \"WAIT\";\n    return msg;\n}","outputs":1,"noerr":0,"x":498.00000762939453,"y":316.99997329711914,"wires":[["fea2c496.8cf608"]]},{"id":"fea2c496.8cf608","type":"ui_template","z":"77963358.df6f4c","group":"5488c752.3230e8","name":"VALVE2","order":6,"width":"1","height":"1","format":"<script>\n   (function(scope){\n        scope.$watch('msg', function(msg) {\n            // if (msg.payload!=\"\") $(\"#infor\").text(Number(parseInt(msg.payload)).toLocaleString('en-GB')+\"L/h\");\n            // if (msg.colour!=\"\") $(\"#infor\").css(\"background-color\",msg.colour);\n             \n            if(msg.payload==\"WAIT\"){\n                $(\"#infor_temp\").css(\"background-color\",\"#aaddff\"); \n                 $(\"#infor_temp\").text(\"Waiting\"); \n            }else if(msg.payload == \"ON\"){\n                $(\"#infor_temp\").text(\"ON\");\n                $(\"#infor_temp\").css(\"background-color\",\"#88ff88\"); \n                msg.mode=\"ON\";\n             }else{// if (msg.payload!=\"\" && msg.payload==\"OFF\"){\n                $(\"#infor_temp\").text(\"OFF\");\n                $(\"#infor_temp\").css(\"background-color\",\"#ff8888\");\n                 //if (msg.colour!=\"\") $(\"#infor\").css(\"background-color\",msg.colour);\n                msg.mode = \"OFF\";\n             }\n        });\n \n    })(scope);\n</script>\n<table  ng-click=\"(msg.mode=='ON')?send({payload:'OFF_VALVE2',topic:'/house1/control/valve2'}):send({payload:'ON_VALVE2',topic:'/house1/control/valve2'})\" width=100% height=100% class=\"vibrate zui-table zui-table-rounded\">\n    <thead>\n        <tr>\n            <th>VALVE2</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr >\n            <td id=\"infor_temp\"></td>\n        </tr>\n\n    </tbody>\n</table>\n\n","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":511.00000762939453,"y":257.00000381469727,"wires":[["826663c6.3f0a7","34838227.915b1e","e33ca316.edb7f"]]},{"id":"7eeeefa5.51cd3","type":"debug","z":"a5f3d8c4.ba3b58","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":442.10003662109375,"y":582,"wires":[]},{"id":"c4fa5aa8.2cd1a8","type":"function","z":"77963358.df6f4c","name":"Reload","func":"msg.payload= {group:{ show:[\"House1_Graphs\"], hide:[\"House1_Home\"], focus:true}};\nmsg.topic = \"/house1/state/reload/homeG\";\nreturn msg;","outputs":1,"noerr":0,"x":396,"y":778,"wires":[["76d9bc77.511984","34838227.915b1e","d67422a5.14011"]]},{"id":"76d9bc77.511984","type":"ui_ui_control","z":"77963358.df6f4c","name":"","events":"all","x":772,"y":779,"wires":[[]]},{"id":"9cf3f12c.60f39","type":"function","z":"a5f3d8c4.ba3b58","name":"ReloadHome","func":"msg.payload= {group:{ show:[\"House1_Home\"], hide:[\"House1_Graphs\"], focus:true}};\n// msg.topic = \"/house1/state/reload/graphs\";\nreturn msg;","outputs":1,"noerr":0,"x":743,"y":1054,"wires":[["33c84212.3706ee","9c403f24.11191"]]},{"id":"33c84212.3706ee","type":"ui_ui_control","z":"a5f3d8c4.ba3b58","name":"","events":"all","x":884,"y":999,"wires":[[]]},{"id":"1753cad4.d4f655","type":"function","z":"a5f3d8c4.ba3b58","name":"ReloadGraphs","func":"msg.payload= {group:{ show:[\"House1_Home\"], hide:[\"House1_Graphs\"], focus:true}};\nmsg.topic = \"/house1/state/reload/graphsH\";\nreturn msg;","outputs":1,"noerr":0,"x":558,"y":1152,"wires":[["6fe6bb05.627bf4","2b2f4ab8.4f94f6"]]},{"id":"6fe6bb05.627bf4","type":"ui_ui_control","z":"a5f3d8c4.ba3b58","name":"","events":"all","x":925,"y":1123,"wires":[[]]},{"id":"2f503173.35fb5e","type":"function","z":"77963358.df6f4c","name":"Reload","func":"msg.payload= {group:{ show:[\"House1_Graphs\"], hide:[\"House1_Home\"], focus:true}};\n// msg.topic = \"/house1/state/reload/homeG\";\nreturn msg;","outputs":1,"noerr":0,"x":610,"y":950,"wires":[["97a9c2f7.03ea7"]]},{"id":"97a9c2f7.03ea7","type":"ui_ui_control","z":"77963358.df6f4c","name":"","events":"all","x":986,"y":951,"wires":[[]]},{"id":"ca3b1eea.7ec32","type":"function","z":"a5f3d8c4.ba3b58","name":"TurnOffSolarWeb","func":"if(msg.control != 4){\n    msg.payload = \"OFF_SOLAR_WEB\";\n    msg.topic =\"/house1/control/solarcell\";\n    return msg;\n}","outputs":1,"noerr":0,"x":1053,"y":503,"wires":[["2b2f4ab8.4f94f6","ba33c44d.98e328"]]},{"id":"e0554a99.9ac208","type":"debug","z":"a5f3d8c4.ba3b58","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1268,"y":536,"wires":[]},{"id":"ba33c44d.98e328","type":"debug","z":"a5f3d8c4.ba3b58","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1257,"y":490,"wires":[]},{"id":"7fbfea59.d71214","type":"debug","z":"a5f3d8c4.ba3b58","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":508,"y":794,"wires":[]}]